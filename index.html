<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <style>
        /* كل الأنماط الحالية... */
        
        /* أضف هذا الكود في النهاية */
        /* ===== إصلاح شريط التحكم في الشاشة الكاملة ===== */
        
        body.fullscreen {
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            width: 100vw !important;
            height: 100vh !important;
        }


        body.fullscreen .container {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }


        body.fullscreen .video-section {
            width: 100vw !important;
            height: 100vh !important;
            border-radius: 0 !important;
            margin: 0 !important;
            flex: 1 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background: #000 !important;
        }


        /* ... أكمل بقية كود CSS كما في الإجابة السابقة */
    </style>
</head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>مشغل الفيديو المحسن - النسخة المطورة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #212529;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --gradient-primary: linear-gradient(135deg, #4361ee, #3a0ca3);
            --gradient-success: linear-gradient(135deg, #28a745, #20c997);
            --gradient-warning: linear-gradient(135deg, #ffc107, #fd7e14);
            --gradient-premium: linear-gradient(135deg, #6f42c1, #e83e8c);
        }
        
        [data-theme="dark"] {
            --primary-color: #7209b7;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --background-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e9ecef;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        [data-theme="blue"] {
            --primary-color: #0077b6;
            --secondary-color: #03045e;
            --accent-color: #00b4d8;
            --background-color: #caf0f8;
            --card-color: #ffffff;
            --text-color: #03045e;
            --shadow: 0 4px 20px rgba(0, 119, 182, 0.2);
        }
        
        [data-theme="green"] {
            --primary-color: #2a9d8f;
            --secondary-color: #264653;
            --accent-color: #e9c46a;
            --background-color: #f1faee;
            --card-color: #ffffff;
            --text-color: #264653;
            --shadow: 0 4px 20px rgba(42, 157, 143, 0.2);
        }
        
        [data-theme="premium"] {
            --primary-color: #6f42c1;
            --secondary-color: #e83e8c;
            --accent-color: #20c997;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #2d3748;
            --shadow: 0 4px 30px rgba(111, 66, 193, 0.15);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            touch-action: manipulation;
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
            font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body.fullscreen {
            padding: 0;
            overflow: hidden;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            transition: var(--transition);
        }
        
        body.fullscreen .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ✅ 🆕 تحسين الشريط العلوي مع إحصائيات سريعة */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 20px;
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow);
            width: 100%;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        body.fullscreen header {
            display: none;
        }
        
        h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 400;
            position: relative;
            z-index: 2;
        }
        
        /* 🆕 شريط الإحصائيات السريعة في الهيدر */
        .quick-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 18px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }
        
        .stat-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .stat-icon {
            font-size: 1.3rem;
            color: var(--accent-color);
        }
        
        .stat-info {
            display: flex;
            flex-direction: column;
        }
        
        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .player-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        body.fullscreen .player-container {
            flex: 1;
            margin-bottom: 0;
            gap: 0;
        }
        
        @media (min-width: 1200px) {
            .player-container {
                flex-direction: row;
            }
            
            body.fullscreen .player-container {
                flex-direction: column;
            }
        }
        
        .video-section {
            flex: 3;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            background-color: var(--card-color);
            transition: var(--transition);
            position: relative;
        }
        
        .video-section::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 5%;
            right: 5%;
            height: 10px;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.2) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(5px);
            z-index: -1;
        }
        
        body.fullscreen .video-section {
            flex: 1;
            border-radius: 0;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #000;
        }
        
        body.fullscreen .video-wrapper {
            padding-top: 0;
            height: 100%;
            width: 100%;
            max-width: 100vw;
            max-height: 100vh;
        }
        
        #videoPlayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            outline: none;
            cursor: pointer;
        }
        
        body.fullscreen #videoPlayer {
            position: relative;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* ✅ 🆕 تحسينات متقدمة لعناصر التحكم */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 50%, transparent 100%);
            padding: 20px 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            opacity: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            transform: translateY(0);
            visibility: visible;
            
        }
        
        .video-controls.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: translateY(100%);
        }
        
        @media (max-width: 768px) {
            .video-controls {
                padding-bottom: max(25px, env(safe-area-inset-bottom, 25px));
                padding-left: 20px;
                padding-right: 20px;
            }
        }
@media (max-width: 768px) {
    /* ===== إعادة تنظيم كاملة - نسخة مصغرة ومحسنة ===== */


    /* التحكم الرئيسي - أسفل الشاشة */
    .video-controls {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.9) 60%, rgba(0,0,0,0.7) 85%, transparent 100%);
        padding: 8px 12px max(20px, env(safe-area-inset-bottom, 20px)) 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        border-radius: 0;
        z-index: 10;
    }


    /* شريط التقدم - مصغر */
    .progress-bar-container {
        order: 1;
        margin-bottom: 6px;
        width: 100%;
    }


    .progress-container {
        height: 4px;
        width: 100%;
        background: rgba(255, 255, 255, 0.15);
    }


    .progress {
        height: 100%;
        background: var(--gradient-primary);
    }


    /* مجموعة الأزرار الرئيسية - مصغرة */
    .control-buttons {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        width: 100% !important;
        gap: 3px;
        padding: 0 !important;
        order: 2;
        min-height: 36px;
    }


    /* الجانب الأيسر - التحكم الأساسي */
    .left-controls {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 6px;
        justify-content: flex-start;
        flex: 0 1 auto;
        order: 1;
    }


    /* الجانب الأيمن - المعلومات والإعدادات */
    .right-controls {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 6px;
        justify-content: flex-end;
        flex: 0 1 auto;
        order: 3;
    }


    /* أزرار التحكم الأساسية - مصغرة جداً */
    .control-btn {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.85rem !important;
        border-radius: 6px !important;
        flex-shrink: 0;
        margin: 0 !important;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }


    /* زر التشغيل/الإيقاف - مصغر */
    #playPauseBtn {
        width: 34px !important;
        height: 34px !important;
        font-size: 0.9rem !important;
        background: rgba(67, 97, 238, 0.25);
        border: 1px solid rgba(67, 97, 238, 0.4);
    }


    /* مجموعة الصوت - مصغرة جداً */
    .volume-container {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 4px;
        margin: 0 !important;
        flex-shrink: 0;
    }


    .volume-slider {
        width: 40px;
        height: 2px;
        margin: 0 !important;
        display: block !important;
        background: rgba(255, 255, 255, 0.25);
    }


    .volume-slider::-webkit-slider-thumb {
        width: 10px;
        height: 10px;
    }


    .volume-slider::-moz-range-thumb {
        width: 10px;
        height: 10px;
    }


    /* ===== الخط الزمني - مصغر ومزاح لليسار ===== */
    .time-display {
        font-size: 0.65rem !important; /* أصغر */
        padding: 4px 8px !important;
        min-width: 60px !important; /* أصغر */
        text-align: center;
        margin: 0 0 0 -5px !important; /* إزاحة لليسار */
        flex-shrink: 0;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 4px;
        font-weight: 600;
        transform: translateX(-3px); /* إزاحة إضافية */
    }


    /* عرض السرعة - مصغر جداً */
    .speed-display {
        font-size: 0.65rem !important; /* أصغر */
        padding: 4px 8px !important;
        min-width: 28px !important; /* أصغر */
        text-align: center;
        margin: 0 !important;
        flex-shrink: 0;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 4px;
        font-weight: 600;
    }


    /* إخفاء الأزرار غير الضرورية */
    #toggleSkipBtns,
    .loop-btn,
    .pip-btn {
        display: none !important;
    }


    /* ===== أيقونة الشاشة الكاملة في الأعلى - مصغرة ===== */
    #fullscreenBtn {
        position: absolute !important;
        top: 10px !important;
        right: 10px !important;
        width: 28px !important;
        height: 28px !important;
        font-size: 0.75rem !important;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.15);
        z-index: 20;
        margin: 0 !important;
    }


    /* إخفاء زر الخروج من الشاشة الكاملة */
    #exitFullscreenBtn {
        display: none !important;
    }


    /* تحسين المسافات والهوامش */
    .video-controls > * {
        margin: 0 !important;
        padding: 0 !important;
    }


    /* منع التكسير */
    .control-buttons {
        flex-wrap: nowrap !important;
        white-space: nowrap !important;
    }


    .left-controls, .right-controls {
        flex-wrap: nowrap !important;
        white-space: nowrap !important;
        overflow: visible !important;
    }
}


/* تحسين للشاشات الصغيرة جداً */
@media (max-width: 480px) {
    .video-controls {
        padding: 6px 10px max(18px, env(safe-area-inset-bottom, 18px)) 10px;
        gap: 6px;
    }


    .control-buttons {
        gap: 2px;
    }


    .left-controls, .right-controls {
        gap: 4px;
    }


    .control-btn {
        width: 30px !important;
        height: 30px !important;
        font-size: 0.8rem !important;
    }


    #playPauseBtn {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.85rem !important;
    }


    /* الخط الزمني - أصغر في الشاشات الصغيرة */
    .time-display {
        font-size: 0.6rem !important; /* أصغر */
        padding: 3px 6px !important;
        min-width: 55px !important; /* أصغر */
        margin: 0 0 0 -8px !important; /* إزاحة أكبر لليسار */
        transform: translateX(-5px); /* إزاحة إضافية */
    }


    .speed-display {
        font-size: 0.6rem !important;
        padding: 3px 6px !important;
        min-width: 26px !important;
    }


    .volume-slider {
        width: 35px;
    }


    /* تصغير أيقونة الشاشة الكاملة أكثر */
    #fullscreenBtn {
        width: 26px !important;
        height: 26px !important;
        font-size: 0.7rem !important;
        top: 8px !important;
        right: 8px !important;
    }
}


/* تحسين للوضع الأفقي */
@media (max-width: 768px) and (orientation: landscape) {
    .video-controls {
        padding: 6px 10px max(15px, env(safe-area-inset-bottom, 15px)) 10px;
        gap: 5px;
    }


    .control-btn {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.75rem !important;
    }


    #playPauseBtn {
        width: 30px !important;
        height: 30px !important;
        font-size: 0.8rem !important;
    }


    /* الخط الزمني - أصغر في الوضع الأفقي */
    .time-display {
        font-size: 0.6rem !important;
        padding: 3px 6px !important;
        min-width: 50px !important;
        margin: 0 0 0 -6px !important;
        transform: translateX(-4px);
    }


    .progress-container {
        height: 3px;
    }


    /* تصغير أيقونة الشاشة الكاملة في الوضع الأفقي */
    #fullscreenBtn {
        width: 24px !important;
        height: 24px !important;
        font-size: 0.65rem !important;
        top: 6px !important;
        right: 6px !important;
    }
}
        .video-wrapper:hover .video-controls,
        .video-wrapper:focus-within .video-controls,
        .video-controls.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* 🆕 شريط التقدم المحسن بتأثيرات متقدمة */
        .progress-bar-container {
            position: relative;
            width: 100%;
            height: 25px;
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            user-select: none;
            touch-action: none;
            direction: ltr;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        .progress-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.1) 50%, 
                transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .progress-container:hover::before {
            opacity: 1;
        }
        
        .progress-container:hover {
            height: 12px;
            transform: scaleY(1.2);
        }
        
        .progress {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.6);
            overflow: hidden;
        }
        
        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.4) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .buffer-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(255, 255, 255, 0.25);
            width: 0%;
            border-radius: 10px;
            z-index: 1;
            transition: width 0.2s ease;
        }
        
        .thumb {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translate(-50%, -50%) scale(0);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            pointer-events: none;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.8), 0 0 0 3px var(--primary-color);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }
        
        .progress-container:hover .thumb,
        .progress-container.dragging .thumb {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .progress-container.dragging .thumb {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.9), 0 0 0 4px var(--accent-color);
        }
        
        .preview-box {
            position: absolute;
            bottom: calc(100% + 15px);
            transform: translateX(-50%);
            width: 120px;
            height: 70px;
            border-radius: 12px;
            overflow: hidden;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .preview-box.active {
            display: flex;
            animation: previewPop 0.3s ease;
        }
        
        @keyframes previewPop {
            0% { transform: translateX(-50%) scale(0.8); opacity: 0; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }
        
        .preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: #011220;
        }
        
        .preview-time {
            position: absolute;
            right: 8px;
            bottom: 6px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 10px;
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
        }
        
        .control-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            transition: var(--transition);
        }
        
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 18px;
            transition: var(--transition);
        }
        
        @media (max-width: 576px) {
            .left-controls, .right-controls {
                gap: 12px;
            }
        }
        
        /* ✅ 🆕 تحسين أزرار التحكم بتأثيرات متقدمة */
        .control-btn {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }
        
        @media (max-width: 576px) {
            .control-btn {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
                border-radius: 12px;
            }
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.2), 
                transparent);
            transition: left 0.6s ease;
        }
        
        .control-btn:hover::before {
            left: 100%;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--accent-color);
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }
        
        .control-btn:active {
            transform: translateY(0) scale(0.95);
        }
        
        .control-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
        }
        
        .time-display {
            color: white;
            font-size: 1rem;
            font-weight: 600;
            white-space: nowrap;
            transition: var(--transition);
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 16px;
            border-radius: 10px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 576px) {
            .time-display {
                font-size: 0.9rem;
                padding: 7px 14px;
            }
        }
        
        .speed-display {
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 16px;
            border-radius: 14px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            touch-action: manipulation;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .speed-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.1), 
                transparent);
            transition: left 0.5s ease;
        }
        
        .speed-display:hover::before {
            left: 100%;
        }
        
        .speed-display:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .volume-slider {
            width: 90px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .volume-slider:hover {
            height: 10px;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            border: 2px solid white;
        }
        
        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.6);
        }
        
        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
        }
        
        .volume-slider::-moz-range-thumb:hover {
            transform: scale(1.3);
        }
        
        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
            transition: var(--transition);
        }
        
        body.fullscreen .side-panel {
            display: none;
        }
        
        /* ✅ 🆕 تحسين بطاقات المعلومات مع تأثيرات متقدمة */
        .info-card, .themes-card, .instructions-card, .playlist-card, 
        .settings-card, .downloads-card, .stats-card, .achievements-card {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .info-card::before, .themes-card::before, .instructions-card::before,
        .playlist-card::before, .settings-card::before, .downloads-card::before,
        .stats-card::before, .achievements-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.4s ease;
            z-index: 2;
        }
        
        .info-card:hover::before, .themes-card:hover::before, .instructions-card:hover::before,
        .playlist-card:hover::before, .settings-card:hover::before, .downloads-card:hover::before,
        .stats-card:hover::before, .achievements-card:hover::before {
            transform: scaleX(1);
        }
        
        .info-card:hover, .themes-card:hover, .instructions-card:hover,
        .playlist-card:hover, .settings-card:hover, .downloads-card:hover,
        .stats-card:hover, .achievements-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            position: relative;
            padding-bottom: 12px;
        }
        
        .card-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .card-title:hover::after {
            width: 80px;
        }
        
        .card-title i {
            font-size: 1.3rem;
        }
        
        .video-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .info-item:hover {
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            padding: 12px 10px;
            transform: translateX(5px);
        }
        
        .info-label {
            font-weight: 700;
            color: var(--text-color);
        }
        
        .themes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        /* ✅ 🆕 تحسين خيارات السمات بتأثيرات متقدمة */
        .theme-option {
            height: 100px;
            border-radius: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
        }
        
        .theme-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .theme-option:hover::before {
            left: 100%;
        }
        
        .theme-option:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .theme-option.active {
            border-color: var(--accent-color);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            transform: translateY(-5px);
        }
        
        .theme-option.active::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0, 0, 0, 0.8);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            animation: bounceIn 0.5s ease;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0); }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .theme-default {
            background: var(--gradient-primary);
        }
        
        .theme-dark {
            background: linear-gradient(135deg, #121212, #3a0ca3);
        }
        
        .theme-blue {
            background: linear-gradient(135deg, #0077b6, #03045e);
        }
        
        .theme-green {
            background: linear-gradient(135deg, #2a9d8f, #264653);
        }
        
        .theme-premium {
            background: var(--gradient-premium);
        }
        
        .instructions-list {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        
        .instruction {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 14px;
            border-radius: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .instruction::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(67, 97, 238, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .instruction:hover::before {
            left: 100%;
        }
        
        .instruction:hover {
            background-color: rgba(0, 0, 0, 0.04);
            transform: translateX(8px);
        }
        
        .instruction i {
            font-size: 1.6rem;
            color: var(--primary-color);
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(67, 97, 238, 0.12);
            border-radius: 14px;
            transition: all 0.3s ease;
        }
        
        .instruction:hover i {
            transform: scale(1.15) rotate(5deg);
            background-color: rgba(67, 97, 238, 0.18);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.2);
        }
        
        /* ✅ 🆕 تحسين قائمة التشغيل بتأثيرات متقدمة */
        .playlist {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 350px;
            overflow-y: auto;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 2px solid transparent;
            overflow: hidden;
        }
        
        .playlist-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(67, 97, 238, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .playlist-item:hover::before {
            left: 100%;
        }
        
        .playlist-item:hover {
            background-color: rgba(0, 0, 0, 0.06);
            transform: translateX(-8px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .playlist-item.active {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.15), rgba(58, 12, 163, 0.08));
            border-right: 4px solid var(--primary-color);
            border-color: var(--primary-color);
            transform: translateX(-5px);
        }


        .playlist-item.offline-available {
            border-left: 4px solid var(--success-color);
        }
        
        .playlist-item.offline-available::before {
            content: '🟢';
            margin-left: 5px;
            font-size: 0.8rem;
        }
        
        .playlist-thumb {
            width: 75px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.18);
            transition: all 0.3s ease;
        }
        
        .playlist-item:hover .playlist-thumb {
            transform: scale(1.1);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
        }
        
        .playlist-info {
            flex: 1;
        }
        
        .playlist-title {
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        .playlist-item:hover .playlist-title {
            color: var(--primary-color);
        }
        
        .playlist-duration {
            font-size: 0.85rem;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .download-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .download-btn.downloaded {
            background: var(--success-color);
        }
        
        .download-btn.downloading {
            background: var(--warning-color);
            color: #000;
        }
        
        .download-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: var(--accent-color);
            border-radius: 0 0 12px 12px;
            transition: width 0.3s ease;
        }
        
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .setting-item:hover {
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            padding: 14px 10px;
        }
        
        .setting-label {
            font-weight: 600;
        }
        
        .setting-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .quality-select {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid #ddd;
            background-color: var(--card-color);
            color: var(--text-color);
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .quality-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .long-press-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            opacity: 0;
            transition: var(--transition);
            pointer-events: none;
            z-index: 10;
        }
        
        .long-press-overlay.active {
            opacity: 1;
        }
        
        .long-press-overlay i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }
        
        .fullscreen-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .fullscreen-overlay i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--accent-color);
        }
        
        .orientation-notice {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
            transition: opacity 0.5s ease;
        }
        
        .orientation-notice i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--accent-color);
        }
        
        .orientation-notice p {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        /* ✅ 🆕 تحسين التذييل بتأثيرات متقدمة */
        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            color: var(--text-color);
            opacity: 0.8;
            width: 100%;
            transition: var(--transition);
            font-weight: 500;
            background: linear-gradient(135deg, var(--card-color), rgba(67, 97, 238, 0.05));
            border-top: 1px solid rgba(0,0,0,0.1);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }
        
        body.fullscreen footer {
            display: none;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .themes-grid {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                flex-wrap: wrap;
            }
            
            .fullscreen-overlay p {
                font-size: 1.2rem;
            }
            
            .preview-box {
                width: 100px;
                height: 60px;
                bottom: calc(100% + 12px);
            }
            
            .thumb {
                width: 16px;
                height: 16px;
            }
            
            .player-container {
                gap: 20px;
            }
            
            .side-panel {
                gap: 15px;
            }
            
            .card-title {
                font-size: 1.2rem;
            }
            
            .quick-stats {
                gap: 15px;
            }
            
            .stat-item {
                padding: 8px 14px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .card-title {
                font-size: 1.1rem;
            }
            
            .instruction i {
                font-size: 1.3rem;
                width: 45px;
                height: 45px;
            }
            
            .info-card, .themes-card, .instructions-card, .playlist-card, 
            .settings-card, .downloads-card, .stats-card, .achievements-card {
                padding: 20px;
            }
            
            .quick-stats {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 768px) and (orientation: portrait) {
            .orientation-notice {
                display: flex;
            }
        }
        
        @media (max-width: 768px) and (orientation: landscape) {
            .orientation-notice {
                display: none;
            }
        }
        
        .speed-menu {
            position: absolute;
            bottom: 55px;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 14px;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 20;
            animation: fadeIn 0.2s ease;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .speed-menu.active {
            display: flex;
        }
        
        .speed-option {
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .speed-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.4s ease;
        }
        
        .speed-option:hover::before {
            left: 100%;
        }
        
        .speed-option:hover, .speed-option.active {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateX(-8px);
        }
        
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 0.8s linear infinite;
            display: none;
            z-index: 5;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 18px 28px;
            border-radius: 14px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 14px;
            animation: slideDown 0.3s ease;
            display: none;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes slideDown {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        .skip-backward, .skip-forward {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
            z-index: 10;
            pointer-events: none;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .skip-backward {
            left: 20px;
            right: auto;
        }
        
        .skip-forward {
            right: 20px;
            left: auto;
        }
        
        .skip-backward.show, .skip-forward.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .video-wrapper:hover .skip-backward.show,
        .video-wrapper:hover .skip-forward.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) and (orientation: landscape) {
            .video-controls {
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
            
            .control-btn {
                width: 42px;
                height: 42px;
            }
            
            .time-display {
                font-size: 0.85rem;
            }
        }
        
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .control-element {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .control-element.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        body.fullscreen .video-controls {
            padding-bottom: max(20px, env(safe-area-inset-bottom, 20px));
        }
        
        body.fullscreen .video-controls.active {
            opacity: 1;
        }
        
        body.fullscreen .control-buttons {
            display: flex !important;
        }
        
        body.fullscreen .left-controls,
        body.fullscreen .right-controls {
            display: flex !important;
        }
        
        .gesture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .gesture-overlay.active {
            opacity: 1;
        }
        
        .gesture-icon {
            font-size: 4rem;
            color: var(--accent-color);
            background: rgba(0, 0, 0, 0.7);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .gesture-text {
            color: white;
            font-size: 1.2rem;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 12px;
        }
        
        .volume-display,
        .brightness-display,
        .playback-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .volume-display.active,
        .brightness-display.active,
        .playback-display.active {
            opacity: 1;
        }
        
        .double-tap-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 15;
        }
        
        .double-tap-overlay.active {
            opacity: 1;
        }
        
        .double-tap-indicator {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 18px 24px;
            border-radius: 12px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            animation: pulse 1s ease;
            backdrop-filter: blur(10px);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .double-tap-indicator i {
            font-size: 1.6rem;
            color: var(--accent-color);
        }
        
        :-webkit-full-screen,
        :-moz-full-screen,
        :-ms-fullscreen,
        :fullscreen {
            width: 100% !important;
            height: 100% !important;
        }
        
        ::-webkit-scrollbar {
            display: none;
        }
        
        body:-webkit-full-screen,
        body:-moz-full-screen,
        body:-ms-fullscreen,
        body:fullscreen {
            overflow: hidden;
        }
        
        body.fullscreen {
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
        }
        
        body.fullscreen .container {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        body.fullscreen .video-section {
            width: 100vw !important;
            height: 100vh !important;
            border-radius: 0 !important;
            margin: 0 !important;
        }
        
        body.fullscreen .video-wrapper {
            width: 100vw !important;
            height: 100vh !important;
            padding-top: 0 !important;
        }
        
        body.fullscreen #videoPlayer {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: contain !important;
        }
        
        @media all and (display-mode: fullscreen) {
            body {
                overflow: hidden;
            }
        }
        
        body.fullscreen {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body.fullscreen ::-webkit-scrollbar {
            display: none;
        }
        
        #exitFullscreenBtn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 1;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        #exitFullscreenBtn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        body.fullscreen #exitFullscreenBtn {
            display: flex;
        }
        
        #toggleSkipBtns {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            touch-action: manipulation;
            backdrop-filter: blur(15px);
        }
        
        #toggleSkipBtns:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--accent-color);
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }
        
        @media (max-width: 576px) {
            #toggleSkipBtns {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
            }
        }
        
        .side-panel {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }
        
        .side-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .side-panel::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }
        
        body.fullscreen .video-controls {
            padding-bottom: max(20px, env(safe-area-inset-bottom, 20px));
        }
        
        .progress-bar-container.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* أنماط الحماية والتشفير */
        .protection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 25;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .protection-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .protection-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .protection-message {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .protection-code {
            display: none;
        }
        
        .protection-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px 18px;
            color: white;
            text-align: center;
            font-size: 1rem;
            width: 250px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
        .protection-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .protection-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .protection-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        /* ✅ الأنماط الجديدة لزر اختيار المحاضرات */
        .protection-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .protection-btn.alternate {
            background: var(--accent-color);
            color: var(--text-color);
        }
        
        .protection-btn.alternate:hover {
            background: #3a86ff;
            color: white;
        }
        
        .lectures-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            flex-direction: column;
            gap: 20px;
            min-width: 400px;
            max-width: 90vw;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .lectures-modal.active {
            display: flex;
        }
        
        .lectures-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .lecture-option {
            padding: 15px;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.02);
        }
        
        .lecture-option:hover {
            border-color: var(--primary-color);
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(-5px);
        }
        
        .lecture-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
        }
        
        .lecture-desc {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }
        
        .watermark {
            position: absolute;
            bottom: 70px;
            right: 25px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.9rem;
            z-index: 5;
            pointer-events: none;
            user-select: none;
        }
        
        .protection-indicator {
            display: none;
        }
        
        .download-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        
        .download-blocker i {
            font-size: 4rem;
            color: #ff6b6b;
            margin-bottom: 20px;
        }
        
        .download-blocker h2 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #ff6b6b;
        }
        
        .download-blocker p {
            font-size: 1.2rem;
            margin-bottom: 10px;
            max-width: 500px;
            line-height: 1.6;
        }
        
        .session-timer {
            display: none;
        }
        
        .domain-check {
            display: none;
        }
        
        .encryption-status {
            display: none;
        }
        
        .key-management {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-color);
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
            flex-direction: column;
            gap: 25px;
            min-width: 450px;
            max-width: 90vw;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .key-management.active {
            display: flex;
        }
        
        .key-input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .key-input {
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: var(--card-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .key-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .key-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .key-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .key-btn.primary {
            background: var(--primary-color);
            color: white;
        }
        
        .key-btn.secondary {
            background: #f8f9fa;
            color: var(--text-color);
            border: 1px solid #ddd;
        }
        
        .key-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .encryption-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .encryption-loader.active {
            display: block;
        }
        
        .security-log {
            display: none;
        }
        
        .token-display {
            display: none;
        }


        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 20;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .error-message i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #ff6b6b;
        }
        
        .retry-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .retry-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .network-status {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .network-status.online {
            background: rgba(76, 175, 80, 0.9);
        }
        
        .network-status.offline {
            background: rgba(244, 67, 54, 0.9);
        }
        
        .notifications-toggle {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .notifications-toggle:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        .notifications-toggle.active {
            background: var(--primary-color);
        }
        
        .downloads-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .download-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.03);
            transition: background-color 0.2s ease;
        }
        
        .download-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .download-item-info {
            flex: 1;
        }
        
        .download-item-title {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .download-item-status {
            font-size: 0.85rem;
            opacity: 0.7;
        }
        
        .download-item-actions {
            display: flex;
            gap: 6px;
        }
        
        .download-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: var(--transition);
        }
        
        .download-action-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        .storage-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 12px;
            font-size: 0.85rem;
        }
        
        .storage-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .storage-used {
            height: 100%;
            background: var(--primary-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }


        /* ✅ أنماط جديدة للعمل بدون إنترنت - تم تحسينها */
        .offline-indicator {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 193, 7, 0.9);
            color: #000;
            padding: 12px 25px;
            border-radius: 12px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
        }
        
        .offline-indicator.active {
            display: flex;
            animation: fadeInOut 2s ease forwards;
        }
        
        .cache-status {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            z-index: 1000;
            display: none;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
        }
        
        .cache-status.active {
            display: block;
            animation: fadeInOut 2s ease forwards;
        }
        
        .service-worker-status {
            position: fixed;
            top: 80px;
            right: 25px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            z-index: 1000;
            display: none;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
        }
        
        .service-worker-status.active {
            display: block;
            animation: fadeInOut 2s ease forwards;
        }


        .offline-video-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            z-index: 5;
            display: none;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
            font-weight: 600;
        }
        
        .offline-video-badge.active {
            display: block;
            animation: fadeInOut 2s ease forwards;
        }


        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }


        /* أنماط جديدة للإشارات المرجعية */
        .bookmarks-panel {
            display: none;
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 12px;
            padding: 15px;
            z-index: 20;
            max-width: 320px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bookmarks-panel.active {
            display: block;
        }
        
        .bookmark-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-3px);
        }
        
        .bookmark-time {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 6px;
        }
        
        .bookmark-action-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .bookmark-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .add-bookmark-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .add-bookmark-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }


        /* ✅ تحسينات إضافية للشاشة الكاملة */
        body.fullscreen .video-controls {
            background: rgba(0, 0, 0, 0.6) !important;
        }


        body.fullscreen .progress-container {
            height: 8px;
        }


        body.fullscreen .progress-container:hover {
            height: 12px;
        }


        /* ✅ تحسينات إضافية لإخفاء الشريط */
        body.fullscreen .video-controls.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }


        body.fullscreen .video-controls:not(.hidden) {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }


        /* ⭐ جديد: أنماط التحذير */
        .cleanup-warning {
            background: rgba(244, 67, 54, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 18px;
            font-size: 0.95rem;
            border-right: 4px solid #f44336;
            color: #d32f2f;
            text-align: center;
            font-weight: 600;
        }


        .cleanup-warning i {
            color: #f44336;
            margin-left: 10px;
        }


        /* ⭐ جديد: شارة الفيديو المتاح بدون إنترنت */
        .offline-badge {
            background: #28a745;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            margin-right: 6px;
            font-weight: 600;
        }


        /* 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 */
        /* 🆕 أنماط نظام الإحصائيات والإنجازات الجديدة */
        /* 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 */


        /* 🆕 شبكة الإحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }


        .stat-card {
            background: linear-gradient(135deg, var(--card-color), rgba(67, 97, 238, 0.05));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }


        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }


        .stat-card:hover::before {
            transform: scaleX(1);
        }


        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }


        .stat-card-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }


        .stat-card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }


        .stat-card-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }


        /* 🆕 مخطط التقدم */
        .progress-chart {
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.08);
        }


        .chart-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }


        .chart-title {
            font-weight: 600;
            color: var(--primary-color);
        }


        .chart-container {
            position: relative;
            height: 120px;
            background: rgba(0,0,0,0.02);
            border-radius: 10px;
            overflow: hidden;
        }


        .chart-bar {
            position: absolute;
            bottom: 0;
            width: 30px;
            background: var(--gradient-primary);
            border-radius: 5px 5px 0 0;
            transition: all 0.5s ease;
        }


        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: var(--text-color);
        }


        /* 🆕 شبكة الإنجازات */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }


        .achievement-card {
            background: var(--card-color);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }


        .achievement-card.locked {
            opacity: 0.6;
            filter: grayscale(1);
        }


        .achievement-card.unlocked {
            border-color: var(--success-color);
            background: linear-gradient(135deg, var(--card-color), rgba(40, 167, 69, 0.05));
        }


        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }


        .achievement-card:hover::before {
            left: 100%;
        }


        .achievement-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }


        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }


        .achievement-card.unlocked .achievement-icon {
            color: var(--success-color);
            animation: bounce 1s ease;
        }


        .achievement-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            background: var(--success-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }


        .achievement-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }


        .achievement-desc {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 10px;
        }


        .achievement-progress {
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
            overflow: hidden;
        }


        .achievement-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
        }


        .achievement-points {
            font-size: 0.7rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-top: 5px;
        }


        /* 🆕 لوحة المتصدرين */
        .leaderboard {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.08);
        }


        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.02);
        }


        .leaderboard-item:hover {
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(5px);
        }


        .leaderboard-rank {
            width: 30px;
            height: 30px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-left: 15px;
        }


        .leaderboard-user {
            flex: 1;
        }


        .leaderboard-name {
            font-weight: 600;
            color: var(--text-color);
        }


        .leaderboard-score {
            font-weight: 700;
            color: var(--primary-color);
        }


        /* 🆕 إشعارات الإنجازات */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-success);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            animation: slideInRight 0.5s ease;
        }


        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }


        .achievement-notification-icon {
            font-size: 2rem;
        }


        .achievement-notification-content {
            flex: 1;
        }


        .achievement-notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }


        .achievement-notification-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }


        /* 🆕 أنيميشن الإنجازات */
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-15px,0);
            }
            70% {
                transform: translate3d(0,-7px,0);
            }
            90% {
                transform: translate3d(0,-3px,0);
            }
        }


        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }


        .achievement-card.unlocked {
            animation: pulse-glow 2s infinite;
        }


        /* تحسينات الاستجابة للشاشات الصغيرة */
        @media (max-width: 768px) {
            .player-container {
                gap: 20px !important;
            }
            
            .side-panel {
                gap: 15px !important;
            }
            
            .card-title {
                font-size: 1.2rem !important;
            }
            
            .control-buttons {
                padding: 10px 15px !important;
            }
            
            .info-card, .themes-card, .instructions-card, 
            .playlist-card, .settings-card, .downloads-card,
            .stats-card, .achievements-card {
                padding: 20px !important;
            }
            
            .protection-actions {
                flex-direction: column;
            }
            
            .lectures-modal {
                min-width: 90vw;
                padding: 20px;
            }


            .stats-grid {
                grid-template-columns: 1fr;
            }


            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }


            .achievement-notification {
                right: 10px;
                left: 10px;
                animation: slideInUp 0.5s ease;
            }


            @keyframes slideInUp {
                from { transform: translateY(100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        }


        @media (max-width: 480px) {
            .achievements-grid {
                grid-template-columns: 1fr;
            }
        }


        /* 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 */
        /* 🆕 الأنماط الجديدة لنظام الأزرار الخارجية */
        /* 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 🆕 */


        .external-controls {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 25px;
            border-radius: 50px;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            gap: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }


        .external-controls.active {
            display: flex;
        }


        .external-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }


        .external-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }


        .external-btn:hover::before {
            left: 100%;
        }


        .external-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.5);
        }


        .external-btn:active {
            transform: scale(0.95);
        }


        .external-btn.active {
            background: var(--accent-color);
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.7);
        }


        /* إخفاء الأزرار الخارجية في الشاشة الكاملة */
        body.fullscreen .external-controls {
            display: none !important;
        }


        /* إظهار الأزرار الخارجية فقط في الهاتف خارج الشاشة الكاملة */
        @media (max-width: 768px) {
            .external-controls {
                display: flex;
            }
            
            body.fullscreen .external-controls {
                display: none;
            }
        }


        @media (max-width: 480px) {
            .external-controls {
                padding: 12px 20px;
                gap: 15px;
                bottom: 20px;
            }
            
            .external-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }


        /* 🆕 أنماط الأكورديون */
        .accordion {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }


        .accordion-item {
            background: var(--card-color);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }


        .accordion-item:last-child {
            border-bottom: none;
        }


        .accordion-header {
            padding: 20px 25px;
            background: var(--card-color);
            border: none;
            width: 100%;
            text-align: right;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
        }


        .accordion-header:hover {
            background: rgba(0,0,0,0.03);
        }


        .accordion-header.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }


        .accordion-header i {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }


        .accordion-header.active i {
            transform: rotate(180deg);
            color: var(--primary-color);
        }


        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: var(--card-color);
        }


        .accordion-content.active {
            max-height: 1000px;
        }


        .accordion-body {
            padding: 0 25px 20px;
        }


        /* تحسينات الشاشة الكاملة للفيديو */
        body.fullscreen #videoPlayer {
            object-fit: contain !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
        }


        body.fullscreen .video-wrapper {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background: #000 !important;
        }


        /* تحسينات للهاتف في الشاشة الكاملة */
        @media (max-width: 768px) and (orientation: landscape) {
            body.fullscreen .video-controls {
                padding: 15px 20px;
            }
            
            body.fullscreen .control-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            
            body.fullscreen .time-display {
                font-size: 0.8rem;
                padding: 6px 12px;
/* ===== تطبيق ترتيب الكمبيوتر العادي في الشاشة الكاملة ===== */
body.fullscreen .video-controls {
    padding: 20px 25px 25px 25px !important;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 50%, transparent 100%) !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 15px !important;
}


body.fullscreen .control-buttons {
    display: flex !important;
    flex-direction: row !important;
    justify-content: space-between !important;
    align-items: center !important;
    width: 100% !important;
    flex-wrap: nowrap !important;
}


body.fullscreen .left-controls {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: 18px !important;
    flex: 1 !important;
    justify-content: flex-start !important;
}


body.fullscreen .right-controls {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: 18px !important;
    flex: 1 !important;
    justify-content: flex-end !important;
}


/* الأيقونات بنفس حجم الكمبيوتر العادي */
body.fullscreen .control-btn {
    width: 48px !important;
    height: 48px !important;
    font-size: 1.3rem !important;
    border-radius: 14px !important;
    background: rgba(255, 255, 255, 0.12) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}


body.fullscreen #playPauseBtn {
    width: 48px !important;
    height: 48px !important;
    font-size: 1.3rem !important;
    background: rgba(67, 97, 238, 0.25) !important;
    border: 1px solid rgba(67, 97, 238, 0.4) !important;
}


/* شريط التقدم */
body.fullscreen .progress-bar-container {
    width: 100% !important;
    margin-bottom: 12px !important;
}


body.fullscreen .progress-container {
    height: 8px !important;
    border-radius: 10px !important;
}


body.fullscreen .progress-container:hover {
    height: 12px !important;
}


/* النصوص والعناصر الأخرى */
body.fullscreen .time-display {
    font-size: 1rem !important;
    padding: 8px 16px !important;
    min-width: 100px !important;
    border-radius: 10px !important;
    background: rgba(0, 0, 0, 0.4) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}


body.fullscreen .speed-display {
    font-size: 0.9rem !important;
    padding: 10px 16px !important;
    min-width: 40px !important;
    border-radius: 14px !important;
    background: rgba(0, 0, 0, 0.5) !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
}


body.fullscreen .volume-slider {
    width: 90px !important;
    height: 6px !important;
}


body.fullscreen .volume-slider:hover {
    height: 10px !important;
}


/* إظهار جميع الأزرار كما في الكمبيوتر العادي */
body.fullscreen #toggleSkipBtns,
body.fullscreen .loop-btn,
body.fullscreen .pip-btn {
    display: flex !important;
}


/* التأكد من إخفاء أي أنماط خاصة بالهاتف */
body.fullscreen .video-controls .control-buttons {
    flex-direction: row !important;
}


body.fullscreen .video-controls .left-controls,
body.fullscreen .video-controls .right-controls {
    flex-direction: row !important;
}
            }
        }
/* ===== الحل القوي لإصلاح إيقونة الشاشة الكاملة ===== */


/* أولاً: إزالة جميع الأنماط الخاطئة */
#fullscreenBtn {
    position: static !important;
    top: auto !important;
    right: auto !important;
    left: auto !important;
    bottom: auto !important;
    margin: 0 !important;
    transform: none !important;
}


/* ثانياً: منع تطبيق أنماط الهاتف على الشاشة الكاملة */
body.fullscreen #fullscreenBtn {
    position: static !important;
    top: auto !important;
    right: auto !important;
    left: auto !important;
    bottom: auto !important;
    margin: 0 !important;
    transform: none !important;
    width: 48px !important;
    height: 48px !important;
    font-size: 1.3rem !important;
}


/* ثالثاً: إصلاح كامل للشاشة الكاملة */
body.fullscreen .video-controls {
    padding: 20px 25px !important;
    flex-direction: column !important;
}


body.fullscreen .control-buttons {
    display: flex !important;
    flex-direction: row !important;
    justify-content: space-between !important;
    width: 100% !important;
}


body.fullscreen .left-controls,
body.fullscreen .right-controls {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: 15px !important;
}


/* رابعاً: إلغاء تام لجميع media queries الخاطئة للشاشة الكاملة */
@media (max-width: 768px) {
    body.fullscreen #fullscreenBtn {
        position: static !important;
        top: auto !important;
        right: auto !important;
        left: auto !important;
        bottom: auto !important;
        margin: 0 !important;
        transform: none !important;
        width: 48px !important;
        height: 48px !important;
        font-size: 1.3rem !important;
    }
    
    body.fullscreen .video-controls {
        padding: 20px 25px !important;
    }
    
    body.fullscreen .control-buttons {
        flex-direction: row !important;
    }
    
    body.fullscreen .left-controls,
    body.fullscreen .right-controls {
        flex-direction: row !important;
        gap: 15px !important;
    }
}


@media (max-width: 480px) {
    body.fullscreen #fullscreenBtn {
        position: static !important;
        margin: 0 !important;
        transform: none !important;
    }
}


@media (max-width: 768px) {
    /* ===== تصميم مصغر جداً بصفين للهاتف ===== */
    
    .video-controls {
        padding: 8px 10px max(15px, env(safe-area-inset-bottom, 15px)) 10px !important;
        flex-direction: column !important;
        gap: 6px !important;
        background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.9) 70%, transparent 100%) !important;
    }


    /* الصف الأول: شريط التقدم */
    .progress-bar-container {
        order: 1 !important;
        margin-bottom: 8px !important;
        width: 100% !important;
        height: 20px !important;
    }


    .progress-container {
        height: 3px !important;
        border-radius: 2px !important;
    }


    .progress-container:hover {
        height: 4px !important;
    }


    /* الصف الثاني: الأيقونات في صف واحد مدمج */
    .control-buttons {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        width: 100% !important;
        gap: 4px !important;
        min-height: 32px !important;
        order: 2 !important;
        flex-wrap: nowrap !important;
        overflow-x: auto !important;
    }


    .left-controls {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 4px !important;
        justify-content: flex-start !important;
        flex: 1 !important;
        order: 1 !important;
        min-width: 0 !important;
        overflow: visible !important;
    }


    .right-controls {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 4px !important;
        justify-content: flex-end !important;
        flex: 1 !important;
        order: 2 !important;
        min-width: 0 !important;
        overflow: visible !important;
    }


    /* تصغير شديد للأيقونات */
    .control-btn {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.7rem !important;
        border-radius: 6px !important;
        margin: 0 !important;
        position: static !important;
        transform: none !important;
        flex-shrink: 0 !important;
        min-width: 28px !important;
    }


    #playPauseBtn {
        width: 30px !important;
        height: 30px !important;
        font-size: 0.8rem !important;
        background: rgba(67, 97, 238, 0.3) !important;
    }


    /* شريط الصوت المصغر */
    .volume-container {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 3px !important;
        margin: 0 !important;
        flex-shrink: 0 !important;
    }


    .volume-slider {
        width: 35px !important;
        height: 2px !important;
        display: block !important;
        margin: 0 !important;
        flex-shrink: 0 !important;
    }


    /* الوقت المصغر */
    .time-display {
        font-size: 0.6rem !important;
        padding: 3px 6px !important;
        min-width: 55px !important;
        margin: 0 !important;
        transform: none !important;
        text-align: center !important;
        flex-shrink: 0 !important;
        background: rgba(0, 0, 0, 0.6) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }


    /* السرعة المصغرة */
    .speed-display {
        font-size: 0.6rem !important;
        padding: 3px 6px !important;
        min-width: 25px !important;
        margin: 0 !important;
        flex-shrink: 0 !important;
        background: rgba(0, 0, 0, 0.6) !important;
    }


    /* زر الشاشة الكاملة المصغر */
    #fullscreenBtn {
        position: static !important;
        top: auto !important;
        right: auto !important;
        width: 28px !important;
        height: 28px !important;
        font-size: 0.7rem !important;
        margin: 0 !important;
        transform: none !important;
        flex-shrink: 0 !important;
    }


    /* إخفاء بعض الأزرار غير الأساسية إذا لزم المساحة */
    .loop-btn,
    .pip-btn {
        display: none !important; /* إخفاء للتوفير في المساحة */
    }


    #toggleSkipBtns {
        display: flex !important; /* إظهار فقط إذا كانت المساحة تسمح */
    }
}
@media (max-width: 480px) {
    .video-controls {
        padding: 6px 8px max(12px, env(safe-area-inset-bottom, 12px)) 8px !important;
        gap: 4px !important;
    }


    .control-buttons {
        gap: 2px !important;
        min-height: 28px !important;
    }


    .left-controls,
    .right-controls {
        gap: 2px !important;
    }


    .control-btn {
        width: 26px !important;
        height: 26px !important;
        font-size: 0.65rem !important;
        border-radius: 5px !important;
        min-width: 26px !important;
    }


    #playPauseBtn {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.75rem !important;
    }


    .time-display {
        font-size: 0.55rem !important;
        padding: 2px 4px !important;
        min-width: 50px !important;
    }


    .volume-slider {
        width: 30px !important;
    }


    .speed-display {
        font-size: 0.55rem !important;
        padding: 2px 4px !important;
        min-width: 22px !important;
    }


    #fullscreenBtn {
        width: 26px !important;
        height: 26px !important;
        font-size: 0.65rem !important;
    }


    /* إخفاء المزيد من الأزرار في الشاشات الصغيرة جداً */
    #toggleSkipBtns {
        display: none !important;
    }
}
@media (max-width: 768px) and (orientation: landscape) {
    .video-controls {
        padding: 5px 8px max(10px, env(safe-area-inset-bottom, 10px)) 8px !important;
        gap: 3px !important;
    }


    .control-btn {
        width: 24px !important;
        height: 24px !important;
        font-size: 0.6rem !important;
    }


    #playPauseBtn {
        width: 26px !important;
        height: 26px !important;
        font-size: 0.7rem !important;
    }


    .time-display {
        font-size: 0.5rem !important;
        padding: 2px 4px !important;
        min-width: 45px !important;
    }


    .volume-slider {
        width: 25px !important;
    }
}
@media (max-width: 768px) {
    /* ===== تحريك الخط الزمني إلى أسفل ===== */
    
    .progress-bar-container {
        order: 1 !important;
        margin-bottom: 1px !important; /* زيادة المسافة من الأسفل */
        width: 100% !important;
        height: 25px !important;
        padding-top: 8px !important; /* إضافة مسافة من الأعلى */
        transform: translateY(5px) !important; /* تحريك لأسفل */
    }
}
@media (max-width: 768px) {
    /* ===== زيادة سمك شريط التقدم ===== */
    
    .progress-container {
        height: 6px !important; /* زيادة السمك من 3px إلى 6px */
        border-radius: 3px !important;
    }


    .progress-container:hover {
        height: 8px !important; /* زيادة السمك عند التمرير */
    }


    /* زيادة حجم الإبهام (الزر المتحرك) */
    .thumb {
        width: 16px !important;
        height: 16px !important;
    }


    .progress-container:hover .thumb,
    .progress-container.dragging .thumb {
        width: 18px !important;
        height: 18px !important;
    }
}
/* ===== إحصائيات محسنة مع عداد متحرك ===== */
.quick-stats {
    display: flex !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 10px !important;
    width: 100% !important;
    max-width: 450px !important;
    margin: 0 auto !important;
    flex-wrap: nowrap !important;
}


.stat-item {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)) !important;
    padding: 10px 12px !important;
    border-radius: 12px !important;
    backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    flex: 1 !important;
    min-width: 0 !important;
    justify-content: center !important;
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
}


.stat-item::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: -100% !important;
    width: 100% !important;
    height: 100% !important;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent) !important;
    transition: left 0.6s ease !important;
}


.stat-item:hover::before {
    left: 100% !important;
}


.stat-item:hover {
    transform: translateY(-3px) scale(1.05) !important;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
}


.stat-icon {
    font-size: 1rem !important;
    color: var(--accent-color) !important;
    flex-shrink: 0 !important;
    transition: all 0.3s ease !important;
}


.stat-item:hover .stat-icon {
    transform: scale(1.2) rotate(5deg) !important;
    color: #4cc9f0 !important;
}


.stat-info {
    display: flex !important;
    flex-direction: column !important;
    gap: 2px !important;
    min-width: 0 !important;
    flex: 1 !important;
}


.stat-value {
    font-weight: 800 !important;
    font-size: 0.9rem !important;
    color: white !important;
    line-height: 1 !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
    transition: all 0.3s ease !important;
}


.stat-value.animated {
    animation: countUp 0.8s ease-out !important;
}


.stat-label {
    font-size: 0.7rem !important;
    opacity: 0.9 !important;
    color: rgba(255, 255, 255, 0.9) !important;
    line-height: 1 !important;
    font-weight: 600 !important;
}


/* أنيميشن العداد */
@keyframes countUp {
    0% {
        transform: scale(0.8) !important;
        opacity: 0 !important;
    }
    50% {
        transform: scale(1.1) !important;
    }
    100% {
        transform: scale(1) !important;
        opacity: 1 !important;
    }
}


@keyframes pulseGlow {
    0% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7) !important;
    }
    70% {
        box-shadow: 0 0 0 6px rgba(76, 201, 240, 0) !important;
    }
    100% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0) !important;
    }
}


.stat-item.highlight {
    animation: pulseGlow 1s ease !important;
}


/* تأثير الوميض للقيم الجديدة */
@keyframes flash {
    0%, 100% {
        background-color: transparent !important;
    }
    50% {
        background-color: rgba(76, 201, 240, 0.3) !important;
    }
}


.stat-value.flash {
    animation: flash 0.5s ease !important;
    border-radius: 4px !important;
}
/* تحسينات للشاشات الصغيرة */
@media (max-width: 768px) {
    .quick-stats {
        gap: 8px !important;
        max-width: 380px !important;
    }
    
    .stat-item {
        padding: 8px 10px !important;
        gap: 6px !important;
        border-radius: 10px !important;
    }
    
    .stat-icon {
        font-size: 0.9rem !important;
    }
    
    .stat-value {
        font-size: 0.8rem !important;
    }
    
    .stat-label {
        font-size: 0.65rem !important;
    }
}


/* تأثيرات خاصة للمستوى */
#userLevel {
    background: linear-gradient(135deg, #ffd700, #ff6b00) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}


.stat-item:nth-child(4) { /* عنصر المستوى */
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 0, 0.1)) !important;
    border-color: rgba(255, 215, 0, 0.3) !important;
}
/* ================================================== */
/* ===== المظاهر الجمالية والاحترافية للموقع ===== */
/* ================================================== */


/* 1. تحسينات الشريط العلوي (Header) */
header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
    position: relative !important;
    overflow: hidden !important;
}


header::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: 
        radial-gradient(circle at 20% 80%, rgba(76, 201, 240, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(58, 12, 163, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(67, 97, 238, 0.15) 0%, transparent 50%) !important;
    animation: float 6s ease-in-out infinite !important;
}


@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(1deg); }
}


.header-top {
    position: relative !important;
    z-index: 2 !important;
}


h1 {
    background: linear-gradient(135deg, #ffffff, #e3f2fd) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
    text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
    animation: glow 3s ease-in-out infinite alternate !important;
}


@keyframes glow {
    from { text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); }
    to { text-shadow: 0 4px 25px rgba(76, 201, 240, 0.5), 0 4px 15px rgba(0, 0, 0, 0.3); }
}


/* 2. تأثيرات البطاقات (Cards) */
.info-card, .themes-card, .instructions-card, 
.playlist-card, .settings-card, .downloads-card,
.stats-card, .achievements-card {
    background: linear-gradient(135deg, var(--card-color), rgba(255, 255, 255, 0.1)) !important;
    backdrop-filter: blur(20px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    position: relative !important;
    overflow: hidden !important;
}


.card-title {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color)) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}


.card-title::after {
    background: linear-gradient(90deg, var(--primary-color), var(--accent-color)) !important;
    width: 60px !important;
}


.card-title:hover::after {
    width: 100px !important;
}


/* 3. تأثيرات الأزرار */
.control-btn, .download-btn, .key-btn.primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
    border: none !important;
    box-shadow: 
        0 4px 15px rgba(67, 97, 238, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    position: relative !important;
    overflow: hidden !important;
}


.control-btn::after {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: -100% !important;
    width: 100% !important;
    height: 100% !important;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent) !important;
    transition: left 0.5s ease !important;
}


.control-btn:hover::after {
    left: 100% !important;
}


.control-btn:hover {
    transform: translateY(-2px) !important;
    box-shadow: 
        0 8px 25px rgba(67, 97, 238, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
}


/* 4. تأثيرات الفيديو والتحكم */
.video-section {
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.1) !important;
    border-radius: 20px !important;
    overflow: hidden !important;
}


.video-section::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: linear-gradient(45deg, transparent 30%, rgba(76, 201, 240, 0.1) 100%) !important;
    pointer-events: none !important;
    z-index: 1 !important;
}


.progress-container {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}


.progress {
    background: linear-gradient(90deg, var(--accent-color), var(--primary-color)) !important;
    box-shadow: 0 0 20px rgba(76, 201, 240, 0.6) !important;
}


/* 5. تأثيرات التحميل والتحميل المسبق */
.loading-spinner {
    border: 3px solid rgba(255, 255, 255, 0.3) !important;
    border-top: 3px solid var(--accent-color) !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
    box-shadow: 0 0 20px rgba(76, 201, 240, 0.5) !important;
}


@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}


/* تأثير عند تحميل الفيديو */
.video-wrapper::before {
    content: '' !important;
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 60px !important;
    height: 60px !important;
    background: rgba(0, 0, 0, 0.7) !important;
    border-radius: 50% !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
    z-index: 4 !important;
}


.video-wrapper.loading::before {
    opacity: 1 !important;
}


/* 6. تأثيرات التنقل والتفاعل */
.accordion-header {
    background: linear-gradient(135deg, var(--card-color), rgba(255, 255, 255, 0.05)) !important;
    border: none !important;
    backdrop-filter: blur(10px) !important;
    transition: all 0.3s ease !important;
}


.accordion-header:hover {
    background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(76, 201, 240, 0.05)) !important;
    transform: translateX(-5px) !important;
}


.accordion-header.active {
    background: linear-gradient(135deg, rgba(67, 97, 238, 0.15), rgba(76, 201, 240, 0.1)) !important;
}


/* تأثيرات قائمة التشغيل */
.playlist-item {
    background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.03)) !important;
    border: 1px solid transparent !important;
    transition: all 0.3s ease !important;
}


.playlist-item:hover {
    background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(76, 201, 240, 0.05)) !important;
    border-color: rgba(67, 97, 238, 0.3) !important;
    transform: translateX(-8px) !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
}


/* 7. تأثيرات النصوص والظلال */
body {
    text-rendering: optimizeLegibility !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
}


.subtitle {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}


/* تأثيرات الظلال المحسنة */
.video-section, .info-card, .themes-card {
    box-shadow: 
        0 10px 40px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
}


/* 8. تأثيرات الخلفية المتحركة */
body::before {
    content: '' !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background: 
        radial-gradient(circle at 15% 50%, rgba(67, 97, 238, 0.1) 0%, transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(76, 201, 240, 0.1) 0%, transparent 25%),
        radial-gradient(circle at 50% 80%, rgba(58, 12, 163, 0.1) 0%, transparent 25%) !important;
    animation: backgroundShift 20s ease-in-out infinite !important;
    pointer-events: none !important;
    z-index: -1 !important;
}


@keyframes backgroundShift {
    0%, 100% { 
        transform: scale(1) rotate(0deg);
        opacity: 0.7;
    }
    33% { 
        transform: scale(1.1) rotate(1deg);
        opacity: 0.8;
    }
    66% { 
        transform: scale(1.05) rotate(-1deg);
        opacity: 0.75;
    }
}


/* 9. تأثيرات الإشعارات المحسنة */
.notification {
    background: linear-gradient(135deg, rgba(33, 150, 243, 0.95), rgba(25, 118, 210, 0.95)) !important;
    backdrop-filter: blur(20px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}


.achievement-notification {
    background: linear-gradient(135deg, #28a745, #20c997) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 15px 35px rgba(40, 167, 69, 0.3) !important;
}


/* 10. إحصائيات محسنة مع عداد متحرك */
.quick-stats {
    display: flex !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 10px !important;
    width: 100% !important;
    max-width: 450px !important;
    margin: 0 auto !important;
    flex-wrap: nowrap !important;
}


.stat-item {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)) !important;
    padding: 10px 12px !important;
    border-radius: 12px !important;
    backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    flex: 1 !important;
    min-width: 0 !important;
    justify-content: center !important;
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
}


.stat-item::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: -100% !important;
    width: 100% !important;
    height: 100% !important;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent) !important;
    transition: left 0.6s ease !important;
}


.stat-item:hover::before {
    left: 100% !important;
}


.stat-item:hover {
    transform: translateY(-3px) scale(1.05) !important;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
}


.stat-icon {
    font-size: 1rem !important;
    color: var(--accent-color) !important;
    flex-shrink: 0 !important;
    transition: all 0.3s ease !important;
}


.stat-item:hover .stat-icon {
    transform: scale(1.2) rotate(5deg) !important;
    color: #4cc9f0 !important;
}


.stat-info {
    display: flex !important;
    flex-direction: column !important;
    gap: 2px !important;
    min-width: 0 !important;
    flex: 1 !important;
}


.stat-value {
    font-weight: 800 !important;
    font-size: 0.9rem !important;
    color: white !important;
    line-height: 1 !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
    transition: all 0.3s ease !important;
}


.stat-value.animated {
    animation: countUp 0.8s ease-out !important;
}


.stat-label {
    font-size: 0.7rem !important;
    opacity: 0.9 !important;
    color: rgba(255, 255, 255, 0.9) !important;
    line-height: 1 !important;
    font-weight: 600 !important;
}


/* أنيميشن العداد */
@keyframes countUp {
    0% {
        transform: scale(0.8) !important;
        opacity: 0 !important;
    }
    50% {
        transform: scale(1.1) !important;
    }
    100% {
        transform: scale(1) !important;
        opacity: 1 !important;
    }
}


@keyframes pulseGlow {
    0% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7) !important;
    }
    70% {
        box-shadow: 0 0 0 6px rgba(76, 201, 240, 0) !important;
    }
    100% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0) !important;
    }
}


.stat-item.highlight {
    animation: pulseGlow 1s ease !important;
}


/* تأثير الوميض للقيم الجديدة */
@keyframes flash {
    0%, 100% {
        background-color: transparent !important;
    }
    50% {
        background-color: rgba(76, 201, 240, 0.3) !important;
    }
}


.stat-value.flash {
    animation: flash 0.5s ease !important;
    border-radius: 4px !important;
}


/* تأثيرات خاصة للمستوى */
#userLevel {
    background: linear-gradient(135deg, #ffd700, #ff6b00) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}


.stat-item:nth-child(4) { /* عنصر المستوى */
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 0, 0.1)) !important;
    border-color: rgba(255, 215, 0, 0.3) !important;
}


/* ===== نهاية المظاهر الجمالية ===== */
 
/* ===== تصغير زر الشاشة الكاملة في وضع الشاشة الكاملة للكمبيوتر ===== */


body.fullscreen #fullscreenBtn {
    width: 44px !important;
    height: 44px !important;
    font-size: 1.1rem !important;
}


/* التأكد من أن جميع الأزرار بنفس الحجم في الشاشة الكاملة */
body.fullscreen .control-btn {
    width: 44px !important;
    height: 44px !important;
    font-size: 1.1rem !important;
}


body.fullscreen #playPauseBtn {
    width: 46px !important;
    height: 46px !important;
    font-size: 1.2rem !important;
}
/* ===== إزالة زر الخروج من الشاشة الكاملة ===== */
#exitFullscreenBtn {
    display: none !important;
}
/* تحسينات شريط الإحصائيات - إصدار منظم */
.quick-stats {
    display: flex !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: stretch !important;
    gap: 12px !important;
    width: 100% !important;
    max-width: 500px !important;
    margin: 20px auto 0 auto !important;
    flex-wrap: nowrap !important;
    padding: 0 10px !important;
}


.stat-item {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 6px !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.08)) !important;
    padding: 12px 8px !important;
    border-radius: 16px !important;
    backdrop-filter: blur(20px) !important;
    border: 1.5px solid rgba(255, 255, 255, 0.25) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    flex: 1 !important;
    min-width: 0 !important;
    min-height: 80px !important;
    text-align: center !important;
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}


.stat-item::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: -100% !important;
    width: 100% !important;
    height: 100% !important;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.25), 
        transparent) !important;
    transition: left 0.7s ease !important;
    z-index: 1 !important;
}


.stat-item:hover::before {
    left: 100% !important;
}


.stat-item:hover {
    transform: translateY(-4px) scale(1.03) !important;
    box-shadow: 
        0 12px 30px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}


.stat-icon {
    font-size: 1.3rem !important;
    color: var(--accent-color) !important;
    transition: all 0.3s ease !important;
    z-index: 2 !important;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) !important;
}


.stat-item:hover .stat-icon {
    transform: scale(1.15) rotate(5deg) !important;
    color: #4cc9f0 !important;
    filter: drop-shadow(0 3px 6px rgba(76, 201, 240, 0.4)) !important;
}


.stat-info {
    display: flex !important;
    flex-direction: column !important;
    gap: 3px !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 0 !important;
    width: 100% !important;
    z-index: 2 !important;
}


.stat-value {
    font-weight: 800 !important;
    font-size: 1.1rem !important;
    color: white !important;
    line-height: 1.1 !important;
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4) !important;
    transition: all 0.3s ease !important;
    letter-spacing: -0.5px !important;
    font-family: 'Cairo', sans-serif !important;
    min-height: 1.2em !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
}


.stat-value.animated {
    animation: countUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) !important;
}


.stat-label {
    font-size: 0.75rem !important;
    opacity: 0.95 !important;
    color: rgba(255, 255, 255, 0.95) !important;
    line-height: 1.2 !important;
    font-weight: 600 !important;
    letter-spacing: -0.2px !important;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) !important;
    font-family: 'Cairo', sans-serif !important;
    min-height: 1.2em !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
}


/* أنيميشن العداد المحسّن */
@keyframes countUp {
    0% {
        transform: scale(0.8) !important;
        opacity: 0 !important;
    }
    50% {
        transform: scale(1.1) !important;
    }
    100% {
        transform: scale(1) !important;
        opacity: 1 !important;
    }
}


@keyframes pulseGlow {
    0% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7) !important;
    }
    70% {
        box-shadow: 0 0 0 8px rgba(76, 201, 240, 0) !important;
    }
    100% {
        box-shadow: 0 0 0 0 rgba(76, 201, 240, 0) !important;
    }
}


.stat-item.highlight {
    animation: pulseGlow 1.2s ease !important;
}


/* تأثير الوميض للقيم الجديدة */
@keyframes flash {
    0%, 100% {
        background-color: transparent !important;
    }
    50% {
        background-color: rgba(76, 201, 240, 0.3) !important;
    }
}


.stat-value.flash {
    animation: flash 0.6s ease !important;
    border-radius: 6px !important;
    padding: 2px 4px !important;
}


/* تأثيرات خاصة للمستوى */
#userLevel {
    background: linear-gradient(135deg, #ffd700, #ff6b00) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
    text-shadow: none !important;
}


.stat-item:nth-child(4) {
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.25), 
        rgba(255, 107, 0, 0.15)) !important;
    border-color: rgba(255, 215, 0, 0.4) !important;
}


.stat-item:nth-child(4) .stat-icon {
    color: #ffd700 !important;
}


/* تحسينات للشاشات المتوسطة */
@media (max-width: 1024px) {
    .quick-stats {
        max-width: 480px !important;
        gap: 10px !important;
    }
    
    .stat-item {
        padding: 10px 6px !important;
        min-height: 75px !important;
    }
    
    .stat-icon {
        font-size: 1.2rem !important;
    }
    
    .stat-value {
        font-size: 1rem !important;
    }
    
    .stat-label {
        font-size: 0.72rem !important;
    }
}


/* تحسينات للهواتف */
@media (max-width: 768px) {
    .quick-stats {
        max-width: 100% !important;
        gap: 8px !important;
        padding: 0 5px !important;
        flex-wrap: wrap !important;
    }
    
    .stat-item {
        flex: 0 0 calc(50% - 6px) !important;
        min-height: 70px !important;
        padding: 10px 5px !important;
        border-radius: 14px !important;
    }
    
    .stat-icon {
        font-size: 1.1rem !important;
    }
    
    .stat-value {
        font-size: 0.95rem !important;
        font-weight: 700 !important;
    }
    
    .stat-label {
        font-size: 0.7rem !important;
    }
}


/* تحسينات للشاشات الصغيرة جداً */
@media (max-width: 480px) {
    .quick-stats {
        gap: 6px !important;
    }
    
    .stat-item {
        flex: 0 0 calc(50% - 4px) !important;
        min-height: 65px !important;
        padding: 8px 4px !important;
        border-radius: 12px !important;
    }
    
    .stat-icon {
        font-size: 1rem !important;
    }
    
    .stat-value {
        font-size: 0.9rem !important;
    }
    
    .stat-label {
        font-size: 0.65rem !important;
    }
}


/* تحسينات للوضع الأفقي في الهواتف */
@media (max-width: 768px) and (orientation: landscape) {
    .quick-stats {
        max-width: 400px !important;
        gap: 6px !important;
    }
    
    .stat-item {
        min-height: 60px !important;
        padding: 6px 4px !important;
    }
    
    .stat-icon {
        font-size: 0.9rem !important;
    }
    
    .stat-value {
        font-size: 0.85rem !important;
    }
    
    .stat-label {
        font-size: 0.6rem !important;
    }
}


/* تحسينات إضافية للتنظيم */
.stat-item:nth-child(1) { order: 1; } /* فيديو شوهد */
.stat-item:nth-child(2) { order: 2; } /* وقت المشاهدة */
.stat-item:nth-child(3) { order: 3; } /* إنجاز مكتمل */
.stat-item:nth-child(4) { order: 4; } /* المستوى */


/* ضمان محاذاة متناسقة */
.quick-stats > * {
    flex-shrink: 0 !important;
}


/* تحسينات للأداء */
@media (prefers-reduced-motion: reduce) {
    .stat-item {
        transition: none !important;
    }
    
    .stat-item::before {
        display: none !important;
    }
    
    .stat-item:hover {
        transform: none !important;
    }
    
    .stat-value.animated {
        animation: none !important;
    }
}


/* دعم الألوان المخصصة للثيمات */
[data-theme="dark"] .stat-item {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.15), 
        rgba(255, 255, 255, 0.05)) !important;
}


[data-theme="blue"] .stat-item {
    background: linear-gradient(135deg, 
        rgba(0, 119, 182, 0.2), 
        rgba(3, 4, 94, 0.1)) !important;
}


[data-theme="green"] .stat-item {
    background: linear-gradient(135deg, 
        rgba(42, 157, 143, 0.2), 
        rgba(38, 70, 83, 0.1)) !important;
}


[data-theme="premium"] .stat-item {
    background: linear-gradient(135deg, 
        rgba(111, 66, 193, 0.2), 
        rgba(232, 62, 140, 0.1)) !important;
}
/* ===== إصلاح كامل للشاشة الكاملة على الهاتف ===== */
@media (max-width: 768px) {
    body.fullscreen {
        padding: 0 !important;
        margin: 0 !important;
        overflow: hidden !important;
        width: 100vw !important;
        height: 100vh !important;
        position: fixed !important;
    }
    
    body.fullscreen .container {
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 0 !important;
        display: flex !important;
        flex-direction: column !important;
    }
    
    body.fullscreen .video-section {
        width: 100vw !important;
        height: 100vh !important;
        border-radius: 0 !important;
        margin: 0 !important;
        flex: 1 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background: #000 !important;
    }
    
    body.fullscreen .video-wrapper {
        width: 100% !important;
        height: 100% !important;
        padding-top: 0 !important;
        position: relative !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }
    
    body.fullscreen #videoPlayer {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
        position: relative !important;
        max-width: 100vw !important;
        max-height: 100vh !important;
    }
    
    /* إصلاح التحكم في الشاشة الكاملة */
    body.fullscreen .video-controls {
        position: absolute !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 50%, transparent 100%) !important;
        padding: 15px 20px max(20px, env(safe-area-inset-bottom)) 20px !important;
        z-index: 1000 !important;
    }
    
    /* إصلاح الأزرار في الشاشة الكاملة */
    body.fullscreen .control-btn {
        width: 44px !important;
        height: 44px !important;
        font-size: 1.2rem !important;
    }
    
    body.fullscreen #playPauseBtn {
        width: 46px !important;
        height: 46px !important;
        font-size: 1.3rem !important;
    }
    
    /* إخفاء العناصر غير الضرورية */
    body.fullscreen header,
    body.fullscreen .side-panel,
    body.fullscreen footer {
        display: none !important;
    }
}


/* إصلاح خاص للوضع الأفقي على الهاتف */
@media (max-width: 768px) and (orientation: landscape) {
    body.fullscreen .video-controls {
        padding: 10px 15px max(15px, env(safe-area-inset-bottom)) 15px !important;
    }
    
    body.fullscreen .control-btn {
        width: 40px !important;
        height: 40px !important;
        font-size: 1.1rem !important;
    }
    
    body.fullscreen .time-display {
        font-size: 0.8rem !important;
        padding: 6px 12px !important;
    }
}


/* منع التكبير التلقائي على الهاتف */
@viewport {
    width: device-width;
    zoom: 1.0;
    user-zoom: fixed;
}


/* تحسينات للأجهزة ذات الشقوق (Notch) */
@media (max-width: 768px) {
    .video-wrapper {
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        position: relative;
    }
    
    #videoPlayer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    /* دعم safe areas للهواتف الحديثة */
    body.fullscreen .video-controls {
        padding-left: max(20px, env(safe-area-inset-left));
        padding-right: max(20px, env(safe-area-inset-right));
    }
}
/* إصلاح إخفاء عناصر التحكم التلقائي */
.video-controls {
    transition: all 0.3s ease;
}


.video-controls.hidden {
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
    transform: translateY(100%) !important;
}


/* تحسينات للشاشة الكاملة */
body.fullscreen .video-controls {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}


body.fullscreen .video-controls.hidden {
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translateY(100%) !important;
}
/* تحسينات للشاشات الصغيرة */
@media (max-width: 768px) {
    .video-controls {
        padding-bottom: max(20px, env(safe-area-inset-bottom)) !important;
    }
    
    .video-controls.hidden {
        transform: translateY(120%) !important;
    }
}


/* منع الاهتزاز في الرسوم المتحركة */
.video-controls {
    will-change: transform, opacity;
}


/* تحسين أداء الشريط */
.progress-container {
    transform: translateZ(0);
}
/* أنماط محتوى الفيديو التعليمي */
.video-content {
    background: linear-gradient(135deg, var(--card-color), rgba(255, 255, 255, 0.05));
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}


.content-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    margin-bottom: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border-right: 4px solid var(--primary-color);
    transition: all 0.3s ease;
}


.content-item:hover {
    background: rgba(67, 97, 238, 0.1);
    transform: translateX(-5px);
}


.content-icon {
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.1rem;
    flex-shrink: 0;
}


.content-details {
    flex: 1;
}


.content-title {
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 5px;
    font-size: 1rem;
}


.content-desc {
    color: var(--text-color);
    opacity: 0.8;
    font-size: 0.9rem;
    line-height: 1.4;
}


.content-time {
    background: rgba(67, 97, 238, 0.1);
    color: var(--primary-color);
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}


.content-time:hover {
    background: var(--primary-color);
    color: white;
}


/* أنماط مواد التحميل */
.materials-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}


.material-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}


.material-item:hover {
    background: rgba(76, 201, 240, 0.1);
    border-color: var(--accent-color);
}


.material-info {
    display: flex;
    align-items: center;
    gap: 12px;
}


.material-icon {
    width: 35px;
    height: 35px;
    background: var(--gradient-success);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
}


.material-details h5 {
    margin: 0;
    color: var(--text-color);
    font-size: 0.95rem;
}


.material-details span {
    color: var(--text-color);
    opacity: 0.7;
    font-size: 0.8rem;
}


.download-material {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}


.download-material:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
}


/* أنماط الاختبارات */
.quiz-container {
    background: linear-gradient(135deg, var(--card-color), rgba(255, 255, 255, 0.03));
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}


.quiz-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}


.stat-badge {
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
    border: 1px solid rgba(255, 215, 0, 0.3);
}


.quiz-progress {
    margin-bottom: 25px;
}


.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
}


.progress-fill {
    height: 100%;
    background: var(--gradient-primary);
    border-radius: 4px;
    transition: width 0.3s ease;
}


.progress-text {
    font-size: 0.85rem;
    color: var(--text-color);
    opacity: 0.8;
    text-align: center;
    display: block;
}


.quiz-questions {
    margin-bottom: 25px;
}


.question-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
}


.question-text {
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 15px;
    font-size: 1rem;
    line-height: 1.5;
}


.options-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}


.option-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.03);
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}


.option-item:hover {
    background: rgba(67, 97, 238, 0.1);
    border-color: var(--primary-color);
}


.option-item.selected {
    background: rgba(67, 97, 238, 0.15);
    border-color: var(--primary-color);
}


.option-item.correct {
    background: rgba(40, 167, 69, 0.15);
    border-color: #28a745;
}


.option-item.incorrect {
    background: rgba(220, 53, 69, 0.15);
    border-color: #dc3545;
}


.option-marker {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
    flex-shrink: 0;
}


.option-item.selected .option-marker {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}


.option-text {
    flex: 1;
    color: var(--text-color);
}


.quiz-actions {
    display: flex;
    gap: 10px;
    justify-content: space-between;
}


.quiz-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}


.quiz-btn.primary {
    background: var(--primary-color);
    color: white;
}


.quiz-btn.secondary {
    background: rgba(0, 0, 0, 0.1);
    color: var(--text-color);
}


.quiz-btn.success {
    background: var(--success-color);
    color: white;
}


.quiz-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}


.quiz-btn:not(:disabled):hover {
    transform: translateY(-2px);
}


.quiz-results {
    background: rgba(40, 167, 69, 0.1);
    border: 1px solid rgba(40, 167, 69, 0.3);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
}


.result-icon {
    font-size: 3rem;
    color: #28a745;
    margin-bottom: 15px;
}


.result-score {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 10px;
}


.result-message {
    color: var(--text-color);
    opacity: 0.8;
    margin-bottom: 20px;
}


.result-details {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
}


.detail-item {
    text-align: center;
}


.detail-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}


.detail-label {
    font-size: 0.8rem;
    color: var(--text-color);
    opacity: 0.7;
}


/* تحسينات للشاشات الصغيرة */
@media (max-width: 768px) {
    .quiz-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .quiz-actions {
        flex-direction: column;
    }
    
    .material-item {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    
    .content-item {
        flex-direction: column;
        text-align: center;
    }
    
    .content-time {
        align-self: center;
    }
}
/* أنماط اختيار الاختبار */
.quiz-selection-message {
    background: linear-gradient(135deg, var(--card-color), rgba(67, 97, 238, 0.05));
    border: 2px dashed var(--primary-color);
    border-radius: 15px;
    margin-bottom: 1.5rem;
}


.quiz-type-content {
    animation: fadeInUp 0.6s ease;
}


.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: var(--primary-color);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    text-decoration: none;
    gap: 8px;
}


.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
}


.btn-outline {
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
}


.btn-outline:hover {
    background: var(--primary-color);
    color: white;
}
/* إضافة هذه الأنماط إلى قسم CSS الموجود */


.video-content {
    max-height: 400px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary-color) transparent;
    padding-right: 5px;
}


.video-content::-webkit-scrollbar {
    width: 6px;
}


.video-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}


.video-content::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 3px;
}


.video-content::-webkit-scrollbar-thumb:hover {
    background: var(--secondary-color);
}


/* تحسينات للشاشات الصغيرة */
@media (max-width: 768px) {
    .video-content {
        max-height: 300px;
    }
}


/* تأثيرات السحب */
.video-content {
    -webkit-overflow-scrolling: touch; /* للسحب السلس على iOS */
    scroll-behavior: smooth;
}


.content-item {
    transition: transform 0.2s ease;
}


.content-item:hover {
    transform: translateX(-5px);
}
.tasks-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 10px;
    width: 100%;
}


.task-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    background: rgba(67, 97, 238, 0.1);
    border: 1px solid rgba(67, 97, 238, 0.2);
    border-radius: 8px;
    color: var(--text-color);
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
}


.task-btn:hover {
    background: rgba(67, 97, 238, 0.2);
    transform: translateX(-5px);
    border-color: var(--primary-color);
}


.task-btn.basic {
    background: rgba(255, 193, 7, 0.1);
    border-color: rgba(255, 193, 7, 0.3);
}


.task-btn.basic:hover {
    background: rgba(255, 193, 7, 0.2);
    border-color: var(--accent-color);
}


.task-btn i {
    color: var(--primary-color);
}


.task-btn.basic i {
    color: var(--accent-color);
}


.material-item {
    display: flex;
    flex-direction: column;
    gap: 15px;
}
 
    </style>
</head>
<body class="no-select">
    <!-- 🆕 الأزرار الخارجية للهاتف -->
    <div class="external-controls" id="externalControls">
        <button class="external-btn" id="externalPlayPause">
            <i class="fas fa-play"></i>
        </button>
        <button class="external-btn" id="externalVolume">
            <i class="fas fa-volume-up"></i>
        </button>
        <button class="external-btn" id="externalSpeed">
            <i class="fas fa-forward"></i>
        </button>
        <button class="external-btn" id="externalFullscreen">
            <i class="fas fa-expand"></i>
        </button>
    </div>


    <!-- مؤشرات العمل بدون إنترنت - تم تحسينها -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>جاري العمل بدون اتصال إنترنت</span>
    </div>
    
    <div class="cache-status" id="cacheStatus">
        <i class="fas fa-database"></i>
        <span>جاري التشغيل من الذاكرة المؤقتة</span>
    </div>
    
    <div class="service-worker-status" id="serviceWorkerStatus">
        <i class="fas fa-cog fa-spin"></i>
        <span>جاري تحميل الخدمة...</span>
    </div>


    <!-- 🆕 إشعار الإنجازات -->
    <div class="achievement-notification" id="achievementNotification">
        <div class="achievement-notification-icon">
            <i class="fas fa-trophy"></i>
        </div>
        <div class="achievement-notification-content">
            <div class="achievement-notification-title" id="achievementNotifTitle">إنجاز جديد!</div>
            <div class="achievement-notification-desc" id="achievementNotifDesc">لقد كسبت إنجازاً جديداً</div>
        </div>
        <button class="control-btn" onclick="hideAchievementNotification()">
            <i class="fas fa-times"></i>
        </button>
    </div>


    <!-- عناصر الحماية والتشفير -->
    <div class="protection-overlay" id="protectionOverlay">
        <i class="fas fa-shield-alt protection-icon"></i>
        <div class="protection-message" id="protectionMessage">
            يرجى إدخال كلمة المرور لمشاهدة هذا المحتوى
        </div>
        <div class="protection-code" id="protectionCode">----</div>
        <input type="password" class="protection-input" id="protectionInput" placeholder="أدخل كلمة المرور">
        
        <!-- ✅ الزر الجديد: اختيار محاضرة أخرى -->
        <div class="protection-actions">
            <button class="protection-btn" id="protectionBtn">تأكيد</button>
            <button class="protection-btn alternate" id="chooseOtherLectureBtn">
                <i class="fas fa-list"></i> اختيار محاضرة أخرى
            </button>
        </div>
    </div>
    
    <!-- ✅ النافذة الجديدة: اختيار المحاضرات -->
    <div class="lectures-modal" id="lecturesModal">
        <h3 style="color: var(--primary-color); margin-bottom: 10px;">
            <i class="fas fa-list"></i> اختر المحاضرة المطلوبة
        </h3>
        
        <div class="lectures-list" id="lecturesList">
            <!-- سيتم ملؤها ديناميكياً -->
        </div>
        
        <div class="modal-actions">
            <button class="key-btn secondary" id="closeLecturesModal">
                إغلاق
            </button>
        </div>
    </div>
    
    <div class="watermark" id="watermark">
        © Youssef Eltawel - جميع الحقوق محفوظة
    </div>
    
    <div class="download-blocker" id="downloadBlocker">
        <i class="fas fa-ban"></i>
        <h2>محتوى محمي</h2>
        <p>التنزيل والمشاركة غير مسموح بهما لهذا المحتوى.</p>
        <p>يتم مراقبة جميع محاولات الوصول غير المصرح به.</p>
    </div>
    
    <div class="key-management" id="keyManagement">
        <h3 style="color: var(--primary-color); margin-bottom: 10px;">
            <i class="fas fa-key"></i> إدارة مفاتيح التشفير
        </h3>
        
        <div class="key-input-group">
            <label for="encryptionKey">مفتاح التشفير الرئيسي:</label>
            <input type="password" id="encryptionKey" class="key-input" placeholder="أدخل المفتاح الرئيسي">
        </div>
        
        <div class="key-input-group">
            <label for="sessionKey">مفتاح الجلسة (اختياري):</label>
            <input type="text" id="sessionKey" class="key-input" placeholder="سيتم إنشاؤه تلقائياً">
        </div>
        
        <div style="background: rgba(67, 97, 238, 0.1); padding: 15px; border-radius: 8px; font-size: 0.9rem;">
            <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
            <span>سيتم استخدام هذه المفاتيح لفك تشفير الفيديوهات بشكل آمن.</span>
        </div>
        
        <div class="key-buttons">
            <button class="key-btn secondary" id="cancelKeyBtn">إلغاء</button>
            <button class="key-btn primary" id="saveKeyBtn">حفظ المفاتيح</button>
        </div>
    </div>
    
    <div class="encryption-loader" id="encryptionLoader">
        <i class="fas fa-lock fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
        <p>جاري فك تشفير الفيديو...</p>
        <p style="font-size: 0.9rem; opacity: 0.8;" id="decryptionProgress">0%</p>
    </div>


    <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
        <p id="errorText">حدث خطأ في تحميل الفيديو</p>
        <button class="retry-btn" id="retryBtn">إعادة المحاولة</button>
    </div>
    
    <div class="network-status" id="networkStatus">
        <i class="fas fa-wifi" id="networkIcon"></i>
        <span id="networkText">الاتصال بالإنترنت متوفر</span>
    </div>
    
    <button class="notifications-toggle" id="notificationsToggle" title="إظهار/إخفاء الإشعارات">
        <i class="fas fa-bell"></i>
    </button>


    <!-- العناصر الأساسية -->
    <div class="orientation-notice" id="orientationNotice">
        <i class="fas fa-rotate"></i>
        <p>لتحسين تجربة المشاهدة</p>
        <p>يرجى تدوير هاتفك إلى الوضع الأفقي</p>
    </div>
    
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <i class="fas fa-expand"></i>
        <p>للعودة، اسحب من أعلى الشاشة أو اضغط على زر الرجوع</p>
    </div>
    
    <div class="notification" id="notification" style="display: none;">
        <i class="fas fa-info-circle"></i>
        <span id="notificationText"></span>
    </div>
    
    <div class="gesture-overlay" id="gestureOverlay">
        <div>
            <div class="gesture-icon" id="gestureIcon"></div>
            <div class="gesture-text" id="gestureText"></div>
        </div>
    </div>
    
    <div class="volume-display" id="volumeDisplay">
        <i class="fas fa-volume-up"></i> <span id="volumeValue">100%</span>
    </div>
    
    <div class="brightness-display" id="brightnessDisplay">
        <i class="fas fa-sun"></i> <span id="brightnessValue">100%</span>
    </div>
    
    <div class="playback-display" id="playbackDisplay">
        <span id="playbackValue">1x</span>
    </div>
    
    <div class="double-tap-overlay" id="doubleTapOverlay">
        <div class="double-tap-indicator" id="doubleTapIndicator">
            <i class="fas fa-forward" id="doubleTapIcon"></i>
            <span id="doubleTapText">تقديم 10 ثواني</span>
        </div>
    </div>
    
    <button class="control-btn" id="exitFullscreenBtn" style="display: none;">
        <i class="fas fa-times"></i>
    </button>


    <!-- الهيكل الرئيسي -->
    <div class="container">
        <header>
            <h1><i class="fas fa-play-circle"></i> مشغل الفيديو المحسن</h1>
            <p class="subtitle">استمتع بتجربة مشاهدة فريدة مع إمكانيات تحكم متقدمة</p>
            
            <!-- 🆕 شريط الإحصائيات السريعة -->
            <div class="quick-stats">
                <div class="stat-item">
                    <i class="fas fa-play-circle stat-icon"></i>
                    <div class="stat-info">
                        <div class="stat-value" id="totalVideosWatched">0</div>
                        <div class="stat-label">فيديو شوهد</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock stat-icon"></i>
                    <div class="stat-info">
                        <div class="stat-value" id="totalWatchTime">0h</div>
                        <div class="stat-label">وقت المشاهدة</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-trophy stat-icon"></i>
                    <div class="stat-info">
                        <div class="stat-value" id="totalAchievements">0</div>
                        <div class="stat-label">إنجاز مكتمل</div>
                    </div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-star stat-icon"></i>
                    <div class="stat-info">
                        <div class="stat-value" id="userLevel">1</div>
                        <div class="stat-label">المستوى</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="player-container">
            <div class="video-section">
                <div class="video-wrapper">
                    <div class="offline-video-badge" id="offlineVideoBadge">
                        <i class="fas fa-download"></i> بدون إنترنت
                    </div>
                    
                    <button class="add-bookmark-btn" id="addBookmarkBtn" title="إضافة إشارة مرجعية">
                        <i class="fas fa-bookmark"></i>
                    </button>
                    
                    <div class="bookmarks-panel" id="bookmarksPanel">
                        <div class="bookmarks-header" style="color: white; margin-bottom: 10px; font-weight: bold;">
                            الإشارات المرجعية
                        </div>
                        <div class="bookmarks-list" id="bookmarksList">
                            <!-- سيتم ملؤها ديناميكياً -->
                        </div>
                    </div>
                    
                    <video id="videoPlayer" preload="metadata">
                        متصفحك لا يدعم تشغيل الفيديو.
                    </video>
                    
                    <button class="skip-backward" id="skipBackward10">
                        <i class="fas fa-backward"></i> 10s
                    </button>
                    
                    <button class="skip-forward" id="skipForward10">
                        <i class="fas fa-forward"></i> 10s
                    </button>
                    
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    
                    <div class="long-press-overlay" id="longPressOverlay">
                        <i class="fas fa-forward"></i>
                        <p>تسريع الفيديو للضعف</p>
                    </div>
                    
                    <div class="video-controls" id="videoControls">
                        <div class="progress-bar-container control-element" id="progressBarContainer">
                            <div id="progressContainer" class="progress-container" aria-label="شريط التشغيل">
                                <div id="bufferBar" class="buffer-bar"></div>
                                <div id="progress" class="progress"></div>
                                <div id="thumb" class="thumb"></div>
                                
                                <div id="previewBox" class="preview-box" aria-hidden="true">
                                    <canvas id="previewCanvas" class="preview-canvas" width="80" height="45"></canvas>
                                    <div id="previewTime" class="preview-time">0:00</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-buttons">
                            <div class="left-controls">
                                <button class="control-btn control-element" id="playPauseBtn">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="control-btn control-element" id="rewindBtn">
                                    <i class="fas fa-backward"></i>
                                </button>
                                <button class="control-btn control-element" id="forwardBtn">
                                    <i class="fas fa-forward"></i>
                                </button>
                                <div class="volume-container control-element">
                                    <button class="control-btn" id="volumeBtn">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="1">
                                </div>
                                <div class="time-display control-element">
                                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                                </div>
                            </div>
                            
                            <div class="right-controls">
                                <button class="control-btn control-element" id="loopBtn" title="تكرار">
                                    <i class="fas fa-redo"></i>
                                </button>
                                <button class="control-btn control-element" id="toggleSkipBtns" title="إظهار/إخفاء أزرار التقديم">
                                    <i class="fas fa-step-forward"></i>
                                </button>
                                <div class="speed-display control-element" id="speedDisplay">1x</div>
                                <div class="speed-menu" id="speedMenu">
                                    <div class="speed-option" data-speed="0.5">0.5x</div>
                                    <div class="speed-option active" data-speed="1">1x</div>
                                    <div class="speed-option" data-speed="1.25">1.25x</div>
                                    <div class="speed-option" data-speed="1.5">1.5x</div>
                                    <div class="speed-option" data-speed="2">2x</div>
                                </div>
                                <button class="control-btn control-element" id="pipBtn">
                                    <i class="fas fa-compress-arrows-alt"></i>
                                </button>
                                <button class="control-btn control-element" id="fullscreenBtn">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<!-- ==================== زر التعليقات مع عداد صحيح ==================== -->


<!-- زر التعليقات في الواجهة -->
<div id="comments-button-container" style="display: flex; justify-content: center; margin: 20px 0; padding: 0 20px;">
    <button id="inline-comments-btn" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-family: 'Cairo', sans-serif; font-weight: 600; font-size: 1rem; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s ease; min-width: 200px; justify-content: center;">
        <i class="fas fa-comments" style="font-size: 1.1rem;"></i>
        <span id="comments-btn-text">عرض التعليقات</span>
        <span id="inline-comments-badge" style="background: rgba(255,255,255,0.3); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 500; min-width: 20px; text-align: center; display: none;">0</span>
    </button>
</div>


<!-- نافذة التعليقات المنبثقة -->
<div id="inline-comments-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(5px);">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 600px; max-height: 80vh; background: var(--card-color); border-radius: 15px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        
        <!-- رأس النافذة -->
        <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; border-bottom: 1px solid var(--border-color); background: var(--card-color);">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-comments" style="color: white; font-size: 1.2rem;"></i>
                </div>
                <div>
                    <h3 style="margin: 0; color: var(--text-color); font-weight: 600; font-size: 1.3rem;">التعليقات</h3>
                    <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">شاركنا رأيك حول هذا الفيديو</p>
                </div>
            </div>
            <button id="inline-close-comments" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.3s ease; font-size: 1.2rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>


        <!-- محتوى النافذة -->
        <div style="padding: 0; max-height: 60vh; overflow-y: auto;">
            
            <!-- معلومات سريعة -->
            <div style="padding: 15px 20px; background: linear-gradient(135deg, var(--card-color), rgba(52, 73, 94, 0.05)); border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <i class="fab fa-github" style="color: #2da44e; font-size: 1.1rem;"></i>
                    <span style="color: var(--text-color); font-weight: 500; font-size: 0.9rem;">التعليقات باستخدام GitHub</span>
                </div>
                <p style="color: var(--text-secondary); margin: 0; font-size: 0.8rem; line-height: 1.4;">
                    سجل الدخول بحساب GitHub للتعليق. التعليقات تدعم Markdown وتخزن في مستودع GitHub.
                </p>
            </div>


            <!-- حاوية Utterances -->
            <div id="inline-utterances-container" style="min-height: 200px; position: relative;">
                
                <!-- شريط تحميل -->
                <div id="inline-loading" style="padding: 40px 20px; text-align: center;">
                    <div style="display: inline-flex; align-items: center; gap: 10px; padding: 12px 20px; background: var(--background-color); border-radius: 8px;">
                        <i class="fas fa-spinner fa-spin" style="color: var(--primary-color);"></i>
                        <span style="color: var(--text-color);">جاري تحميل التعليقات...</span>
                    </div>
                </div>


                <!-- Utterances -->
                <script src="https://utteranc.es/client.js"
                        repo="youssef52000/site-comments"
                        issue-term="pathname"
                        label="comment"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                </script>
            </div>
        </div>


    </div>
</div>


<script>
// نظام العدادات المحسن لـ Utterances
class CommentsCounter {
    constructor() {
        this.commentsCount = 0;
        this.observer = null;
        this.init();
    }


    init() {
        this.setupMessageListener();
        this.startPolling();
    }


    setupMessageListener() {
        // الاستماع للرسائل من iframe الـ Utterances
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'utterances:ready') {
                console.log('✅ Utterances جاهز');
                this.startCounting();
            }
        });
    }


    startPolling() {
        // فحص دوري لوجود iframe الـ Utterances
        const pollInterval = setInterval(() => {
            const utterancesFrame = document.querySelector('iframe.utterances-frame');
            if (utterancesFrame) {
                clearInterval(pollInterval);
                console.log('🎯 تم العثور على iframe الـ Utterances');
                this.startCounting();
            }
        }, 1000);


        // إيقاف الفحص بعد 10 ثواني
        setTimeout(() => clearInterval(pollInterval), 10000);
    }


    startCounting() {
        const utterancesContainer = document.querySelector('.utterances');
        if (!utterancesContainer) {
            console.log('❌ لم يتم العثور على .utterances');
            return;
        }


        console.log('🔍 بدء عد التعليقات...');


        // طريقة 1: MutationObserver لمراقبة التغييرات
        this.observer = new MutationObserver((mutations) => {
            this.countComments();
        });


        this.observer.observe(utterancesContainer, {
            childList: true,
            subtree: true,
            characterData: true
        });


        // عد أولي
        setTimeout(() => this.countComments(), 2000);
        
        // عد إضافي بعد 5 ثواني (لضمان تحميل كل التعليقات)
        setTimeout(() => this.countComments(), 5000);
    }


    countComments() {
        // طريقة متعددة للعد لتجنب المشاكل
        let count = 0;


        // الطريقة 1: عناصر timeline-comment
        const commentElements = document.querySelectorAll('.timeline-comment, .js-comment-container, [data-comment-id]');
        count = Math.max(count, commentElements.length);


        // الطريقة 2: البحث في النص
        const utterancesHtml = document.querySelector('.utterances')?.innerHTML || '';
        if (utterancesHtml.includes('timeline-comment')) {
            const match = utterancesHtml.match(/timeline-comment/g);
            if (match) {
                count = Math.max(count, match.length);
            }
        }


        // الطريقة 3: من iframe مباشرة (إذا أمكن)
        try {
            const utterancesFrame = document.querySelector('iframe.utterances-frame');
            if (utterancesFrame && utterancesFrame.contentDocument) {
                const frameComments = utterancesFrame.contentDocument.querySelectorAll('.timeline-comment');
                count = Math.max(count, frameComments.length);
            }
        } catch (e) {
            // تجنب errors الـ CORS
        }


        if (count > 0 && count !== this.commentsCount) {
            this.commentsCount = count;
            this.updateUI(count);
            console.log(`📊 عدد التعليقات: ${count}`);
        }
    }


    updateUI(count) {
        const badge = document.getElementById('inline-comments-badge');
        const buttonText = document.getElementById('comments-btn-text');
        
        if (badge) {
            badge.textContent = count > 99 ? '99+' : count;
            badge.style.display = count > 0 ? 'inline-block' : 'none';
        }
        
        if (buttonText) {
            buttonText.textContent = count > 0 ? `التعليقات (${count})` : 'عرض التعليقات';
        }


        // تخزين العدد للاستخدام لاحقاً
        localStorage.setItem(`comments_count_${window.location.pathname}`, count);
    }


    getStoredCount() {
        return parseInt(localStorage.getItem(`comments_count_${window.location.pathname}`)) || 0;
    }
}


// التحكم في النافذة المنبثقة
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('inline-comments-modal');
    const toggleBtn = document.getElementById('inline-comments-btn');
    const closeBtn = document.getElementById('inline-close-comments');
    const loadingElement = document.getElementById('inline-loading');
    
    // تهيئة عداد التعليقات
    window.commentsCounter = new CommentsCounter();


    // عرض العدد المخزن عند التحميل
    const storedCount = window.commentsCounter.getStoredCount();
    if (storedCount > 0) {
        const badge = document.getElementById('inline-comments-badge');
        const buttonText = document.getElementById('comments-btn-text');
        
        if (badge) {
            badge.textContent = storedCount > 99 ? '99+' : storedCount;
            badge.style.display = 'inline-block';
        }
        
        if (buttonText) {
            buttonText.textContent = `التعليقات (${storedCount})`;
        }
    }


    // فتح النافذة
    toggleBtn.addEventListener('click', function() {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // إخفاء شريط التحميل بعد تحميل التعليقات
        setTimeout(() => {
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            // إعادة عد التعليقات عند فتح النافذة
            setTimeout(() => window.commentsCounter.countComments(), 1000);
        }, 3000);
    });


    // إغلاق النافذة
    closeBtn.addEventListener('click', closeModal);


    // إغلاق عند النقر خارج النافذة
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeModal();
        }
    });


    // إغلاق بالزر Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'block') {
            closeModal();
        }
    });


    function closeModal() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }


    // تحديث التعليقات عند تغيير الفيديو
    const originalChangeVideo = window.changeVideo;
    window.changeVideo = function(index) {
        if (originalChangeVideo) originalChangeVideo(index);
        
        // إعادة تعيين العداد
        const badge = document.getElementById('inline-comments-badge');
        const buttonText = document.getElementById('comments-btn-text');
        if (badge) badge.style.display = 'none';
        if (buttonText) buttonText.textContent = 'عرض التعليقات';
        
        // إعادة تحميل التعليقات للفيديو الجديد
        setTimeout(() => {
            const utterancesFrame = document.querySelector('.utterances-frame');
            if (utterancesFrame && utterancesFrame.contentWindow) {
                utterancesFrame.contentWindow.location.reload();
                
                // إعادة إظهار شريط التحميل
                if (loadingElement) {
                    loadingElement.style.display = 'block';
                }
                
                // إخفاء شريط التحميل بعد فترة وإعادة العد
                setTimeout(() => {
                    if (loadingElement) {
                        loadingElement.style.display = 'none';
                    }
                    setTimeout(() => window.commentsCounter.countComments(), 2000);
                }, 3000);
            }
        }, 1000);
    };


    // عد إضافي كل 10 ثواني للتأكد
    setInterval(() => {
        if (modal.style.display === 'block') {
            window.commentsCounter.countComments();
        }
    }, 10000);
});


// محاولة الاتصال مع iframe الـ Utterances
function tryUtterancesAPI() {
    const utterancesFrame = document.querySelector('iframe.utterances-frame');
    if (utterancesFrame && utterancesFrame.contentWindow) {
        try {
            // إرسال رسالة لـ Utterances لطلب عدد التعليقات
            utterancesFrame.contentWindow.postMessage({
                type: 'utterances:get-comments-count'
            }, '*');
        } catch (e) {
            console.log('❌ لا يمكن الاتصال بـ iframe الـ Utterances');
        }
    }
}


// محاولة الاتصال كل 3 ثواني
setInterval(tryUtterancesAPI, 3000);
 
</script>
<!-- 🎬 بطاقة محتوى الفيديو التعليمي -->
<div class="accordion-item">
    <button class="accordion-header" id="videoContentAccordion">
        <span><i class="fas fa-play-circle"></i> محتوى المحاضرة</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div class="accordion-content" id="videoContentContent">
        <div class="accordion-body">
            <!-- محتوى ديناميكي حسب الفيديو -->
            <div class="video-content" id="videoContent">
                <div class="content-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>جاري تحميل محتوى المحاضرة...</span>
                </div>
            </div>
            
            <!-- مواد التحميل -->
            <div class="course-materials" id="courseMaterials">
                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">
                    <i class="fas fa-download"></i> مواد المحاضرة
                </h4>
                <div class="materials-list" id="materialsList">
                    <!-- سيتم ملؤها ديناميكياً -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 🧪 بطاقة اختبار المحاضرة -->
<div class="accordion-item">
    <button class="accordion-header" id="quizAccordion">
        <span><i class="fas fa-question-circle"></i> اختبار المحاضرة</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div class="accordion-content" id="quizContent">
        <div class="accordion-body">
            <!-- رسالة اختيار نوع الاختبار -->
            <div class="quiz-selection-message" id="quiz-selection-message">
                <div style="text-align: center; padding: 30px 20px;">
                    <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">اختر نوع الاختبار</h3>
                    <p style="color: var(--text-color); opacity: 0.8; margin-bottom: 2rem;">
                        اختر بين اختبار الأدوات الأساسية أو اختبار أدوات الذكاء الاصطناعي
                    </p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="showQuizSection('basic')" style="background: var(--primary-color);">
                            <i class="fas fa-play-circle" style="margin-left: 8px;"></i>
                            <span>اختبار الأدوات الأساسية</span>
                        </button>
                        
                        <button class="btn" onclick="showQuizSection('ai')" style="background: var(--accent-color);">
                            <i class="fas fa-robot" style="margin-left: 8px;"></i>
                            <span>اختبار الذكاء الاصطناعي</span>
                        </button>
                    </div>
                </div>
            </div>


            <!-- اختبار الأدوات الأساسية -->
            <div id="basic-quiz" class="quiz-type-content" style="display: none;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <button class="btn btn-outline" onclick="backToQuizSelection()">
                        <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
                        <span>العودة لاختيار الاختبار</span>
                    </button>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-header">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">اختبار الأدوات الأساسية</h4>
                        <p style="color: var(--text-color); opacity: 0.7; margin-bottom: 1.5rem;">اختبر معرفتك بأدوات كاب كوت الأساسية (39 سؤال)</p>
                    </div>
                    
                    <div class="quiz-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="basic-quiz-progress" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="basic-progress-text">السؤال 1 من 39</span>
                    </div>
                    
                    <div class="quiz-questions" id="basic-quiz-container">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                    
                    <div class="quiz-actions">
                        <button class="quiz-btn secondary" id="basic-prev-btn" disabled>
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="quiz-btn primary" id="basic-next-btn">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                        <button class="quiz-btn success" id="basic-submit-btn" style="display: none;">
                            <i class="fas fa-paper-plane"></i> إنهاء الاختبار
                        </button>
                    </div>
                    
                    <div class="quiz-results" id="basic-quiz-result" style="display: none;">
                        <!-- نتائج الاختبار -->
                    </div>
                </div>
            </div>


            <!-- اختبار الذكاء الاصطناعي -->
            <div id="ai-quiz" class="quiz-type-content" style="display: none;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <button class="btn btn-outline" onclick="backToQuizSelection()">
                        <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
                        <span>العودة لاختيار الاختبار</span>
                    </button>
                </div>
                
                <div class="quiz-container">
                    <div class="quiz-header">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">اختبار أدوات الذكاء الاصطناعي</h4>
                        <p style="color: var(--text-color); opacity: 0.7; margin-bottom: 1.5rem;">اختبر معرفتك بأدوات الذكاء الاصطناعي المتقدمة (10 أسئلة)</p>
                    </div>
                    
                    <div class="quiz-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="ai-quiz-progress" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="ai-progress-text">السؤال 1 من 10</span>
                    </div>
                    
                    <div class="quiz-questions" id="ai-quiz-container">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                    
                    <div class="quiz-actions">
                        <button class="quiz-btn secondary" id="ai-prev-btn" disabled>
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="quiz-btn primary" id="ai-next-btn">
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                        <button class="quiz-btn success" id="ai-submit-btn" style="display: none;">
                            <i class="fas fa-paper-plane"></i> إنهاء الاختبار
                        </button>
                    </div>
                    
                    <div class="quiz-results" id="ai-quiz-result" style="display: none;">
                        <!-- نتائج الاختبار -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
            <div class="side-panel">
                <!-- 🆕 نظام الأكورديون -->
                <div class="accordion" id="sidePanelAccordion">
                    <!-- بطاقة الإحصائيات -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="statsAccordion">
                            <span><i class="fas fa-chart-line"></i> إحصائيات المشاهدة</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="statsContent">
                            <div class="accordion-body">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <div class="stat-card-icon">
                                            <i class="fas fa-eye"></i>
                                        </div>
                                        <div class="stat-card-value" id="statViews">0</div>
                                        <div class="stat-card-label">عدد المشاهدات</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-card-icon">
                                            <i class="fas fa-hourglass-half"></i>
                                        </div>
                                        <div class="stat-card-value" id="statWatchTime">0h</div>
                                        <div class="stat-card-label">إجمالي الوقت</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-card-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="stat-card-value" id="statCompleted">0%</div>
                                        <div class="stat-card-label">معدل الإكمال</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-card-icon">
                                            <i class="fas fa-bolt"></i>
                                        </div>
                                        <div class="stat-card-value" id="statStreak">0</div>
                                        <div class="stat-card-label">سلسلة المشاهدة</div>
                                    </div>
                                </div>
                                
                                <div class="progress-chart">
                                    <div class="chart-header">
                                        <div class="chart-title">تقدم المشاهدة اليومي</div>
                                    </div>
                                    <div class="chart-container" id="dailyProgressChart">
                                        <!-- سيتم ملؤها ديناميكياً -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- بطاقة الإنجازات -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="achievementsAccordion">
                            <span><i class="fas fa-trophy"></i> الإنجازات والشارات</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="achievementsContent">
                            <div class="accordion-body">
                                <div class="achievements-grid" id="achievementsGrid">
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </div>
                            </div>
                        </div>
                    </div>
<!-- بطاقة معلومات الفيديو -->
<div class="accordion-item">
    <button class="accordion-header" id="infoAccordion">
        <span><i class="fas fa-info-circle"></i> معلومات الفيديو</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div class="accordion-content" id="infoContent">
        <div class="accordion-body">
            <div class="video-info" id="dynamicVideoInfo">
                <div class="info-item">
                    <span class="info-label">العنوان:</span>
                    <span id="videoTitle">المحاضرة الأولى (الاساسيات)</span>
                </div>
                <div class="info-item">
                    <span class="info-label">المدة:</span>
                    <span id="videoDuration">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">الجودة:</span>
                    <span id="videoQuality">HD</span>
                </div>
                <div class="info-item">
                    <span class="info-label">النوع:</span>
                    <span id="videoType">فيديو تعليمي</span>
                </div>
            </div>
        </div>
    </div>
</div>


                    <!-- بطاقة السمات -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="themesAccordion">
                            <span><i class="fas fa-palette"></i> تغيير السمات</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="themesContent">
                            <div class="accordion-body">
                                <div class="themes-grid">
                                    <div class="theme-option theme-default active" data-theme="default">
                                        افتراضي
                                    </div>
                                    <div class="theme-option theme-dark" data-theme="dark">
                                        مظلم
                                    </div>
                                    <div class="theme-option theme-blue" data-theme="blue">
                                        أزرق
                                    </div>
                                    <div class="theme-option theme-green" data-theme="green">
                                        أخضر
                                    </div>
                                    <div class="theme-option theme-premium" data-theme="premium">
                                        مميز
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- بطاقة قائمة التشغيل -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="playlistAccordion">
                            <span><i class="fas fa-list"></i> قائمة التشغيل</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="playlistContent">
                            <div class="accordion-body">
                                <div class="playlist">
                                    <div class="playlist-item active" data-video="0">
                                        <div class="playlist-info">
                                            <div class="playlist-title">المحاضرة الأولى (الاساسيات)</div>
                                            <div class="playlist-duration">-</div>
                                        </div>
                                        <button class="download-btn" data-video="0">
                                            <i class="fas fa-download"></i>
                                            <span>تحميل</span>
                                        </button>
                                        <div class="download-progress" data-video="0" style="width: 0%"></div>
                                    </div>
                                    <div class="playlist-item" data-video="1">
                                        <div class="playlist-info">
                                            <div class="playlist-title">المحاضرة الثانية (التطبيق)</div>
                                            <div class="playlist-duration">-</div>
                                        </div>
                                        <button class="download-btn" data-video="1">
                                            <i class="fas fa-download"></i>
                                            <span>تحميل</span>
                                        </button>
                                        <div class="download-progress" data-video="1" style="width: 0%"></div>
                                    </div>
                                    <div class="playlist-item" data-video="2">
                                        <div class="playlist-info">
                                            <div class="playlist-title">المحاضرة الثالثة (AI)</div>
                                            <div class="playlist-duration">-</div>
                                        </div>
                                        <button class="download-btn" data-video="2">
                                            <i class="fas fa-download"></i>
                                            <span>تحميل</span>
                                        </button>
                                        <div class="download-progress" data-video="2" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- بطاقة الملفات المحملة -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="downloadsAccordion">
                            <span><i class="fas fa-download"></i> الملفات المحملة</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="downloadsContent">
                            <div class="accordion-body">
                                <!-- ⭐ جديد: تحذير التنظيف -->
                                <div class="cleanup-warning" id="cleanupWarning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>جميع الفيديوهات المحملة سيتم حذفها تلقائياً عند مغادرة الصفحة</span>
                                </div>
                                
                                <div class="downloads-list" id="downloadsList">
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </div>
                                <div class="storage-info">
                                    <div>مساحة التخزين المستخدمة: <span id="storageUsed">0 MB</span> من <span id="storageTotal">1.5 GB</span></div>
                                    <div class="storage-bar">
                                        <div class="storage-used" id="storageBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- بطاقة الإعدادات -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="settingsAccordion">
                            <span><i class="fas fa-cog"></i> الإعدادات</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="settingsContent">
                            <div class="accordion-body">
                                <div class="settings-list">
                                    <div class="setting-item">
                                        <span class="setting-label">التكرار التلقائي</span>
                                        <div class="setting-control">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="loopToggle">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <span class="setting-label">التشغيل التلقائي</span>
                                        <div class="setting-control">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="autoplayToggle">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <span class="setting-label">إخفاء الشريط تلقائياً</span>
                                        <div class="setting-control">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="autoHideToggle" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <span class="setting-label">وضع العمل بدون إنترنت</span>
                                        <div class="setting-control">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="offlineModeToggle" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- بطاقة التعليمات -->
                    <div class="accordion-item">
                        <button class="accordion-header" id="instructionsAccordion">
                            <span><i class="fas fa-graduation-cap"></i> تعليمات الاستخدام</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content" id="instructionsContent">
                            <div class="accordion-body">
                                <div class="instructions-list">
                                    <div class="instruction">
                                        <i class="fas fa-backward"></i>
                                        <div>
                                            <strong>التأخير 10 ثوانٍ:</strong> انقر على زر الرجوع
                                        </div>
                                    </div>
                                    <div class="instruction">
                                        <i class="fas fa-forward"></i>
                                        <div>
                                            <strong>التقديم 10 ثوانٍ:</strong> انقر على زر التقديم
                                        </div>
                                    </div>
                                    <div class="instruction">
                                        <i class="fas fa-running"></i>
                                        <div>
                                            <strong>تسريع الفيديو:</strong> اضغط مطولاً على الفيديو
                                        </div>
                                    </div>
                                    <div class="instruction">
                                        <i class="fas fa-mobile-alt"></i>
                                        <div>
                                            <strong>النقر المزدوج:</strong> انقر مرتين على الجانب الأيمن للتقديم أو الأيسر للتأخير
                                        </div>
                                    </div>
                                    <div class="instruction">
                                        <i class="fas fa-play-circle"></i>
                                        <div>
                                            <strong>التشغيل/الإيقاف:</strong> انقر مرة واحدة على الفيديو
                                        </div>
                                    </div>
                                    <div class="instruction">
                                        <i class="fas fa-keyboard"></i>
                                        <div>
                                            <strong>اختصارات لوحة المفاتيح:</strong> المسافة للتشغيل/الإيقاف، الأسهم للتحكم
                                        </div>
                                    </div>
<div class="instruction">
    <i class="fas fa-cloud-download-alt"></i>
    <div>
       </strong>العمل بدون إنترنت:</strong> الفيديوهات المحملة تعمل بدون اتصال خلال الجلسة الحالية
    </div>
</div>
<div class="instruction">
                                        <i class="fas fa-bookmark"></i>
                                        <div>
                                            <strong>الإشارات المرجعية:</strong> انقر على زر الإشارة لحفظ الوقت الحالي
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>تم التطوير بواسطة Youssef Eltawel &copy; 2025 - جميع الحقوق محفوظة</p>
        </footer>
    </div>
    


    <script>
        // === ✅ نظام الأزرار الخارجية للهاتف ===
        class ExternalControlsManager {
            constructor() {
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                this.externalControls = document.getElementById('externalControls');
                this.init();
            }
            
            init() {
                if (!this.isMobile) {
                    this.externalControls.style.display = 'none';
                    return;
                }
                
                this.setupEventListeners();
                this.updateExternalButtons();
            }
            
            setupEventListeners() {
                // زر التشغيل/الإيقاف الخارجي
                document.getElementById('externalPlayPause').addEventListener('click', () => {
                    if (window.videoPlayer) {
                        window.togglePlayPause();
                        this.updateExternalButtons();
                    }
                });
                
                // زر الصوت الخارجي
                document.getElementById('externalVolume').addEventListener('click', () => {
                    if (window.videoPlayer) {
                        window.toggleMute();
                        this.updateExternalButtons();
                    }
                });
                
                // زر السرعة الخارجي
                document.getElementById('externalSpeed').addEventListener('click', () => {
                    if (window.videoPlayer) {
                        this.toggleSpeed();
                    }
                });
                
                // زر الشاشة الكاملة الخارجي
                document.getElementById('externalFullscreen').addEventListener('click', () => {
                    window.toggleFullscreen();
                });
                
                // تحديث الأزرار عند تغيير حالة الفيديو
                if (window.videoPlayer) {
                    window.videoPlayer.addEventListener('play', () => this.updateExternalButtons());
                    window.videoPlayer.addEventListener('pause', () => this.updateExternalButtons());
                    window.videoPlayer.addEventListener('volumechange', () => this.updateExternalButtons());
                }
            }
            
            updateExternalButtons() {
                if (!window.videoPlayer) return;
                
                const playPauseBtn = document.getElementById('externalPlayPause');
                const volumeBtn = document.getElementById('externalVolume');
                const speedBtn = document.getElementById('externalSpeed');
                
                // تحديث زر التشغيل/الإيقاف
                if (window.videoPlayer.paused || window.videoPlayer.ended) {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                }
                
                // تحديث زر الصوت
                if (window.videoPlayer.muted || window.videoPlayer.volume === 0) {
                    volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    volumeBtn.style.background = 'var(--warning-color)';
                } else {
                    volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    volumeBtn.style.background = '';
                }
                
                // تحديث زر السرعة
                const speed = window.videoPlayer.playbackRate;
                speedBtn.innerHTML = `<i class="fas fa-forward"></i><span style="font-size: 0.7rem; position: absolute; bottom: 2px;">${speed}x</span>`;
            }
            
            toggleSpeed() {
                if (!window.videoPlayer) return;
                
                const speeds = [0.5, 1, 1.25, 1.5, 2];
                const currentSpeed = window.videoPlayer.playbackRate;
                const currentIndex = speeds.indexOf(currentSpeed);
                const nextIndex = (currentIndex + 1) % speeds.length;
                
                window.videoPlayer.playbackRate = speeds[nextIndex];
                this.updateExternalButtons();
                
                if (window.showNotification) {
                    window.showNotification(`السرعة: ${speeds[nextIndex]}x`, 'info');
                }
            }
            
            // إظهار/إخفاء الأزرار الخارجية
            show() {
                if (this.isMobile && this.externalControls) {
                    this.externalControls.classList.add('active');
                }
            }
            
            hide() {
                if (this.externalControls) {
                    this.externalControls.classList.remove('active');
                }
            }
            
            // التحقق إذا كانت الأزرار مرئية
            isVisible() {
                return this.externalControls.classList.contains('active');
            }
        }


        // === ✅ نظام الأكورديون ===
        class AccordionManager {
            constructor() {
                this.accordions = [];
                this.init();
            }
            
            init() {
                this.setupAccordions();
                this.loadAccordionState();
            }
            
            setupAccordions() {
                const accordionHeaders = document.querySelectorAll('.accordion-header');
                
                accordionHeaders.forEach(header => {
                    const accordionItem = header.parentElement;
                    const content = accordionItem.querySelector('.accordion-content');
                    
                    this.accordions.push({
                        header: header,
                        content: content,
                        isOpen: false
                    });
                    
                    header.addEventListener('click', () => {
                        this.toggleAccordion(header);
                    });
                });
                
                // فتح أول أكورديون افتراضياً
                if (accordionHeaders.length > 0) {
                    this.openAccordion(accordionHeaders[0]);
                }
            }
            
            toggleAccordion(header) {
                const accordionItem = header.parentElement;
                const content = accordionItem.querySelector('.accordion-content');
                const isCurrentlyOpen = header.classList.contains('active');
                
                // إغلاق جميع الأكورديونات الأخرى
                this.closeAllAccordions();
                
                if (!isCurrentlyOpen) {
                    this.openAccordion(header);
                }
                
                this.saveAccordionState();
            }
            
            openAccordion(header) {
                const accordionItem = header.parentElement;
                const content = accordionItem.querySelector('.accordion-content');
                
                header.classList.add('active');
                content.classList.add('active');
                
                // حفظ الحالة
                const accordionId = header.id;
                localStorage.setItem('activeAccordion', accordionId);
            }
            
            closeAccordion(header) {
                const accordionItem = header.parentElement;
                const content = accordionItem.querySelector('.accordion-content');
                
                header.classList.remove('active');
                content.classList.remove('active');
            }
            
            closeAllAccordions() {
                this.accordions.forEach(accordion => {
                    this.closeAccordion(accordion.header);
                });
            }
            
            saveAccordionState() {
                const activeAccordion = document.querySelector('.accordion-header.active');
                if (activeAccordion) {
                    localStorage.setItem('activeAccordion', activeAccordion.id);
                }
            }
            
            loadAccordionState() {
                const savedAccordionId = localStorage.getItem('activeAccordion');
                if (savedAccordionId) {
                    const savedAccordion = document.getElementById(savedAccordionId);
                    if (savedAccordion) {
                        this.closeAllAccordions();
                        this.openAccordion(savedAccordion);
                    }
                }
            }
        }


        // === ✅ نظام العمل بدون إنترنت المحسن ===
        class OfflineManager {
            constructor() {
                this.isOnline = navigator.onLine;
                this.serviceWorkerSupported = 'serviceWorker' in navigator;
                this.cacheSupported = 'caches' in window;
                this.offlineMode = true;
                this.init();
            }
            
            async init() {
                this.setupEventListeners();
                await this.registerServiceWorker();
                this.updateOfflineStatus();
            }
            
            async registerServiceWorker() {
                if (!this.serviceWorkerSupported) {
                    this.log('Service Worker غير مدعوم في هذا المتصفح');
                    return false;
                }
                
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    this.log('تم تسجيل Service Worker بنجاح');
                    
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        this.log('تم اكتشاف تحديث لـ Service Worker');
                    });
                    
                    return true;
                } catch (error) {
                    this.log(`فشل تسجيل Service Worker: ${error.message}`);
                    return false;
                }
            }
            
            setupEventListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateOfflineStatus();
                    this.showNotification('تم استعادة الاتصال بالإنترنت', 'success');
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateOfflineStatus();
                    this.showNotification('جاري العمل بدون اتصال إنترنت', 'warning');
                });
            }
            
            updateOfflineStatus() {
                const offlineIndicator = document.getElementById('offlineIndicator');
                const cacheStatus = document.getElementById('cacheStatus');
                
                if (!this.isOnline) {
                    offlineIndicator.classList.add('active');
                    cacheStatus.classList.add('active');
                    
                    setTimeout(() => {
                        offlineIndicator.classList.remove('active');
                        cacheStatus.classList.remove('active');
                    }, 2000);
                } else {
                    offlineIndicator.classList.remove('active');
                    cacheStatus.classList.remove('active');
                }
            }
            
            async cacheVideo(videoUrl, videoId) {
                if (!this.cacheSupported) {
                    this.log('نظام Cache غير مدعوم');
                    return false;
                }
                
                try {
                    const cache = await caches.open('video-cache-v1');
                    await cache.add(videoUrl);
                    this.log(`تم تخزين الفيديو في الكاش: ${videoId}`);
                    return true;
                } catch (error) {
                    this.log(`فشل تخزين الفيديو: ${error.message}`);
                    return false;
                }
            }
            
            async getCachedVideo(videoUrl) {
                if (!this.cacheSupported) return null;
                
                try {
                    const cache = await caches.open('video-cache-v1');
                    const response = await cache.match(videoUrl);
                    return response;
                } catch (error) {
                    this.log(`فشل استرجاع الفيديو من الكاش: ${error.message}`);
                    return null;
                }
            }
            
            async isVideoCached(videoUrl) {
                const response = await this.getCachedVideo(videoUrl);
                return response !== null;
            }
            
            log(message) {
                console.log(`📡 [OfflineManager]: ${message}`);
            }
            
            showNotification(message, type = 'info') {
                if (window.showNotification) {
                    window.showNotification(message, type);
                }
            }
        }


        // === ✅ نظام التخزين المؤقت الذكي ===
        class SmartCacheManager {
            constructor() {
                this.cacheName = 'smart-video-cache-v1';
                this.maxCacheSize = 1.5 * 1024 * 1024 * 1024; // 1.5 GB
            }
            
            async cleanupOldCache() {
                try {
                    const cache = await caches.open(this.cacheName);
                    const keys = await cache.keys();
                    const now = Date.now();
                    
                    for (const request of keys) {
                        const response = await cache.match(request);
                        if (response) {
                            const dateHeader = response.headers.get('date');
                            if (dateHeader) {
                                const cachedDate = new Date(dateHeader).getTime();
                                if (now - cachedDate > 7 * 24 * 60 * 60 * 1000) {
                                    await cache.delete(request);
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error('خطأ في تنظيف الكاش:', error);
                }
            }
            
            async getCacheSize() {
                try {
                    const cache = await caches.open(this.cacheName);
                    const keys = await cache.keys();
                    let totalSize = 0;
                    
                    for (const request of keys) {
                        const response = await cache.match(request);
                        if (response) {
                            const contentLength = response.headers.get('content-length');
                            if (contentLength) {
                                totalSize += parseInt(contentLength, 10);
                            }
                        }
                    }
                    
                    return totalSize;
                } catch (error) {
                    console.error('خطأ في حساب حجم الكاش:', error);
                    return 0;
                }
            }
        }


        // === ✅ نظام الإشعارات المحسن ===
        class NotificationManager {
            constructor() {
                this.notificationQueue = [];
                this.isShowing = false;
                this.container = document.getElementById('notification');
            }
            
            show(message, type = 'info', duration = 3000) {
                this.notificationQueue.push({ message, type, duration });
                
                if (!this.isShowing) {
                    this.processQueue();
                }
            }
            
            async processQueue() {
                if (this.notificationQueue.length === 0) {
                    this.isShowing = false;
                    return;
                }
                
                this.isShowing = true;
                const { message, type, duration } = this.notificationQueue.shift();
                
                await this.displayNotification(message, type);
                
                setTimeout(() => {
                    this.hideNotification();
                    setTimeout(() => this.processQueue(), 300);
                }, duration);
            }
            
            async displayNotification(message, type) {
                document.getElementById('notificationText').textContent = message;
                
                const styles = {
                    success: { background: 'rgba(76, 175, 80, 0.9)', icon: 'fas fa-check-circle' },
                    error: { background: 'rgba(244, 67, 54, 0.9)', icon: 'fas fa-exclamation-triangle' },
                    warning: { background: 'rgba(255, 193, 7, 0.9)', icon: 'fas fa-exclamation-circle' },
                    info: { background: 'rgba(33, 150, 243, 0.9)', icon: 'fas fa-info-circle' }
                };
                
                const style = styles[type] || styles.info;
                this.container.style.background = style.background;
                this.container.querySelector('i').className = style.icon;
                
                this.container.style.display = 'flex';
                
                await this.animateNotification('in');
            }
            
            hideNotification() {
                this.animateNotification('out').then(() => {
                    this.container.style.display = 'none';
                });
            }
            
            animateNotification(direction) {
                return new Promise(resolve => {
                    const start = direction === 'in' ? -50 : 20;
                    const end = direction === 'in' ? 20 : -50;
                    
                    this.container.style.top = `${start}px`;
                    this.container.style.opacity = direction === 'in' ? '0' : '1';
                    
                    const startTime = performance.now();
                    
                    const animate = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / 300, 1);
                        
                        const currentTop = start + (end - start) * progress;
                        const currentOpacity = direction === 'in' ? progress : 1 - progress;
                        
                        this.container.style.top = `${currentTop}px`;
                        this.container.style.opacity = currentOpacity.toString();
                        
                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        } else {
                            resolve();
                        }
                    };
                    
                    requestAnimationFrame(animate);
                });
            }
        }


        // === ✅ نظام الإشارات المرجعية ===
        class BookmarkManager {
            constructor() {
                this.bookmarks = new Map();
                this.loadBookmarks();
            }
            
            addBookmark(videoId, timestamp, title) {
                const bookmark = {
                    id: this.generateId(),
                    videoId,
                    timestamp,
                    title,
                    createdAt: Date.now()
                };
                
                this.bookmarks.set(bookmark.id, bookmark);
                this.saveBookmarks();
                return bookmark;
            }
            
            removeBookmark(bookmarkId) {
                this.bookmarks.delete(bookmarkId);
                this.saveBookmarks();
            }
            
            getBookmarksForVideo(videoId) {
                return Array.from(this.bookmarks.values())
                    .filter(bookmark => bookmark.videoId === videoId)
                    .sort((a, b) => a.timestamp - b.timestamp);
            }
            
            jumpToBookmark(bookmark) {
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.currentTime = bookmark.timestamp;
                
                if (window.showNotification) {
                    window.showNotification(`الانتقال إلى: ${bookmark.title}`, 'success');
                }
            }
            
            generateId() {
                return `bookmark_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }
            
            saveBookmarks() {
                try {
                    const bookmarksArray = Array.from(this.bookmarks.entries());
                    localStorage.setItem('videoBookmarks', JSON.stringify(bookmarksArray));
                } catch (error) {
                    console.error('خطأ في حفظ الإشارات المرجعية:', error);
                }
            }
            
            loadBookmarks() {
                try {
                    const stored = localStorage.getItem('videoBookmarks');
                    if (stored) {
                        const bookmarksArray = JSON.parse(stored);
                        this.bookmarks = new Map(bookmarksArray);
                    }
                } catch (error) {
                    console.error('خطأ في تحميل الإشارات المرجعية:', error);
                }
            }
        }


        // === 🆕 🆕 🆕 نظام الإحصائيات والإنجازات 🆕 🆕 🆕 ===
        class StatisticsManager {
            constructor() {
                this.stats = {
                    totalVideosWatched: 0,
                    totalWatchTime: 0, // بالثواني
                    totalSessions: 0,
                    completionRate: 0,
                    currentStreak: 0,
                    lastWatchDate: null,
                    achievementsUnlocked: 0,
                    userLevel: 1,
                    userPoints: 0,
                    dailyProgress: {}
                };
                
                this.achievements = [
                    {
                        id: 'first_video',
                        title: 'المشاهد الأول',
                        description: 'شاهد أول فيديو',
                        icon: 'fas fa-play',
                        points: 10,
                        unlocked: false,
                        progress: 0,
                        target: 1,
                        type: 'watch'
                    },
                    {
                        id: 'marathon_watcher',
                        title: 'المشاهد المثابر',
                        description: 'شاهد 10 فيديوهات',
                        icon: 'fas fa-film',
                        points: 50,
                        unlocked: false,
                        progress: 0,
                        target: 10,
                        type: 'watch'
                    },
                    {
                        id: 'time_master',
                        title: 'سيد الوقت',
                        description: 'قضى ساعة في المشاهدة',
                        icon: 'fas fa-clock',
                        points: 100,
                        unlocked: false,
                        progress: 0,
                        target: 3600, // 1 ساعة بالثواني
                        type: 'time'
                    },
                    {
                        id: 'completionist',
                        title: 'المكمل',
                        description: 'أكمل 5 فيديوهات بالكامل',
                        icon: 'fas fa-check-circle',
                        points: 75,
                        unlocked: false,
                        progress: 0,
                        target: 5,
                        type: 'completion'
                    },
                    {
                        id: 'streak_master',
                        title: 'سيد السلسلة',
                        description: 'حافظ على سلسلة مشاهدة لمدة 3 أيام',
                        icon: 'fas fa-fire',
                        points: 150,
                        unlocked: false,
                        progress: 0,
                        target: 3,
                        type: 'streak'
                    },
                    {
                        id: 'speed_learner',
                        title: 'المتعلم السريع',
                        description: 'شاهد فيديو بسرعة 2x',
                        icon: 'fas fa-running',
                        points: 25,
                        unlocked: false,
                        progress: 0,
                        target: 1,
                        type: 'speed'
                    },
                    {
                        id: 'bookmark_expert',
                        title: 'خبير الإشارات',
                        description: 'أنشئ 5 إشارات مرجعية',
                        icon: 'fas fa-bookmark',
                        points: 30,
                        unlocked: false,
                        progress: 0,
                        target: 5,
                        type: 'bookmark'
                    },
                    {
                        id: 'offline_pro',
                        title: 'المحترف بدون إنترنت',
                        description: 'حمّل 3 فيديوهات للعمل بدون إنترنت',
                        icon: 'fas fa-wifi-slash',
                        points: 80,
                        unlocked: false,
                        progress: 0,
                        target: 3,
                        type: 'download'
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.loadStats();
                this.loadAchievements();
                this.updateDisplay();
                this.setupDailyProgress();
            }
            
            loadStats() {
                try {
                    const saved = localStorage.getItem('videoPlayerStats');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.stats = { ...this.stats, ...parsed };
                    }
                } catch (error) {
                    console.error('خطأ في تحميل الإحصائيات:', error);
                }
            }
            
            saveStats() {
                try {
                    localStorage.setItem('videoPlayerStats', JSON.stringify(this.stats));
                } catch (error) {
                    console.error('خطأ في حفظ الإحصائيات:', error);
                }
            }
            
            loadAchievements() {
                try {
                    const saved = localStorage.getItem('videoPlayerAchievements');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.achievements = this.achievements.map(achievement => {
                            const savedAchievement = parsed.find(a => a.id === achievement.id);
                            return savedAchievement ? { ...achievement, ...savedAchievement } : achievement;
                        });
                    }
                } catch (error) {
                    console.error('خطأ في تحميل الإنجازات:', error);
                }
            }
            
            saveAchievements() {
                try {
                    localStorage.setItem('videoPlayerAchievements', JSON.stringify(this.achievements));
                } catch (error) {
                    console.error('خطأ في حفظ الإنجازات:', error);
                }
            }
            
            recordVideoWatch(duration, completionPercent = 100) {
                // تحديث الإحصائيات الأساسية
                this.stats.totalVideosWatched++;
                this.stats.totalWatchTime += duration;
                this.stats.totalSessions++;
                
                // تحديث معدل الإكمال
                const totalCompletions = this.stats.completionRate * (this.stats.totalVideosWatched - 1);
                this.stats.completionRate = (totalCompletions + (completionPercent >= 90 ? 1 : 0)) / this.stats.totalVideosWatched;
                
                // تحديث سلسلة المشاهدة
                this.updateStreak();
                
                // تحديث التقدم اليومي
                this.updateDailyProgress(duration);
                
                // تحديث المستوى والنقاط
                this.updateLevelAndPoints();
                
                // التحقق من الإنجازات
                this.checkAchievements();
                
                // حفظ التحديثات
                this.saveStats();
                this.updateDisplay();
            }
            
            updateStreak() {
                const today = new Date().toDateString();
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                
                if (!this.stats.lastWatchDate) {
                    this.stats.currentStreak = 1;
                } else if (this.stats.lastWatchDate === today) {
                    // نفس اليوم، لا تحديث
                } else if (this.stats.lastWatchDate === yesterday) {
                    this.stats.currentStreak++;
                } else {
                    this.stats.currentStreak = 1;
                }
                
                this.stats.lastWatchDate = today;
            }
            
            updateDailyProgress(duration) {
                const today = new Date().toDateString();
                if (!this.stats.dailyProgress[today]) {
                    this.stats.dailyProgress[today] = 0;
                }
                this.stats.dailyProgress[today] += duration;
                
                // الاحتفاظ ببيانات 7 أيام فقط
                const weekAgo = new Date(Date.now() - 7 * 86400000).toDateString();
                Object.keys(this.stats.dailyProgress).forEach(date => {
                    if (date < weekAgo) {
                        delete this.stats.dailyProgress[date];
                    }
                });
            }
            
            updateLevelAndPoints() {
                // حساب النقاط بناءً على الوقت والمشاهدات
                const watchPoints = Math.floor(this.stats.totalWatchTime / 60); // نقطة لكل دقيقة
                const videoPoints = this.stats.totalVideosWatched * 5;
                const achievementPoints = this.achievements.filter(a => a.unlocked).reduce((sum, a) => sum + a.points, 0);
                
                this.stats.userPoints = watchPoints + videoPoints + achievementPoints;
                
                // تحديث المستوى (كل 1000 نقطة مستوى)
                this.stats.userLevel = Math.floor(this.stats.userPoints / 1000) + 1;
            }
            
            checkAchievements() {
                let newAchievements = [];
                
                this.achievements.forEach(achievement => {
                    if (achievement.unlocked) return;
                    
                    let progress = achievement.progress;
                    
                    switch (achievement.type) {
                        case 'watch':
                            progress = this.stats.totalVideosWatched;
                            break;
                        case 'time':
                            progress = this.stats.totalWatchTime;
                            break;
                        case 'completion':
                            progress = Math.floor(this.stats.completionRate * this.stats.totalVideosWatched);
                            break;
                        case 'streak':
                            progress = this.stats.currentStreak;
                            break;
                        case 'speed':
                            // يتم تحديثه من خلال حدث منفصل
                            break;
                        case 'bookmark':
                            // يتم تحديثه من خلال نظام الإشارات المرجعية
                            break;
                        case 'download':
                            // يتم تحديثه من خلال نظام التحميل
                            break;
                    }
                    
                    if (progress >= achievement.target) {
                        achievement.unlocked = true;
                        achievement.progress = achievement.target;
                        newAchievements.push(achievement);
                    } else {
                        achievement.progress = progress;
                    }
                });
                
                if (newAchievements.length > 0) {
                    this.stats.achievementsUnlocked += newAchievements.length;
                    this.saveAchievements();
                    newAchievements.forEach(achievement => {
                        this.showAchievementNotification(achievement);
                    });
                }
            }
            
            unlockAchievement(achievementId) {
                const achievement = this.achievements.find(a => a.id === achievementId);
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    achievement.progress = achievement.target;
                    this.stats.achievementsUnlocked++;
                    this.saveAchievements();
                    this.updateLevelAndPoints();
                    this.showAchievementNotification(achievement);
                    this.updateDisplay();
                }
            }
            
            showAchievementNotification(achievement) {
                const notification = document.getElementById('achievementNotification');
                const title = document.getElementById('achievementNotifTitle');
                const desc = document.getElementById('achievementNotifDesc');
                const icon = notification.querySelector('.achievement-notification-icon i');
                
                title.textContent = achievement.title;
                desc.textContent = achievement.description;
                icon.className = achievement.icon;
                
                notification.style.display = 'flex';
                
                // إخفاء تلقائي بعد 5 ثواني
                setTimeout(() => {
                    this.hideAchievementNotification();
                }, 5000);
                
                // إشعار صوتي (إن أمكن)
                if (window.showNotification) {
                    window.showNotification(`🎉 ${achievement.title}: ${achievement.description}`, 'success');
                }
            }
            
            hideAchievementNotification() {
                document.getElementById('achievementNotification').style.display = 'none';
            }
            
            updateDisplay() {
                // تحديث الإحصائيات السريعة في الهيدر
                document.getElementById('totalVideosWatched').textContent = this.stats.totalVideosWatched;
                document.getElementById('totalWatchTime').textContent = this.formatTime(this.stats.totalWatchTime);
                document.getElementById('totalAchievements').textContent = this.stats.achievementsUnlocked;
                document.getElementById('userLevel').textContent = this.stats.userLevel;
                
                // تحديث بطاقات الإحصائيات
                document.getElementById('statViews').textContent = this.stats.totalVideosWatched;
                document.getElementById('statWatchTime').textContent = this.formatTime(this.stats.totalWatchTime);
                document.getElementById('statCompleted').textContent = `${Math.round(this.stats.completionRate * 100)}%`;
                document.getElementById('statStreak').textContent = this.stats.currentStreak;
                
                // تحديث مخطط التقدم اليومي
                this.updateProgressChart();
                
                // تحديث شبكة الإنجازات
                this.updateAchievementsGrid();
            }
            
            updateProgressChart() {
                const chart = document.getElementById('dailyProgressChart');
                chart.innerHTML = '';
                
                const days = ['أحد', 'اثنين', 'ثلاثاء', 'أربعاء', 'خميس', 'جمعة', 'سبت'];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateString = date.toDateString();
                    const progress = this.stats.dailyProgress[dateString] || 0;
                    const maxProgress = 3600; // ساعة واحدة كحد أقصى للعرض
                    const height = Math.min((progress / maxProgress) * 100, 100);
                    
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.height = `${height}%`;
                    bar.style.left = `${(6 - i) * 14.28}%`;
                    
                    const label = document.createElement('div');
                    label.className = 'chart-label';
                    label.textContent = days[date.getDay()];
                    label.style.left = `${(6 - i) * 14.28}%`;
                    
                    chart.appendChild(bar);
                    chart.appendChild(label);
                }
            }
            
            updateAchievementsGrid() {
                const grid = document.getElementById('achievementsGrid');
                grid.innerHTML = '';
                
                this.achievements.forEach(achievement => {
                    const card = document.createElement('div');
                    card.className = `achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'}`;
                    
                    const progressPercent = (achievement.progress / achievement.target) * 100;
                    
                    card.innerHTML = `
                        ${achievement.unlocked ? '<div class="achievement-badge"><i class="fas fa-check"></i></div>' : ''}
                        <div class="achievement-icon">
                            <i class="${achievement.icon}"></i>
                        </div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="achievement-points">${achievement.points} نقطة</div>
                    `;
                    
                    grid.appendChild(card);
                });
            }
            
            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            }
            
            setupDailyProgress() {
                // تنظيف البيانات القديمة بشكل دوري
                setInterval(() => {
                    const weekAgo = new Date(Date.now() - 7 * 86400000).toDateString();
                    Object.keys(this.stats.dailyProgress).forEach(date => {
                        if (date < weekAgo) {
                            delete this.stats.dailyProgress[date];
                        }
                    });
                    this.saveStats();
                }, 24 * 60 * 60 * 1000); // مرة يومياً
            }
            
            getStats() {
                return { ...this.stats };
            }
            
            getAchievements() {
                return [...this.achievements];
            }
        }


        // === ✅ نظام التحميل للمشاهدة بدون اتصال ===
        class DownloadManager {
            constructor() {
                this.downloads = new Map();
                this.maxStorage = 1.5 * 1024 * 1024 * 1024; // 1.5 GB
                this.offlineManager = new OfflineManager();
                this.cleanupOnExit = true; // ⭐ تنظيف إجباري
                this.init();
            }
            
            init() {
                this.loadDownloadsFromStorage();
                this.updateStorageDisplay();
                this.updateOfflineStatus(); // ⭐ جديد: تحديث حالة التوفر بدون إنترنت
                this.setupForcedCleanup(); // ⭐ تنظيف إجباري
            }
            
            // ⭐ محسّن: السماح بالتحميل من المصادر المحلية بدون إنترنت
            async downloadVideo(videoIndex, videoData) {
                const videoUrl = videoData.originalUrl;
                const videoId = `video_${videoIndex}`;
                
                // ✅ التحقق إذا كان الفيديو محملاً مسبقاً
                if (this.downloads.has(videoId)) {
                    this.showInfo('الفيديو محمل مسبقاً');
                    this.playDownloadedVideo(videoId);
                    return;
                }
                
                // ⭐ محسّن: السماح بالتحميل إذا كان الفيديو محلياً
                if (!navigator.onLine && !videoData.isLocal) {
                    this.showError('لا يوجد اتصال بالإنترنت. يرجى الاتصال بالشبكة.');
                    return;
                }
                
                try {
                    this.updateDownloadButton(videoIndex, 'downloading');
                    
                    const response = await fetch(videoUrl);
                    
                    if (!response.ok) {
                        throw new Error(`خطأ في التحميل: ${response.status}`);
                    }
                    
                    const contentLength = response.headers.get('content-length');
                    const total = parseInt(contentLength, 10);
                    
                    if (total > this.maxStorage) {
                        throw new Error('حجم الفيديو يتجاوز المساحة المتاحة');
                    }
                    
                    const reader = response.body.getReader();
                    let receivedLength = 0;
                    const chunks = [];
                    
                    while (true) {
                        const {done, value} = await reader.read();
                        
                        if (done) break;
                        
                        chunks.push(value);
                        receivedLength += value.length;
                        
                        const progress = (receivedLength / total) * 100;
                        this.updateDownloadProgress(videoIndex, progress);
                        
                        if (receivedLength > this.maxStorage) {
                            throw new Error('مساحة التخزين غير كافية');
                        }
                    }
                    
                    const blob = new Blob(chunks);
                    const objectUrl = URL.createObjectURL(blob);
                    
                    const downloadInfo = {
                        id: videoId,
                        title: videoData.title,
                        url: objectUrl,
                        size: receivedLength,
                        timestamp: Date.now(),
                        videoIndex: videoIndex,
                        originalUrl: videoUrl,
                        isLocal: true // ⭐ جديد: علامة أن الفيديو محلي
                    };
                    
                    this.downloads.set(videoId, downloadInfo);
                    this.saveDownloadsToStorage();
                    this.updateDownloadButton(videoIndex, 'downloaded');
                    this.updateDownloadsList();
                    this.updateStorageDisplay();
                    this.updateOfflineStatus(); // ⭐ تحديث حالة التوفر بدون إنترنت
                    
                    await this.offlineManager.cacheVideo(videoUrl, videoId);
                    
                    this.showSuccess(`تم تحميل ${videoData.title} بنجاح`);
                    
                    // 🆕 فتح إنجاز التحميل
                    if (window.statisticsManager) {
                        window.statisticsManager.unlockAchievement('offline_pro');
                    }
                    
                } catch (error) {
                    console.error('خطأ في التحميل:', error);
                    this.updateDownloadButton(videoIndex, 'download');
                    this.showError(`فشل التحميل: ${this.getErrorMessage(error)}`);
                }
            }
            
            // ⭐ جديد: التحقق من توفر الفيديو بدون إنترنت
            isVideoAvailableOffline(videoIndex) {
                const videoId = `video_${videoIndex}`;
                return this.downloads.has(videoId);
            }
            
            // ⭐ جديد: تحديث حالة الفيديوهات المتاحة بدون إنترنت
            updateOfflineStatus() {
                const playlistItems = document.querySelectorAll('.playlist-item');
                playlistItems.forEach((item, index) => {
                    if (this.isVideoAvailableOffline(index)) {
                        item.classList.add('offline-available');
                    } else {
                        item.classList.remove('offline-available');
                    }
                });
            }
            
            // ⭐ محسّن: تشغيل الفيديو المحمّل محلياً
            playDownloadedVideo(videoId) {
                const download = this.downloads.get(videoId);
                if (download) {
                    this.loadVideoFromUrl(download.url, {
                        title: download.title,
                        duration: '-',
                        isOffline: true,
                        isLocal: true
                    });
                    this.showInfo('جاري تشغيل الفيديو المحمل');
                }
            }
            
            // ⭐ محسّن بشكل كبير: تحميل الفيديو مع الأولوية للمصادر المحلية
            async loadVideoFromUrl(videoUrl, videoData) {
                try {
                    this.showLoading(true);
                    
                    // ✅ الأولوية 1: الفيديوهات المحملة محلياً
                    const localDownload = Array.from(this.downloads.values())
                        .find(d => d.videoIndex === currentVideoIndex);
                    
                    if (localDownload) {
                        videoPlayer.src = localDownload.url;
                        this.showSuccess('جاري التشغيل من النسخة المحلية');
                        
                        // ⭐ جديد: إظهار شارة بدون إنترنت
                        const offlineBadge = document.getElementById('offlineVideoBadge');
                        offlineBadge.classList.add('active');
                        setTimeout(() => offlineBadge.classList.remove('active'), 2000);
                        return;
                    }
                    
                    // ✅ الأولوية 2: الكاش
                    const cachedResponse = await this.offlineManager.getCachedVideo(videoData.originalUrl || videoUrl);
                    if (cachedResponse) {
                        videoPlayer.src = URL.createObjectURL(await cachedResponse.blob());
                        this.showInfo('جاري التشغيل من الذاكرة المؤقتة');
                        return;
                    }
                    
                    // ✅ الأولوية 3: المصدر الأصلي (يحتاج إنترنت)
                    if (!navigator.onLine) {
                        this.showError('لا يوجد اتصال بالإنترنت والفيديو غير متوفر محلياً');
                        return;
                    }
                    
                    videoPlayer.src = videoUrl;
                    
                } catch (error) {
                    this.showError(`فشل تحميل الفيديو: ${this.getErrorMessage(error)}`);
                } finally {
                    this.showLoading(false);
                }
            }
            
            // ⭐ جديد: إعداد التنظيف الإجباري
            setupForcedCleanup() {
                window.addEventListener('beforeunload', (e) => {
                    this.forceCleanupAllDownloads();
                });
                
                window.addEventListener('pagehide', () => {
                    this.forceCleanupAllDownloads();
                });
                
                window.addEventListener('blur', () => {
                    setTimeout(() => {
                        if (document.hidden) {
                            this.forceCleanupAllDownloads();
                        }
                    }, 1000);
                });
                
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        setTimeout(() => {
                            if (document.hidden) {
                                this.forceCleanupAllDownloads();
                            }
                        }, 2000);
                    }
                });
                
                setInterval(() => {
                    this.forceCleanupAllDownloads();
                }, 5 * 60 * 1000);
            }
            
            // ⭐ جديد: تنظيف إجباري لجميع الفيديوهات
            forceCleanupAllDownloads() {
                if (this.downloads.size === 0) return;
                
                console.log('🔧 جاري التنظيف الإجباري للفيديوهات المحملة...');
                
                this.downloads.forEach((download, videoId) => {
                    this.deleteDownloadImmediately(videoId);
                });
                
                this.clearDownloadsStorage();
                
                console.log('✅ تم التنظيف الإجباري لجميع الفيديوهات');
                
                if (document.visibilityState === 'visible') {
                    this.showInfo('تم تنظيف جميع الفيديوهات المحملة تلقائياً');
                }
            }
            
            // ⭐ جديد: مسح التخزين المحلي بالكامل
            clearDownloadsStorage() {
                try {
                    localStorage.removeItem('videoDownloads');
                    if ('caches' in window) {
                        caches.delete('video-cache-v1').catch(() => {});
                        caches.delete('smart-video-cache-v1').catch(() => {});
                    }
                } catch (error) {
                    console.error('خطأ في مسح التخزين:', error);
                }
            }
            
            // ⭐ جديد: حذف فوري بدون أي استثناءات
            deleteDownloadImmediately(videoId) {
                const download = this.downloads.get(videoId);
                if (download) {
                    URL.revokeObjectURL(download.url);
                    this.downloads.delete(videoId);
                    this.updateDownloadButton(download.videoIndex, 'download');
                    console.log(`🗑️ تم حذف الفيديو: ${download.title}`);
                }
            }
            
            updateDownloadButton(videoIndex, state) {
                const button = document.querySelector(`.download-btn[data-video="${videoIndex}"]`);
                const progress = document.querySelector(`.download-progress[data-video="${videoIndex}"]`);
                
                if (!button) return;
                
                switch (state) {
                    case 'downloading':
                        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>جاري التحميل</span>';
                        button.classList.add('downloading');
                        button.disabled = true;
                        break;
                    case 'downloaded':
                        button.innerHTML = '<i class="fas fa-check"></i><span>تم التحميل</span>';
                        button.classList.remove('downloading');
                        button.classList.add('downloaded');
                        button.disabled = false;
                        if (progress) progress.style.width = '100%';
                        break;
                    default:
                        button.innerHTML = '<i class="fas fa-download"></i><span>تحميل</span>';
                        button.classList.remove('downloading', 'downloaded');
                        button.disabled = false;
                        if (progress) progress.style.width = '0%';
                }
            }
            
            updateDownloadProgress(videoIndex, progress) {
                const progressBar = document.querySelector(`.download-progress[data-video="${videoIndex}"]`);
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
            }
            
            deleteDownload(videoId) {
                const download = this.downloads.get(videoId);
                if (download) {
                    URL.revokeObjectURL(download.url);
                    this.downloads.delete(videoId);
                    this.saveDownloadsToStorage();
                    this.updateDownloadsList();
                    this.updateStorageDisplay();
                    this.updateOfflineStatus();
                    
                    this.updateDownloadButton(download.videoIndex, 'download');
                    this.showSuccess('تم حذف الفيديو المحمل');
                }
            }
            
            updateDownloadsList() {
                const downloadsList = document.getElementById('downloadsList');
                if (!downloadsList) return;
                
                downloadsList.innerHTML = '';
                
                if (this.downloads.size === 0) {
                    downloadsList.innerHTML = '<div style="text-align: center; opacity: 0.7; padding: 20px;">لا توجد ملفات محملة</div>';
                    return;
                }
                
                this.downloads.forEach((download, videoId) => {
                    const downloadItem = document.createElement('div');
                    downloadItem.className = 'download-item';
                    downloadItem.innerHTML = `
                        <div class="download-item-info">
                            <div class="download-item-title">${download.title}</div>
                            <div class="download-item-status">${this.formatFileSize(download.size)} - ${new Date(download.timestamp).toLocaleDateString('ar-EG')}</div>
                        </div>
                        <div class="download-item-actions">
                            <button class="download-action-btn" onclick="downloadManager.playDownloadedVideo('${videoId}')" title="تشغيل">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="download-action-btn" onclick="downloadManager.deleteDownload('${videoId}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    downloadsList.appendChild(downloadItem);
                });
            }
            
            updateStorageDisplay() {
                const totalUsed = Array.from(this.downloads.values()).reduce((sum, download) => sum + download.size, 0);
                const percentage = (totalUsed / this.maxStorage) * 100;
                
                if (totalUsed > 1024 * 1024 * 1024) {
                    const usedGB = (totalUsed / (1024 * 1024 * 1024)).toFixed(2);
                    document.getElementById('storageUsed').textContent = `${usedGB} GB`;
                } else {
                    const usedMB = (totalUsed / (1024 * 1024)).toFixed(1);
                    document.getElementById('storageUsed').textContent = `${usedMB} MB`;
                }
                
                document.getElementById('storageTotal').textContent = '1.5 GB';
                document.getElementById('storageBar').style.width = `${percentage}%`;
                
                const storageBar = document.getElementById('storageBar');
                if (percentage > 90) {
                    storageBar.style.background = '#dc3545';
                } else if (percentage > 70) {
                    storageBar.style.background = '#ffc107';
                } else {
                    storageBar.style.background = 'var(--primary-color)';
                }
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            saveDownloadsToStorage() {
                try {
                    const downloadsArray = Array.from(this.downloads.entries());
                    localStorage.setItem('videoDownloads', JSON.stringify(downloadsArray));
                } catch (error) {
                    this.showError('فشل حفظ بيانات التحميل في التخزين المحلي');
                }
            }
            
            loadDownloadsFromStorage() {
                try {
                    const stored = localStorage.getItem('videoDownloads');
                    if (stored) {
                        const downloadsArray = JSON.parse(stored);
                        this.downloads = new Map(downloadsArray);
                        this.updateDownloadsList();
                        this.updateOfflineStatus();
                        
                        this.downloads.forEach(download => {
                            this.updateDownloadButton(download.videoIndex, 'downloaded');
                        });
                    }
                } catch (error) {
                    this.showError('فشل تحميل بيانات التحميل من التخزين المحلي');
                }
            }
            
            getTotalStorageUsed() {
                return Array.from(this.downloads.values()).reduce((sum, download) => sum + download.size, 0);
            }
            
            canDownload(size) {
                return (this.getTotalStorageUsed() + size) <= this.maxStorage;
            }
            
            showError(message) {
                this.showNotification(message, 'error');
            }
            
            showSuccess(message) {
                this.showNotification(message, 'success');
            }
            
            showInfo(message) {
                this.showNotification(message, 'info');
            }
            
            showNotification(message, type = 'info') {
                if (window.showNotification) {
                    window.showNotification(message, type);
                } else {
                    console.log(`[${type.toUpperCase()}] ${message}`);
                }
            }
            
            showLoading(show) {
                const spinner = document.getElementById('loadingSpinner');
                if (spinner) {
                    spinner.style.display = show ? 'block' : 'none';
                }
            }
            
            getErrorMessage(error) {
                if (error.message.includes('Failed to fetch')) {
                    return 'فشل الاتصال بالخادم. يرجى التحقق من اتصال الإنترنت.';
                } else if (error.message.includes('404')) {
                    return 'لم يتم العثور على الفيديو. الرابط غير صالح.';
                } else if (error.message.includes('network')) {
                    return 'مشكلة في الشبكة. يرجى المحاولة مرة أخرى.';
                } else if (error.message.includes('quota')) {
                    return 'مساحة التخزين غير كافية. يرجى حذف بعض الملفات.';
                }
                return error.message;
            }
        }


        // === ✅ نظام تشفير معدل يعمل مع الفيديوهات الحالية ===
        class VideoEncryptionSystem {
            constructor() {
                this.encryptionKey = null;
                this.sessionKey = this.generateSessionKey();
                this.initialized = false;
                this.encryptedUrls = new Map();
            }
            
            generateSessionKey() {
                return Array.from(crypto.getRandomValues(new Uint8Array(16)))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            }
            
            async initialize(masterKey) {
                try {
                    if (!masterKey || masterKey.length < 8) {
                        throw new Error('المفتاح الرئيسي يجب أن يكون 8 أحرف على الأقل');
                    }
                    
                    const encoder = new TextEncoder();
                    const keyMaterial = await crypto.subtle.importKey(
                        'raw',
                        encoder.encode(masterKey),
                        'PBKDF2',
                        false,
                        ['deriveKey']
                    );
                    
                    this.encryptionKey = await crypto.subtle.deriveKey(
                        {
                            name: 'PBKDF2',
                            salt: encoder.encode('video-protection-salt'),
                            iterations: 100000,
                            hash: 'SHA-256'
                        },
                        keyMaterial,
                        {
                            name: 'AES-GCM',
                            length: 256
                        },
                        false,
                        ['encrypt', 'decrypt']
                    );
                    
                    this.initialized = true;
                    this.log('تم تهيئة نظام التشفير بنجاح');
                    return true;
                } catch (error) {
                    this.log(`خطأ في تهيئة التشفير: ${error.message}`);
                    throw error;
                }
            }
            
            async encryptText(text, videoId) {
                if (!this.initialized) {
                    throw new Error('نظام التشفير غير مهيأ');
                }
                
                try {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(text);
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    
                    const encrypted = await crypto.subtle.encrypt(
                        {
                            name: 'AES-GCM',
                            iv: iv
                        },
                        this.encryptionKey,
                        data
                    );
                    
                    const combined = new Uint8Array(iv.length + encrypted.byteLength);
                    combined.set(iv);
                    combined.set(new Uint8Array(encrypted), iv.length);
                    
                    const encryptedBase64 = btoa(String.fromCharCode(...combined));
                    this.encryptedUrls.set(videoId, encryptedBase64);
                    this.log(`تم تشفير النص لـ ${videoId}`);
                    return encryptedBase64;
                } catch (error) {
                    this.log(`خطأ في التشفير: ${error.message}`);
                    throw error;
                }
            }
            
            async decryptText(encryptedData, videoId) {
                if (!this.initialized) {
                    throw new Error('نظام التشفير غير مهيأ');
                }
                
                try {
                    const combined = Uint8Array.from(atob(encryptedData), c => c.charCodeAt(0));
                    const iv = combined.slice(0, 12);
                    const encrypted = combined.slice(12);
                    
                    const decrypted = await crypto.subtle.decrypt(
                        {
                            name: 'AES-GCM',
                            iv: iv
                        },
                        this.encryptionKey,
                        encrypted
                    );
                    
                    const decoder = new TextDecoder();
                    const text = decoder.decode(decrypted);
                    
                    this.log(`تم فك تشفير النص لـ ${videoId}`);
                    return text;
                } catch (error) {
                    this.log(`خطأ في فك التشفير: ${error.message}`);
                    throw error;
                }
            }
            
            generateSecurityToken(videoId, timestamp) {
                const data = `${videoId}-${timestamp}-${this.sessionKey}`;
                let hash = 0;
                for (let i = 0; i < data.length; i++) {
                    const char = data.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16).substring(0, 8);
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString('ar-EG');
                const logEntry = `[${timestamp}] ${message}`;
                
                const logs = JSON.parse(localStorage.getItem('securityLogs') || '[]');
                logs.unshift(logEntry);
                if (logs.length > 50) logs.pop();
                localStorage.setItem('securityLogs', JSON.stringify(logs));
                
                console.log(`🔒 ${logEntry}`);
            }
            
            getStatus() {
                return {
                    initialized: this.initialized,
                    sessionKey: this.sessionKey,
                    encryptedUrls: this.encryptedUrls.size
                };
            }
        }


        // === ✅ مصفوفة الفيديوهات الحالية ===
        const encryptedVideos = [
            {
                id: "video1",
                originalUrl: "https://dl.dropboxusercontent.com/scl/fi/lk4lfxjoo4kkzx04it9lr/lv_0_20250813205831.mp4?rlkey=nr9869shv8yytm6olturqo02o&st=kmoxbuh4&dl=1",
                encryptedUrl: null,
                title: "المحاضرة الأولى (الاساسيات)",
                duration: "-",
                accessCode: "Y520@editing"
            },
            {
                id: "video2", 
                originalUrl: "https://dl.dropboxusercontent.com/scl/fi/8dqf76k2j5drf6bjdy55l/lv_0_20250828182230.mp4?rlkey=ngt3hki9bqp8l9btxgqdyoa94&st=of6xwjao&dl=1",
                encryptedUrl: null,
                title: "المحاضرة الثانية (التطبيق)",
                duration: "-",
                accessCode: "Y530@2007"
            },
            {
                id: "video3",
                originalUrl: "https://dl.dropboxusercontent.com/scl/fi/xeejr9szn6ecque5w3695/lv_0_20250905005947.mp4?rlkey=p01vi6wq3tzcogye842spjvgc&st=jao3ub0n&dl=1",
                encryptedUrl: null,
                title: "المحاضرة الثالثة (AI)",
                duration: "-", 
                accessCode: "Y2007@520"
            }
        ];


        // === ✅ تهيئة الأنظمة ===
        const downloadManager = new DownloadManager();
        const encryptionSystem = new VideoEncryptionSystem();
        const notificationManager = new NotificationManager();
        const bookmarkManager = new BookmarkManager();
        const smartCacheManager = new SmartCacheManager();
        const statisticsManager = new StatisticsManager(); // 🆕 نظام الإحصائيات الجديد
        const externalControlsManager = new ExternalControlsManager(); // 🆕 نظام الأزرار الخارجية
        const accordionManager = new AccordionManager(); // 🆕 نظام الأكورديون


        // جعل الأنظمة متاحة globally
        window.statisticsManager = statisticsManager;
        window.externalControlsManager = externalControlsManager;


        // === ✅ تهيئة العناصر ===
        const videoPlayer = document.getElementById('videoPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const rewindBtn = document.getElementById('rewindBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const skipBackward10 = document.getElementById('skipBackward10');
        const skipForward10 = document.getElementById('skipForward10');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const progress = document.getElementById('progress');
        const bufferBar = document.getElementById('bufferBar');
        const progressContainer = document.getElementById('progressContainer');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const thumb = document.getElementById('thumb');
        const speedDisplay = document.getElementById('speedDisplay');
        const speedMenu = document.getElementById('speedMenu');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const pipBtn = document.getElementById('pipBtn');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const loopBtn = document.getElementById('loopBtn');
        const toggleSkipBtns = document.getElementById('toggleSkipBtns');
        const longPressOverlay = document.getElementById('longPressOverlay');
        const fullscreenOverlay = document.getElementById('fullscreenOverlay');
        const orientationNotice = document.getElementById('orientationNotice');
        const videoControls = document.getElementById('videoControls');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const loopToggle = document.getElementById('loopToggle');
        const autoplayToggle = document.getElementById('autoplayToggle');
        const autoHideToggle = document.getElementById('autoHideToggle');
        const offlineModeToggle = document.getElementById('offlineModeToggle');
        const themeOptions = document.querySelectorAll('.theme-option');
        const playlistItems = document.querySelectorAll('.playlist-item');
        const speedOptions = document.querySelectorAll('.speed-option');
        const controlElements = document.querySelectorAll('.control-element');
        const body = document.body;
        const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
        const notificationsToggle = document.getElementById('notificationsToggle');
        const downloadButtons = document.querySelectorAll('.download-btn');
        const offlineVideoBadge = document.getElementById('offlineVideoBadge');
        const addBookmarkBtn = document.getElementById('addBookmarkBtn');
        const bookmarksPanel = document.getElementById('bookmarksPanel');
        const bookmarksList = document.getElementById('bookmarksList');
        
        // عناصر الحماية والتشفير
        const protectionOverlay = document.getElementById('protectionOverlay');
        const protectionMessage = document.getElementById('protectionMessage');
        const protectionCode = document.getElementById('protectionCode');
        const protectionInput = document.getElementById('protectionInput');
        const protectionBtn = document.getElementById('protectionBtn');
        const watermark = document.getElementById('watermark');
        const downloadBlocker = document.getElementById('downloadBlocker');
        const keyManagement = document.getElementById('keyManagement');
        const encryptionKeyInput = document.getElementById('encryptionKey');
        const sessionKeyInput = document.getElementById('sessionKey');
        const saveKeyBtn = document.getElementById('saveKeyBtn');
        const cancelKeyBtn = document.getElementById('cancelKeyBtn');
        const encryptionLoader = document.getElementById('encryptionLoader');
        const decryptionProgress = document.getElementById('decryptionProgress');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const retryBtn = document.getElementById('retryBtn');
        const networkStatus = document.getElementById('networkStatus');
        const networkIcon = document.getElementById('networkIcon');
        const networkText = document.getElementById('networkText');


        // === ✅ العناصر الجديدة لزر اختيار المحاضرات ===
        const chooseOtherLectureBtn = document.getElementById('chooseOtherLectureBtn');
        const lecturesModal = document.getElementById('lecturesModal');
        const lecturesList = document.getElementById('lecturesList');
        const closeLecturesModal = document.getElementById('closeLecturesModal');


        // === ✅ المتغيرات العامة ===
        let currentVideoIndex = 0;
        let isAccessGranted = false;
        let decryptionInProgress = false;
        let controlsTimeout;
        let isLoopActive = false;
        let isAutoplayActive = false;
        let isAutoHideActive = true;
        let isOfflineModeActive = true;
        let isLongPressActive = false;
        let longPressTimer;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let isFullscreen = false;
        let isControlsVisible = true;
        let skipButtonsVisible = false;
        let isDragging = false;
        let previewSeeking = false;
        let queuedPreviewTime = null;
        let lastTap = 0;
        let networkOnline = navigator.onLine;
        let errorCount = 0;
        const MAX_ERROR_RETRIES = 3;
        let sessionStartTime = null;
        let sessionDuration = 60 * 60 * 2;
        let sessionTimerInterval = null;
        let protectionEnabled = true;
        
        // ✅ ✅ ✅ التحديث: جعل GitHub مسموحاً
        let allowedDomains = [
            'localhost', 
            '127.0.0.1', 
            'yourdomain.com',
            'github.io',  // ✅ إضافة GitHub Pages
            'github.com'  // ✅ إضافة GitHub الرئيسي
        ];
        
        let notificationsEnabled = false;


        // ✅ متغير جديد: لتخزين المحاضرات التي تم التحقق منها
        let verifiedVideos = new Set();


        // 🆕 متغيرات تتبع المشاهدة للإحصائيات
        let videoStartTime = 0;
        let currentVideoDuration = 0;
        let isVideoCompleted = false;


        // === ✅ دوال مساعدة محسنة ===
        function showNotification(message, type = 'info') {
            if (!notificationsEnabled) return;
            
            notificationManager.show(message, type);
        }


        function showError(message) {
            showNotification(message, 'error');
        }


        function showSuccess(message) {
            showNotification(message, 'success');
        }


        function showWarning(message) {
            showNotification(message, 'warning');
        }


        // جعل الدوال متاحة globally للأنظمة الأخرى
        window.showNotification = showNotification;
        window.showError = showError;
        window.showSuccess = showSuccess;
        window.showWarning = showWarning;
        window.hideAchievementNotification = () => statisticsManager.hideAchievementNotification();


        // === ✅ دوال التشفير والتحميل ===
        async function prepareEncryption() {
            const storedKeys = loadEncryptionKeys();
            if (storedKeys) {
                try {
                    await encryptionSystem.initialize(storedKeys.masterKey);
                    if (storedKeys.sessionKey) {
                        encryptionSystem.sessionKey = storedKeys.sessionKey;
                    }
                    
                    await encryptVideoUrls();
                    
                    sessionKeyInput.value = encryptionSystem.sessionKey;
                    updateTokenDisplay();
                    if (notificationsEnabled) {
                        showNotification('تم تحميل مفاتيح التشفير بنجاح', 'success');
                    }
                    return true;
                } catch (error) {
                    console.error('خطأ في تحضير التشفير:', error);
                    return false;
                }
            }
            return false;
        }


        async function encryptVideoUrls() {
            for (let video of encryptedVideos) {
                if (!video.encryptedUrl && video.originalUrl) {
                    try {
                        video.encryptedUrl = await encryptionSystem.encryptText(video.originalUrl, video.id);
                        console.log(`تم تشفير رابط: ${video.title}`);
                    } catch (error) {
                        console.error(`فشل تشفير ${video.title}:`, error);
                        video.encryptedUrl = video.originalUrl;
                    }
                }
            }
        }


        function loadEncryptionKeys() {
            try {
                const stored = localStorage.getItem('videoEncryptionKeys');
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (error) {
                console.error('Error loading encryption keys:', error);
            }
            return null;
        }


        function saveEncryptionKeysToStorage(masterKey, sessionKey) {
            const keys = {
                masterKey: masterKey,
                sessionKey: sessionKey,
                timestamp: Date.now()
            };
            localStorage.setItem('videoEncryptionKeys', JSON.stringify(keys));
        }


        // === ✅ دوال المشغل الأساسية ===
        function togglePlayPause() {
            if (videoPlayer.paused || videoPlayer.ended) {
                videoPlayer.play().then(() => {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    resetControlsTimer();
                    
                    // 🆕 تحديث الأزرار الخارجية
                    if (window.externalControlsManager) {
                        window.externalControlsManager.updateExternalButtons();
                    }
                    
                    // 🆕 تتبع بداية المشاهدة للإحصائيات
                    if (videoStartTime === 0) {
                        videoStartTime = Date.now();
                    }
                }).catch(e => {
                    console.log('Cannot play video:', e);
                    showError('تعذر تشغيل الفيديو');
                });
            } else {
                videoPlayer.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                
                // 🆕 تحديث الأزرار الخارجية
                if (window.externalControlsManager) {
                    window.externalControlsManager.updateExternalButtons();
                }
            }
        }


        function skipTime(seconds) {
            videoPlayer.currentTime += seconds;
            resetControlsTimer();
        }


        function toggleMute() {
            videoPlayer.muted = !videoPlayer.muted;
            if (videoPlayer.muted) {
                volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                volumeSlider.value = 0;
            } else {
                volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                volumeSlider.value = videoPlayer.volume;
            }
            resetControlsTimer();
            
            // 🆕 تحديث الأزرار الخارجية
            if (window.externalControlsManager) {
                window.externalControlsManager.updateExternalButtons();
            }
        }


        function setVolume() {
            videoPlayer.volume = volumeSlider.value;
            videoPlayer.muted = (videoPlayer.volume === 0);
            if (videoPlayer.volume == 0) {
                volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else if (videoPlayer.volume < 0.5) {
                volumeBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
            } else {
                volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
            resetControlsTimer();
            
            // 🆕 تحديث الأزرار الخارجية
            if (window.externalControlsManager) {
                window.externalControlsManager.updateExternalButtons();
            }
        }


        function toggleLoop() {
            isLoopActive = !isLoopActive;
            videoPlayer.loop = isLoopActive;
            loopBtn.style.color = isLoopActive ? 'var(--accent-color)' : 'white';
            localStorage.setItem('videoLoop', JSON.stringify(isLoopActive));
            resetControlsTimer();
        }


        function toggleSkipButtons() {
            skipButtonsVisible = !skipButtonsVisible;
            updateSkipButtonsVisibility();
            resetControlsTimer();
        }


        function updateSkipButtonsVisibility() {
            if (skipButtonsVisible) {
                skipBackward10.classList.add('show');
                skipForward10.classList.add('show');
                toggleSkipBtns.style.color = 'var(--accent-color)';
            } else {
                skipBackward10.classList.remove('show');
                skipForward10.classList.remove('show');
                toggleSkipBtns.style.color = 'white';
            }
            localStorage.setItem('skipButtonsVisible', JSON.stringify(skipButtonsVisible));
        }


        function toggleSpeedMenu() {
            speedMenu.classList.toggle('active');
            resetControlsTimer();
        }


        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }


        function enterFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }


        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }


        function handleFullscreenChange() {
            if (document.fullscreenElement || document.webkitFullscreenElement || 
                document.mozFullScreenElement || document.msFullscreenElement) {
                body.classList.add('fullscreen');
                isFullscreen = true;
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                exitFullscreenBtn.style.display = 'flex';
                fullscreenOverlay.classList.add('active');
                
                setTimeout(() => {
                    fullscreenOverlay.classList.remove('active');
                }, 1000);
                
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch(err => {
                        console.log('لم يتم تدوير الشاشة: ', err);
                    });
                }
                
                orientationNotice.style.display = 'none';
                resetControlsTimer();
                
                setTimeout(() => {
                    videoControls.classList.add('active');
                    showControls();
                }, 100);
                
                if (notificationsEnabled) {
                    showNotification('تم الدخول إلى وضع الشاشة الكاملة', 'success');
                }
            } else {
                body.classList.remove('fullscreen');
                isFullscreen = false;
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                exitFullscreenBtn.style.display = 'none';
                
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
                
                if (window.innerWidth <= 768) {
                    setTimeout(() => {
                        orientationNotice.style.display = 'flex';
                        orientationNotice.style.opacity = '1';
                        setTimeout(() => {
                            orientationNotice.style.opacity = '0';
                            setTimeout(() => {
                                orientationNotice.style.display = 'none';
                            }, 500);
                        }, 1000);
                    }, 500);
                }
                resetControlsTimer();
            }
        }


        async function togglePiP() {
            try {
                if (document.pictureInPictureElement) {
                    await document.exitPictureInPicture();
                } else if (document.pictureInPictureEnabled) {
                    await videoPlayer.requestPictureInPicture();
                }
                resetControlsTimer();
            } catch (error) {
                console.error('خطأ في وضع PiP:', error);
                if (notificationsEnabled) {
                    showNotification('وضع PiP غير مدعوم في هذا المتصفح', 'error');
                }
            }
        }


        // ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅
        // ✅ التصحيح الرئيسي: إصلاح مشكلة إخفاء الشريط الأسود
        // ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅


        // تحسين دالة إخفاء وعرض عناصر التحكم
function hideControls() {
    if (!videoPlayer.paused && isAutoHideActive) {
        videoControls.classList.add('hidden');
        isControlsVisible = false;
        
        // إخفاء الأزرار الإضافية
        if (skipButtonsVisible) {
            skipBackward10.style.opacity = '0';
            skipForward10.style.opacity = '0';
        }
        
        // إخفاء زر الخروج من الشاشة الكاملة
        if (isFullscreen) {
            exitFullscreenBtn.style.opacity = '0';
        }
    }
}


function showControls() {
    videoControls.classList.remove('hidden');
    isControlsVisible = true;
    
    // إظهار الأزرار الإضافية
    if (skipButtonsVisible) {
        skipBackward10.style.opacity = '1';
        skipForward10.style.opacity = '1';
    }
    
    // إظهار زر الخروج من الشاشة الكاملة
    if (isFullscreen) {
        exitFullscreenBtn.style.opacity = '1';
    }
}


function resetControlsTimer() {
    clearTimeout(controlsTimeout);
    showControls();
    
    if (isAutoHideActive && !videoPlayer.paused) {
        controlsTimeout = setTimeout(() => {
            hideControls();
        }, 2000); // 2 ثانية
    }
}
// تحسينات إضافية للتحكم
function setupEnhancedControls() {
    // إعادة تعيين المؤقت عند أي تفاعل
    const controlElements = [
        videoPlayer, progressContainer, playPauseBtn, 
        volumeBtn, volumeSlider, fullscreenBtn
    ];
    
    controlElements.forEach(element => {
        element.addEventListener('mousemove', resetControlsTimer);
        element.addEventListener('touchmove', resetControlsTimer);
        element.addEventListener('click', resetControlsTimer);
        element.addEventListener('touchstart', resetControlsTimer);
    });
    
    // منع إخفاء العناصر عند التمرير
    progressContainer.addEventListener('mouseenter', () => {
        clearTimeout(controlsTimeout);
    });
    
    progressContainer.addEventListener('mouseleave', () => {
        if (!videoPlayer.paused) {
            resetControlsTimer();
        }
    });
}


        // === ✅ شريط التقدم ===
        function setupProgressBar() {
            videoPlayer.addEventListener('timeupdate', updateProgress);
            progressContainer.addEventListener('mousemove', handleProgressHover);
            progressContainer.addEventListener('mouseleave', () => { if (!isDragging) hidePreview(); });
            progressContainer.addEventListener('mousedown', startDrag);
            progressContainer.addEventListener('touchstart', handleTouchStart, {passive: false});
            window.addEventListener('mousemove', handleDrag);
            window.addEventListener('mouseup', stopDrag);
            window.addEventListener('touchmove', handleTouchMove, {passive: false});
            window.addEventListener('touchend', handleTouchEnd, {passive: false});
        }


        function updateProgress() {
            if (!isDragging) {
                const pct = (videoPlayer.currentTime / (videoPlayer.duration || 1)) * 100;
                progress.style.width = pct + '%';
                thumb.style.left = pct + '%';
                
                if (videoPlayer.buffered.length > 0) {
                    const bufferedEnd = videoPlayer.buffered.end(videoPlayer.buffered.length - 1);
                    const bufferedPercent = (bufferedEnd / videoPlayer.duration) * 100;
                    bufferBar.style.width = `${bufferedPercent}%`;
                }
            }
            updateTimeDisplay();
            
            if (Math.floor(videoPlayer.currentTime) % 10 === 0) {
                saveVideoProgress();
            }
            
            // 🆕 تتبع إكمال الفيديو للإحصائيات
            if (videoPlayer.duration && videoPlayer.currentTime / videoPlayer.duration >= 0.9 && !isVideoCompleted) {
                isVideoCompleted = true;
                // سيتم تسجيل الإحصائيات عند انتهاء الفيديو
            }
        }


        function updateTimeDisplay() {
            currentTimeEl.textContent = formatTime(videoPlayer.currentTime);
            durationEl.textContent = formatTime(videoPlayer.duration);
        }


        function formatTime(sec) {
            if (isNaN(sec) || !isFinite(sec)) return '0:00';
            sec = Math.floor(sec);
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }


        function startDrag(e) {
            isDragging = true;
            videoPlayer.pause();
            document.body.style.userSelect = 'none';
            progressContainer.classList.add('dragging');
            const pct = calcPercentFromEvent(e);
            updateDragPosition(pct);
            resetControlsTimer();
        }


        function handleDrag(e) {
            if (!isDragging) return;
            const pct = calcPercentFromEvent(e);
            updateDragPosition(pct);
        }


        function stopDrag(e) {
            if (!isDragging) return;
            isDragging = false;
            document.body.style.userSelect = '';
            progressContainer.classList.remove('dragging');
            const pct = calcPercentFromEvent(e);
            const t = (videoPlayer.duration || 0) * pct;
            if (!isNaN(t) && isFinite(t)) videoPlayer.currentTime = t;
            videoPlayer.play();
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            hidePreview();
            resetControlsTimer();
        }


        function handleTouchStart(e) {
            e.preventDefault();
            isDragging = true;
            videoPlayer.pause();
            progressContainer.classList.add('dragging');
            const pct = calcPercentFromEvent(e);
            updateDragPosition(pct);
        }


        function handleTouchMove(e) {
            if (!isDragging) return;
            const pct = calcPercentFromEvent(e);
            updateDragPosition(pct);
        }


        function handleTouchEnd(e) {
            if (!isDragging) return;
            isDragging = false;
            progressContainer.classList.remove('dragging');
            const pct = calcPercentFromEvent(e.changedTouches[0]);
            const t = (videoPlayer.duration || 0) * pct;
            if (!isNaN(t) && isFinite(t)) videoPlayer.currentTime = t;
            videoPlayer.play();
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            hidePreview();
        }


        function calcPercentFromEvent(e) {
            const rect = progressContainer.getBoundingClientRect();
            const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
            let x = clientX - rect.left;
            return Math.min(Math.max(0, x / rect.width), 1);
        }


        function updateDragPosition(pct) {
            const t = (videoPlayer.duration || 0) * pct;
            const pPct = pct * 100;
            progress.style.width = pPct + '%';
            thumb.style.left = pPct + '%';
            showPreviewAtPercent(pct);
            previewTime.textContent = formatTime(t);
        }


        function setupPreviewSystem() {
            // نظام المعاينة الأساسي
        }


        function handleProgressHover(e) {
            const pct = calcPercentFromEvent(e);
            showPreviewAtPercent(pct);
            const t = (videoPlayer.duration || 0) * pct;
            previewTime.textContent = formatTime(t);
        }


        function showPreviewAtPercent(pct) {
            const rect = progressContainer.getBoundingClientRect();
            const left = rect.left + pct * rect.width;
            const containerRect = progressContainer.getBoundingClientRect();
            const boxHalf = document.getElementById('previewBox').offsetWidth / 2;
            let boxLeft = left - containerRect.left;
            if (boxLeft < boxHalf) boxLeft = boxHalf;
            if (boxLeft > containerRect.width - boxHalf) boxLeft = containerRect.width - boxHalf;
            document.getElementById('previewBox').style.left = boxLeft + 'px';
            document.getElementById('previewBox').classList.add('active');
            document.getElementById('previewBox').setAttribute('aria-hidden', 'false');
        }


        function hidePreview() {
            document.getElementById('previewBox').classList.remove('active');
            document.getElementById('previewBox').setAttribute('aria-hidden', 'true');
        }
// نظام الضغط المطول المحسن والمضمون
class LongPressManager {
    constructor() {
        this.longPressTimer = null;
        this.isLongPressActive = false;
        this.originalPlaybackRate = 1.0;
        this.init();
    }


    init() {
        this.setupEventListeners();
    }


    setupEventListeners() {
        // للهواتف - استخدام Touch Events
        videoPlayer.addEventListener('touchstart', (e) => this.handleStart(e), { passive: false });
        videoPlayer.addEventListener('touchend', (e) => this.handleEnd(e));
        videoPlayer.addEventListener('touchcancel', (e) => this.handleEnd(e));
        
        // للكمبيوتر - استخدام Mouse Events
        videoPlayer.addEventListener('mousedown', (e) => this.handleStart(e));
        videoPlayer.addEventListener('mouseup', (e) => this.handleEnd(e));
        videoPlayer.addEventListener('mouseleave', (e) => this.handleEnd(e));
        
        // منع السلوك الافتراضي للنقر المزدوج
        videoPlayer.addEventListener('dblclick', (e) => {
            e.preventDefault();
        });
    }


    handleStart(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('بدء الضغط - التسريع قيد التفعيل');
        
        this.isLongPressActive = false;
        this.originalPlaybackRate = videoPlayer.playbackRate;
        
        // بدء المؤقت للضغط المطول
        this.longPressTimer = setTimeout(() => {
            this.activateSpeedBoost();
        }, 600); // 600 مللي ثانية
    }


    handleEnd(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('انتهاء الضغط');
        
        // إلغاء المؤقت
        if (this.longPressTimer) {
            clearTimeout(this.longPressTimer);
            this.longPressTimer = null;
        }
        
        // إذا كان التسريع مفعل، إلغائه
        if (this.isLongPressActive) {
            this.deactivateSpeedBoost();
        }
    }


    activateSpeedBoost() {
        console.log('تفعيل التسريع إلى 2x');
        
        this.isLongPressActive = true;
        videoPlayer.playbackRate = 2.0;
        
        // تحديث العرض
        if (speedDisplay) {
            speedDisplay.textContent = '2x';
        }
        
        // إظهار التأثير البصري
        if (longPressOverlay) {
            longPressOverlay.classList.add('active');
        }
        
        // إشعار للمستخدم
        showNotification('🎯 التسريع مفعل (2x) - ارفع إصبعك للإلغاء', 'success');
        
        // تفعيل الإنجاز
        if (window.statisticsManager) {
            window.statisticsManager.unlockAchievement('speed_learner');
        }
        
        resetControlsTimer();
    }


    deactivateSpeedBoost() {
        console.log('إلغاء التسريع - العودة إلى السرعة الطبيعية');
        
        this.isLongPressActive = false;
        videoPlayer.playbackRate = this.originalPlaybackRate;
        
        // تحديث العرض
        if (speedDisplay) {
            speedDisplay.textContent = '1x';
        }
        
        // إخفاء التأثير البصري
        if (longPressOverlay) {
            longPressOverlay.classList.remove('active');
        }
        
        // إشعار للمستخدم
        showNotification('↩️ العودة للسرعة الطبيعية (1x)', 'info');
    }


    // تنظيف الذاكرة
    destroy() {
        if (this.longPressTimer) {
            clearTimeout(this.longPressTimer);
        }
        this.isLongPressActive = false;
    }
}


// تهيئة نظام الضغط المطول
let longPressManager;


function setupLongPress() {
    longPressManager = new LongPressManager();
}


        // === ✅ النقر المزدوج ===
        function setupDoubleTap() {
            videoPlayer.addEventListener('touchend', handleDoubleTap);
            videoPlayer.addEventListener('dblclick', handleDoubleClick);
        }


        function handleDoubleTap(e) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 300 && tapLength > 0) {
                e.preventDefault();
                processDoubleTap(e.changedTouches[0].clientX);
            }
            lastTap = currentTime;
        }


        function handleDoubleClick(e) {
            e.preventDefault();
            processDoubleTap(e.clientX);
        }


        function processDoubleTap(clientX) {
            const videoRect = videoPlayer.getBoundingClientRect();
            const videoWidth = videoRect.width;
            const tapX = clientX - videoRect.left;
            
            if (tapX < videoWidth / 2) {
                videoPlayer.currentTime -= 10;
                document.getElementById('doubleTapIcon').className = 'fas fa-backward';
                document.getElementById('doubleTapText').textContent = 'رجوع 10 ثواني';
            } else {
                videoPlayer.currentTime += 10;
                document.getElementById('doubleTapIcon').className = 'fas fa-forward';
                document.getElementById('doubleTapText').textContent = 'تقديم 10 ثواني';
            }
            
            document.getElementById('doubleTapOverlay').classList.add('active');
            setTimeout(() => {
                document.getElementById('doubleTapOverlay').classList.remove('active');
            }, 1000);
            resetControlsTimer();
        }


        // === ✅ النقر للعب/الإيقاف ===
        function setupTapToPlayPause() {
            videoPlayer.addEventListener('click', togglePlayPause);
            if (isMobile) {
                videoPlayer.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    togglePlayPause();
                });
            }
        }


        // === ✅ تحميل الفيديو المشفر ===
        async function loadEncryptedVideo(index) {
            if (index < 0 || index >= encryptedVideos.length) return;
            
            if (!encryptionSystem.initialized) {
                if (notificationsEnabled) {
                    showNotification('نظام التشفير غير مهيأ', 'error');
                }
                showKeyManagement();
                return;
            }
async function initializePlayer() {
    // ... الكود الحالي
    
    // إضافة هذه السطر بعد setupEventListeners
    setupEnhancedControls();
    
    // ... باقي الكود
}
            if (decryptionInProgress) {
                if (notificationsEnabled) {
                    showNotification('جاري فك تشفير فيديو آخر', 'info');
                }
                return;
            }
            
            const videoData = encryptedVideos[index];
            
            try {
                decryptionInProgress = true;
                encryptionLoader.classList.add('active');
                
                simulateDecryptionProgress();
                
                // ✅ فك تشفير الرابط
                let videoUrl;
                if (videoData.encryptedUrl && videoData.encryptedUrl !== videoData.originalUrl) {
                    videoUrl = await encryptionSystem.decryptText(videoData.encryptedUrl, videoData.id);
                } else {
                    videoUrl = videoData.originalUrl;
                }
                
                if (!isValidVideoUrl(videoUrl)) {
                    throw new Error('رابط الفيديو غير صالح بعد فك التشفير');
                }
                
                // ⭐ محسّن: استخدام نظام التحميل المحسن
                await downloadManager.loadVideoFromUrl(videoUrl, videoData);
                
                encryptionLoader.classList.remove('active');
                decryptionInProgress = false;
                
                if (notificationsEnabled) {
                    showNotification(`تم تحميل ${videoData.title}`, 'success');
                }
                
                // 🆕 تسجيل بداية المشاهدة للإحصائيات
                videoStartTime = Date.now();
                currentVideoDuration = videoPlayer.duration || 0;
                isVideoCompleted = false;
                
            } catch (error) {
                encryptionLoader.classList.remove('active');
                decryptionInProgress = false;
                
                console.error('فك التشفير فشل:', error);
                
                try {
                    if (notificationsEnabled) {
                        showNotification('جاري التحميل بدون تشفير...', 'info');
                    }
                    await downloadManager.loadVideoFromUrl(videoData.originalUrl, videoData);
                } catch (fallbackError) {
                    encryptionSystem.log(`فشل تحميل الفيديو ${videoData.id}: ${error.message}`);
                    if (notificationsEnabled) {
                        showNotification(`فشل تحميل الفيديو: ${error.message}`, 'error');
                    }
                    
                    setTimeout(() => {
                        showKeyManagement();
                    }, 2000);
                }
            }
        }


        function simulateDecryptionProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                decryptionProgress.textContent = `${Math.min(progress, 100).toFixed(0)}%`;
            }, 200);
        }


        async function loadVideoFromUrl(videoUrl, videoData) {
            return downloadManager.loadVideoFromUrl(videoUrl, videoData);
        }


        function isValidVideoUrl(url) {
            try {
                const parsed = new URL(url);
                return parsed.protocol === 'http:' || parsed.protocol === 'https:';
            } catch {
                return false;
            }
        }


        // === ✅ تغيير الفيديو ===
        function loadVideo(index) {
            if (encryptionSystem.initialized) {
                loadEncryptedVideo(index);
            } else {
                if (notificationsEnabled) {
                    showNotification('يجب تهيئة نظام التشفير أولاً', 'error');
                }
                showKeyManagement();
            }
        }


        function changeVideo(index) {
            playlistItems.forEach(i => i.classList.remove('active'));
            playlistItems[index].classList.add('active');
            
            if (protectionEnabled && !verifiedVideos.has(index)) {
                showAccessControl(index);
            } else {
                loadVideo(index);
            }
        }


        // === ✅ نظام الحماية ===
        function setupProtectionSystem() {
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showDownloadBlocker();
                return false;
            });
            
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    showDownloadBlocker();
                    return false;
                }
                
                if (e.key === 'F12') {
                    e.preventDefault();
                    if (notificationsEnabled) {
                        showNotification('أدوات المطور غير مسموحة', 'error');
                    }
                    return false;
                }
                
                if ((e.ctrlKey && e.shiftKey && e.key === 'I') || (e.metaKey && e.altKey && e.key === 'i')) {
                    e.preventDefault();
                    if (notificationsEnabled) {
                        showNotification('أدوات المطور غير مسموحة', 'error');
                    }
                    return false;
                }
            });
            
            videoPlayer.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            videoPlayer.addEventListener('copy', function(e) {
                e.preventDefault();
                if (notificationsEnabled) {
                    showNotification('نسخ المحتوى غير مسموح', 'error');
                }
                return false;
            });
            
            window.addEventListener('blur', function() {
                if (document.activeElement && document.activeElement.tagName === 'VIDEO') {
                    setTimeout(() => {
                        if (document.hidden) {
                            if (notificationsEnabled) {
                                showNotification('فتح الفيديو في علامة تبويب جديدة غير مسموح', 'error');
                            }
                        }
                    }, 100);
                }
            });
            
            updateWatermark();
            setInterval(updateWatermark, 1000);
            
            videoPlayer.controls = false;
            videoPlayer.setAttribute('preload', 'metadata');
        }


        function showAccessControl(videoIndex) {
            currentVideoIndex = videoIndex;
            const video = encryptedVideos[videoIndex];
            
            if (verifiedVideos.has(videoIndex)) {
                loadVideo(videoIndex);
                return;
            }
            
            protectionMessage.textContent = `يرجى إدخال كلمة المرور لمشاهدة: ${video.title}`;
            protectionInput.value = '';
            protectionOverlay.classList.add('active');
            
            setTimeout(() => {
                protectionInput.focus();
            }, 500);
        }


        function verifyAccessCode() {
            const enteredCode = protectionInput.value;
            const video = encryptedVideos[currentVideoIndex];
            
            if (enteredCode === video.accessCode) {
                verifiedVideos.add(currentVideoIndex);
                protectionOverlay.classList.remove('active');
                loadVideo(currentVideoIndex);
                if (notificationsEnabled) {
                    showNotification('تم التحقق بنجاح، جاري تحميل الفيديو', 'success');
                }
                
                sessionStartTime = Date.now();
                startSessionTimer();
            } else {
                protectionInput.value = '';
                protectionInput.placeholder = 'كلمة المرور غير صحيحة، حاول مرة أخرى';
                protectionInput.style.borderColor = '#ff6b6b';
                setTimeout(() => {
                    protectionInput.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                    protectionInput.placeholder = 'أدخل كلمة المرور';
                }, 2000);
            }
        }


        function showDownloadBlocker() {
            downloadBlocker.style.display = 'flex';
            setTimeout(() => {
                downloadBlocker.style.display = 'none';
            }, 3000);
        }


        function updateWatermark() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-EG');
            const dateString = now.toLocaleDateString('ar-EG');
            watermark.innerHTML = `© Youssef Eltawel - ${dateString} ${timeString}`;
        }


        function startSession() {
            sessionStartTime = Date.now();
            startSessionTimer();
        }


        function startSessionTimer() {
            if (sessionTimerInterval) {
                clearInterval(sessionTimerInterval);
            }
            
            sessionTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
                const remaining = sessionDuration - elapsed;
                
                if (remaining <= 0) {
                    clearInterval(sessionTimerInterval);
                    endSession();
                    return;
                }
            }, 1000);
        }


        function endSession() {
            verifiedVideos.clear();
            videoPlayer.pause();
            protectionOverlay.classList.add('active');
            protectionMessage.textContent = 'انتهت مدة الجلسة. يرجى إدخال كلمة المرور مرة أخرى.';
            if (notificationsEnabled) {
                showNotification('انتهت مدة الجلسة', 'error');
            }
        }


        // ✅ ✅ ✅ التحديث: تحقق النطاق المحسن لدعم GitHub
        function checkDomain() {
            const currentDomain = window.location.hostname;
            
            // ✅ ✅ ✅ تحسين متقدم لـ GitHub Pages
            const isGitHubPages = currentDomain.endsWith('.github.io');
            const isLocalhost = currentDomain === 'localhost' || currentDomain === '127.0.0.1';
            const isAllowedDomain = allowedDomains.some(domain => 
                currentDomain === domain || currentDomain.endsWith('.' + domain)
            );
            
            return isGitHubPages || isLocalhost || isAllowedDomain;
        }


        function showDomainError() {
            document.body.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #121212; color: white; text-align: center; padding: 20px;">
                    <i class="fas fa-ban" style="font-size: 4rem; color: #ff6b6b; margin-bottom: 20px;"></i>
                    <h1 style="font-size: 2rem; margin-bottom: 15px; color: #ff6b6b;">وصول غير مصرح</h1>
                    <p style="font-size: 1.2rem; margin-bottom: 10px; max-width: 500px; line-height: 1.6;">
                        هذا المحتوى غير متاح من هذا المجال.
                    </p>
                    <p style="font-size: 1rem; opacity: 0.8;">
                        يرجى الوصول من المجال الرسمي للمحتوى.
                    </p>
                </div>
            `;
        }


        // === ✅ إدارة مفاتيح التشفير ===
        function showKeyManagement() {
            keyManagement.classList.add('active');
            encryptionKeyInput.focus();
            
            if (!sessionKeyInput.value) {
                sessionKeyInput.value = encryptionSystem.generateSessionKey();
            }
        }


        function hideKeyManagement() {
            keyManagement.classList.remove('active');
            encryptionKeyInput.value = '';
        }


        async function saveEncryptionKeys() {
            const masterKey = encryptionKeyInput.value.trim();
            const sessionKey = sessionKeyInput.value.trim();
            
            if (!masterKey) {
                if (notificationsEnabled) {
                    showNotification('يرجى إدخال المفتاح الرئيسي', 'error');
                }
                encryptionKeyInput.focus();
                return;
            }
            
            if (masterKey.length < 8) {
                if (notificationsEnabled) {
                    showNotification('المفتاح الرئيسي يجب أن يكون 8 أحرف على الأقل', 'error');
                }
                encryptionKeyInput.focus();
                return;
            }
            
            try {
                encryptionLoader.classList.add('active');
                decryptionProgress.textContent = 'جاري التهيئة...';
                
                await encryptionSystem.initialize(masterKey);
                
                if (sessionKey) {
                    encryptionSystem.sessionKey = sessionKey;
                }
                
                await encryptVideoUrls();
                
                saveEncryptionKeysToStorage(masterKey, encryptionSystem.sessionKey);
                
                updateTokenDisplay();
                
                hideKeyManagement();
                encryptionLoader.classList.remove('active');
                
                if (notificationsEnabled) {
                    showNotification('تم حفظ مفاتيح التشفير بنجاح', 'success');
                }
                
                if (protectionEnabled) {
                    showAccessControl(0);
                } else {
                    loadVideo(0);
                }
                
            } catch (error) {
                encryptionLoader.classList.remove('active');
                if (notificationsEnabled) {
                    showNotification(`خطأ في حفظ المفاتيح: ${error.message}`, 'error');
                }
            }
        }


        function updateTokenDisplay() {
            // تم إخفاء العرض
        }


        // === ✅ حفظ واستعادة التقدم ===
        function saveVideoProgress() {
            if (videoPlayer.currentTime > 10) {
                const videoSrc = videoPlayer.currentSrc;
                const progress = {
                    time: videoPlayer.currentTime,
                    timestamp: Date.now()
                };
                localStorage.setItem(`videoProgress_${btoa(videoSrc)}`, JSON.stringify(progress));
            }
        }


        function restoreVideoProgress() {
            const videoSrc = videoPlayer.currentSrc;
            const savedProgress = localStorage.getItem(`videoProgress_${btoa(videoSrc)}`);
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                if (Date.now() - progress.timestamp < 24 * 60 * 60 * 1000) {
                    videoPlayer.currentTime = progress.time;
                    if (notificationsEnabled) {
                        showNotification('تم استعادة التقدم السابق', 'success');
                    }
                }
            }
        }


        // === ✅ معالجة الأخطاء ===
        function handleVideoError(e) {
            console.error('خطأ في تحميل الفيديو:', e);
            loadingSpinner.style.display = 'none';
            errorCount++;
            
            if (errorCount <= MAX_ERROR_RETRIES) {
                errorText.textContent = `حدث خطأ في تحميل الفيديو (المحاولة ${errorCount}/${MAX_ERROR_RETRIES})`;
                errorMessage.style.display = 'block';
                if (notificationsEnabled) {
                    showNotification('حدث خطأ في تحميل الفيديو', 'error');
                }
            } else {
                errorText.textContent = 'فشل تحميل الفيديو بعد عدة محاولات. يرجى التحقق من اتصال الإنترنت أو تجربة فيديو آخر.';
                errorMessage.style.display = 'block';
                if (notificationsEnabled) {
                    showNotification('فشل تحميل الفيديو بعد عدة محاولات', 'error');
                }
            }
        }


        function retryVideoLoad() {
            loadVideo(currentVideoIndex);
        }


        // === ✅ مراقبة حالة الشبكة ===
        function setupNetworkMonitoring() {
            window.addEventListener('online', handleNetworkChange);
            window.addEventListener('offline', handleNetworkChange);
            updateNetworkStatus();
        }


        function handleNetworkChange() {
            networkOnline = navigator.onLine;
            updateNetworkStatus();
            
            if (networkOnline) {
                if (notificationsEnabled) {
                    showNotification('تم استعادة الاتصال بالإنترنت', 'success');
                }
            } else {
                if (notificationsEnabled) {
                    showNotification('فقدان الاتصال بالإنترنت', 'error');
                }
            }
        }


        function updateNetworkStatus() {
            if (networkOnline) {
                networkStatus.className = 'network-status online';
                networkIcon.className = 'fas fa-wifi';
                networkText.textContent = 'الاتصال بالإنترنت متوفر';
            } else {
                networkStatus.className = 'network-status offline';
                networkIcon.className = 'fas fa-wifi-slash';
                networkText.textContent = 'لا يوجد اتصال بالإنترنت';
            }
            
            networkStatus.style.display = 'block';
            setTimeout(() => {
                networkStatus.style.display = 'none';
            }, 3000);
        }


        // === ✅ معالجة نهاية الفيديو ===
        function handleVideoEnded() {
            // 🆕 تسجيل إحصائيات المشاهدة
            if (videoStartTime > 0) {
                const watchDuration = Math.floor((Date.now() - videoStartTime) / 1000); // بالثواني
                const completionPercent = isVideoCompleted ? 100 : Math.floor((videoPlayer.currentTime / currentVideoDuration) * 100);
                
                statisticsManager.recordVideoWatch(watchDuration, completionPercent);
                
                // إعادة تعيين متغيرات التتبع
                videoStartTime = 0;
                currentVideoDuration = 0;
                isVideoCompleted = false;
            }
            
            if (isLoopActive) {
                videoPlayer.currentTime = 0;
                videoPlayer.play();
            } else if (currentVideoIndex < encryptedVideos.length - 1) {
                setTimeout(() => {
                    changeVideo(currentVideoIndex + 1);
                }, 2000);
            }
        }


        // === ✅ اختصارات لوحة المفاتيح ===
        function handleKeydown(e) {
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key) {
                case ' ':
                case 'k':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'f':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'm':
                    e.preventDefault();
                    toggleMute();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    videoPlayer.currentTime -= 5;
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    videoPlayer.currentTime += 5;
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    videoPlayer.volume = Math.min(videoPlayer.volume + 0.1, 1);
                    volumeSlider.value = videoPlayer.volume;
                    setVolume();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    videoPlayer.volume = Math.max(videoPlayer.volume - 0.1, 0);
                    volumeSlider.value = videoPlayer.volume;
                    setVolume();
                    break;
            }
        }


        // === ✅ دوال مساعدة ===
        function getThemeName(theme) {
            const themes = {
                'default': 'الافتراضية',
                'dark': 'المظلمة', 
                'blue': 'الزرقاء',
                'green': 'الخضراء',
                'premium': 'المميزة'
            };
            return themes[theme] || theme;
        }


        function toggleNotifications() {
            notificationsEnabled = !notificationsEnabled;
            notificationsToggle.classList.toggle('active', notificationsEnabled);
            localStorage.setItem('notificationsEnabled', JSON.stringify(notificationsEnabled));
            
            if (notificationsEnabled) {
                showNotification('تم تفعيل الإشعارات', 'success');
            }
        }


        // === ✅ نظام الإشارات المرجعية ===
        function setupBookmarkSystem() {
            addBookmarkBtn.addEventListener('click', addBookmark);
            document.addEventListener('click', (e) => {
                if (!addBookmarkBtn.contains(e.target) && !bookmarksPanel.contains(e.target)) {
                    bookmarksPanel.classList.remove('active');
                }
            });
        }


        function addBookmark() {
            const currentTime = videoPlayer.currentTime;
            const videoData = encryptedVideos[currentVideoIndex];
            
            if (!videoData) return;
            
            const bookmarkTitle = `إشارة في ${formatTime(currentTime)}`;
            const bookmark = bookmarkManager.addBookmark(
                videoData.id,
                currentTime,
                bookmarkTitle
            );
            
            updateBookmarksList();
            showSuccess(`تم إضافة إشارة مرجعية في ${formatTime(currentTime)}`);
            
            // 🆕 فتح إنجاز الإشارات المرجعية
            if (window.statisticsManager) {
                window.statisticsManager.unlockAchievement('bookmark_expert');
            }
        }


        function updateBookmarksList() {
            const videoData = encryptedVideos[currentVideoIndex];
            if (!videoData) return;
            
            const bookmarks = bookmarkManager.getBookmarksForVideo(videoData.id);
            bookmarksList.innerHTML = '';
            
            if (bookmarks.length === 0) {
                bookmarksList.innerHTML = '<div style="color: rgba(255,255,255,0.7); text-align: center; padding: 10px;">لا توجد إشارات مرجعية</div>';
                return;
            }
            
            bookmarks.forEach(bookmark => {
                const bookmarkItem = document.createElement('div');
                bookmarkItem.className = 'bookmark-item';
                bookmarkItem.innerHTML = `
                    <div>
                        <div style="font-size: 0.9rem;">${bookmark.title}</div>
                        <div class="bookmark-time">${formatTime(bookmark.timestamp)}</div>
                    </div>
                    <div class="bookmark-actions">
                        <button class="bookmark-action-btn" onclick="jumpToBookmark('${bookmark.id}')" title="الانتقال">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="bookmark-action-btn" onclick="deleteBookmark('${bookmark.id}')" title="حذف">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                bookmarksList.appendChild(bookmarkItem);
            });
        }


        function jumpToBookmark(bookmarkId) {
            const bookmark = bookmarkManager.bookmarks.get(bookmarkId);
            if (bookmark) {
                bookmarkManager.jumpToBookmark(bookmark);
                bookmarksPanel.classList.remove('active');
            }
        }


        function deleteBookmark(bookmarkId) {
            bookmarkManager.removeBookmark(bookmarkId);
            updateBookmarksList();
            showSuccess('تم حذف الإشارة المرجعية');
        }


        function toggleBookmarksPanel() {
            updateBookmarksList();
            bookmarksPanel.classList.toggle('active');
        }


        // === ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅
        // ✅ النظام الجديد: زر اختيار المحاضرات
        // === ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅ ✅


        // دالة لعرض نافذة المحاضرات
        function showLecturesModal() {
            protectionOverlay.classList.remove('active');
            lecturesModal.classList.add('active');
            populateLecturesList();
        }


        // دالة لملء قائمة المحاضرات
        function populateLecturesList() {
            lecturesList.innerHTML = '';
            
            encryptedVideos.forEach((video, index) => {
                const lectureItem = document.createElement('div');
                lectureItem.className = 'lecture-option';
                lectureItem.innerHTML = `
                    <div class="lecture-title">${video.title}</div>
                    <div class="lecture-desc">${getLectureDescription(index)}</div>
                `;
                
                lectureItem.addEventListener('click', () => {
                    selectLecture(index);
                });
                
                lecturesList.appendChild(lectureItem);
            });
        }


        // دالة للحصول على وصف المحاضرة
        function getLectureDescription(index) {
            const descriptions = [
                'شرح الأساسيات والمفاهيم الأولية',
                'التطبيق العملي والأمثلة الواقعية', 
                'التقنيات المتقدمة والذكاء الاصطناعي'
            ];
            return descriptions[index] || 'محاضرة تعليمية';
        }


        // دالة لاختيار محاضرة
        function selectLecture(index) {
            lecturesModal.classList.remove('active');
            currentVideoIndex = index;
            showAccessControl(index);
        }


        // === ✅ إعداد مستمعي الأحداث ===
        function setupEventListeners() {
            // أحداث الفيديو
            videoPlayer.addEventListener('loadedmetadata', () => {
                updateTimeDisplay();
                currentVideoDuration = videoPlayer.duration;
            });
            videoPlayer.addEventListener('error', handleVideoError);
            videoPlayer.addEventListener('loadstart', () => loadingSpinner.style.display = 'block');
            videoPlayer.addEventListener('canplaythrough', () => loadingSpinner.style.display = 'none');
            videoPlayer.addEventListener('ended', handleVideoEnded);
            
            // 🆕 حدث لتسجيل المشاهدة عند التبديل بين الفيديوهات
            videoPlayer.addEventListener('loadstart', () => {
                if (videoStartTime > 0) {
                    const watchDuration = Math.floor((Date.now() - videoStartTime) / 1000);
                    const completionPercent = Math.floor((videoPlayer.currentTime / currentVideoDuration) * 100);
                    statisticsManager.recordVideoWatch(watchDuration, completionPercent);
                    videoStartTime = Date.now();
                }
            });
            
            // أحداث الأزرار
            playPauseBtn.addEventListener('click', togglePlayPause);
            rewindBtn.addEventListener('click', () => skipTime(-10));
            forwardBtn.addEventListener('click', () => skipTime(10));
            skipBackward10.addEventListener('click', () => skipTime(-10));
            skipForward10.addEventListener('click', () => skipTime(10));
            volumeBtn.addEventListener('click', toggleMute);
            volumeSlider.addEventListener('input', setVolume);
            loopBtn.addEventListener('click', toggleLoop);
            toggleSkipBtns.addEventListener('click', toggleSkipButtons);
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            exitFullscreenBtn.addEventListener('click', exitFullscreen);
            pipBtn.addEventListener('click', togglePiP);
            retryBtn.addEventListener('click', retryVideoLoad);
            protectionBtn.addEventListener('click', verifyAccessCode);
            protectionInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyAccessCode();
                }
            });
            notificationsToggle.addEventListener('click', toggleNotifications);
            addBookmarkBtn.addEventListener('click', toggleBookmarksPanel);
            
            // ✅ الأحداث الجديدة لزر اختيار المحاضرات
            chooseOtherLectureBtn.addEventListener('click', showLecturesModal);
            closeLecturesModal.addEventListener('click', () => {
                lecturesModal.classList.remove('active');
                protectionOverlay.classList.add('active');
            });
            
            // إغلاق النافذة عند النقر خارجها
            lecturesModal.addEventListener('click', (e) => {
                if (e.target === lecturesModal) {
                    lecturesModal.classList.remove('active');
                    protectionOverlay.classList.add('active');
                }
            });
            
            // أحداث التشفير
            saveKeyBtn.addEventListener('click', saveEncryptionKeys);
            cancelKeyBtn.addEventListener('click', hideKeyManagement);
            
            encryptionKeyInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveEncryptionKeys();
                }
            });
            
            // السرعة
            speedDisplay.addEventListener('click', toggleSpeedMenu);
            speedOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const speed = parseFloat(option.getAttribute('data-speed'));
                    videoPlayer.playbackRate = speed;
                    speedDisplay.textContent = `${speed}x`;
                    speedOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    speedMenu.classList.remove('active');
                    resetControlsTimer();
                });
            });
            
            // الإعدادات
            loopToggle.addEventListener('change', function() {
                isLoopActive = this.checked;
                videoPlayer.loop = isLoopActive;
                loopBtn.style.color = isLoopActive ? 'var(--accent-color)' : 'white';
                localStorage.setItem('videoLoop', JSON.stringify(isLoopActive));
            });
            
            autoplayToggle.addEventListener('change', function() {
                isAutoplayActive = this.checked;
                localStorage.setItem('videoAutoplay', JSON.stringify(isAutoplayActive));
            });
            
            autoHideToggle.addEventListener('change', function() {
                isAutoHideActive = this.checked;
                localStorage.setItem('videoAutoHide', JSON.stringify(isAutoHideActive));
                if (!isAutoHideActive) {
                    showControls();
                    clearTimeout(controlsTimeout);
                } else {
                    resetControlsTimer();
                }
            });
            
            offlineModeToggle.addEventListener('change', function() {
                isOfflineModeActive = this.checked;
                localStorage.setItem('offlineMode', JSON.stringify(isOfflineModeActive));
                if (isOfflineModeActive) {
                    showNotification('تم تفعيل وضع العمل بدون إنترنت', 'success');
                }
            });
            
            // السمات
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('videoPlayerTheme', theme);
                    themeOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    if (notificationsEnabled) {
                        showNotification(`تم تطبيق السمة ${getThemeName(theme)}`, 'success');
                    }
                });
            });
            
            // قائمة التشغيل
            playlistItems.forEach((item, index) => {
                item.addEventListener('click', () => {
                    if (!protectionEnabled || verifiedVideos.has(index)) {
                        playlistItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        loadVideo(index);
                    } else {
                        showAccessControl(index);
                    }
                });
            });
            
            // أحداث全局
            document.addEventListener('click', (e) => {
                if (!speedDisplay.contains(e.target) && !speedMenu.contains(e.target)) {
                    speedMenu.classList.remove('active');
                }
            });
            
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
            
            document.addEventListener('keydown', handleKeydown);
            
            const videoWrapper = document.querySelector('.video-wrapper');
            videoWrapper.addEventListener('mousemove', resetControlsTimer);
            videoWrapper.addEventListener('touchstart', resetControlsTimer);
            videoWrapper.addEventListener('touchend', resetControlsTimer);
            videoWrapper.addEventListener('mouseenter', () => {
                if (skipButtonsVisible) {
                    skipBackward10.style.opacity = '1';
                    skipForward10.style.opacity = '1';
                }
                resetControlsTimer();
            });
            videoWrapper.addEventListener('mouseleave', () => {
                if (!videoPlayer.paused) {
                    skipBackward10.style.opacity = '0';
                    skipForward10.style.opacity = '0';
                }
            });
            
            window.addEventListener('resize', function() {
                if (body.classList.contains('fullscreen')) {
                    setTimeout(resetControlsTimer, 100);
                }
            });
        }


        // === ✅ التهيئة النهائية ===
        const savedTheme = localStorage.getItem('videoPlayerTheme') || 'default';
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeOptions.forEach(option => {
            if (option.getAttribute('data-theme') === savedTheme) {
                option.classList.add('active');
            }
        });


        // === ✅ بدء التشغيل ===
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayer();
            
            setTimeout(() => {
                showNotification('مرحباً بك في مشغل الفيديو المحسن!', 'info');
            }, 1000);
        });


        // دوال التهيئة الأساسية
        async function initializePlayer() {
            try {
                // ✅ ✅ ✅ التحديث: استخدام دالة تحقق النطاق المحسنة
                if (!checkDomain()) {
                    showDomainError();
                    return;
                }
                
                const encryptionReady = await prepareEncryption();
                
                if (!encryptionReady) {
                    showKeyManagement();
                }
                
                setupEventListeners();
                setupProgressBar();
                setupLongPress();
                setupDoubleTap();
                setupPreviewSystem();
                setupTapToPlayPause();
                setupNetworkMonitoring();
                setupProtectionSystem();
                setupDownloadSystem();
                setupBookmarkSystem();
                
                loadSavedSettings();
                
                setTimeout(() => {
                    orientationNotice.style.opacity = '0';
                    setTimeout(() => {
                        orientationNotice.style.display = 'none';
                    }, 500);
                }, 1000);
                
                resetControlsTimer();
                
                if (notificationsEnabled) {
                    showNotification('تم تهيئة المشغل بنجاح', 'success');
                }
                
                startSession();
                
                if (protectionEnabled && encryptionReady) {
                    showAccessControl(0);
                } else if (encryptionReady) {
                    loadVideo(0);
                }
                
            } catch (error) {
                showError(`فشل تهيئة المشغل: ${error.message}`);
            }
        }


        function loadSavedSettings() {
            const savedSkipButtonsState = localStorage.getItem('skipButtonsVisible');
            if (savedSkipButtonsState !== null) {
                skipButtonsVisible = JSON.parse(savedSkipButtonsState);
                updateSkipButtonsVisibility();
            }
            
            const savedLoopState = localStorage.getItem('videoLoop');
            if (savedLoopState !== null) {
                isLoopActive = JSON.parse(savedLoopState);
                videoPlayer.loop = isLoopActive;
                loopToggle.checked = isLoopActive;
                loopBtn.style.color = isLoopActive ? 'var(--accent-color)' : 'white';
            }
            
            const savedAutoplayState = localStorage.getItem('videoAutoplay');
            if (savedAutoplayState !== null) {
                isAutoplayActive = JSON.parse(savedAutoplayState);
                autoplayToggle.checked = isAutoplayActive;
            }
            
            const savedAutoHideState = localStorage.getItem('videoAutoHide');
            if (savedAutoHideState !== null) {
                isAutoHideActive = JSON.parse(savedAutoHideState);
                autoHideToggle.checked = isAutoHideActive;
            }
            
            const savedOfflineModeState = localStorage.getItem('offlineMode');
            if (savedOfflineModeState !== null) {
                isOfflineModeActive = JSON.parse(savedOfflineModeState);
                offlineModeToggle.checked = isOfflineModeActive;
            }
            
            const savedNotificationsState = localStorage.getItem('notificationsEnabled');
            if (savedNotificationsState !== null) {
                notificationsEnabled = JSON.parse(savedNotificationsState);
                notificationsToggle.classList.toggle('active', notificationsEnabled);
            }
            
            if (!skipButtonsVisible) {
                skipBackward10.classList.remove('show');
                skipForward10.classList.remove('show');
                toggleSkipBtns.style.color = 'white';
            }
        }


        // جعل دالة loadVideoFromUrl متاحة globally
        window.loadVideoFromUrl = loadVideoFromUrl;


        // === ✅ تهيئة نظام التحميل ===
        function setupDownloadSystem() {
            downloadButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const videoIndex = parseInt(this.getAttribute('data-video'));
                    const videoData = encryptedVideos[videoIndex];
                    
                    if (!verifiedVideos.has(videoIndex)) {
                        showNotification('يجب التحقق من كلمة المرور أولاً', 'error');
                        return;
                    }
                    
                    downloadManager.downloadVideo(videoIndex, videoData);
                });
            });
        }


        // جعل دوال الإشارات المرجعية متاحة globally
        window.jumpToBookmark = jumpToBookmark;
        window.deleteBookmark = deleteBookmark;
        window.downloadManager = downloadManager;
        window.loadVideo = loadVideo;
        window.togglePlayPause = togglePlayPause;
        window.toggleMute = toggleMute;
        window.toggleFullscreen = toggleFullscreen;
// ===== نظام العداد المتحرك للإحصائيات =====
class AnimatedCounter {
    constructor() {
        this.counters = new Map();
        this.initializeCounters();
    }
    
    initializeCounters() {
        // تهيئة القيم الأولية
        this.counters.set('totalVideosWatched', 0);
        this.counters.set('totalWatchTime', 0);
        this.counters.set('totalAchievements', 0);
        this.counters.set('userLevel', 1);
        
        this.startIncrementalUpdates();
    }
    
    // عداد متحرك سلس
    animateValue(element, start, end, duration = 1500) {
        const startTime = performance.now();
        const increment = end > start ? 1 : -1;
        
        const updateValue = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // easing function for smooth animation
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const currentValue = Math.floor(start + (end - start) * easeOutQuart);
            
            element.textContent = this.formatValue(currentValue, element.id);
            
            if (progress < 1) {
                requestAnimationFrame(updateValue);
            } else {
                element.textContent = this.formatValue(end, element.id);
                element.classList.add('animated');
                setTimeout(() => element.classList.remove('animated'), 1000);
            }
        };
        
        requestAnimationFrame(updateValue);
    }
    
    formatValue(value, elementId) {
        switch(elementId) {
            case 'totalVideosWatched':
                return value.toString();
            case 'totalWatchTime':
                return value >= 60 ? `${Math.floor(value/60)}h` : `${value}m`;
            case 'totalAchievements':
                return value.toString();
            case 'userLevel':
                return value.toString();
            default:
                return value.toString();
        }
    }
    
    // تحديث عشوائي محاكٍ للاستخدام
    startIncrementalUpdates() {
        setInterval(() => {
            this.randomIncrement();
        }, 5000); // تحديث كل 5 ثواني
    }
    
    randomIncrement() {
        const elements = {
            'totalVideosWatched': document.getElementById('totalVideosWatched'),
            'totalWatchTime': document.getElementById('totalWatchTime'),
            'totalAchievements': document.getElementById('totalAchievements'),
            'userLevel': document.getElementById('userLevel')
        };
        
        // تحديث عشوائي لقيمة واحدة في كل مرة
        const keys = Object.keys(elements);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        const element = elements[randomKey];
        
        if (element) {
            const currentValue = this.parseValue(element.textContent, randomKey);
            const increment = Math.random() > 0.7 ? 1 : 0; // 30% فرصة للتحديث
            
            if (increment > 0) {
                const newValue = currentValue + increment;
                this.counters.set(randomKey, newValue);
                this.animateValue(element, currentValue, newValue, 1000);
                
                // تأثير وميض
                element.classList.add('flash');
                setTimeout(() => element.classList.remove('flash'), 500);
                
                // تأثير highlight للعنصر
                const statItem = element.closest('.stat-item');
                if (statItem) {
                    statItem.classList.add('highlight');
                    setTimeout(() => statItem.classList.remove('highlight'), 1000);
                }
            }
        }
    }
    
    parseValue(text, elementId) {
        if (elementId === 'totalWatchTime' && text.includes('h')) {
            return parseInt(text) * 60;
        }
        return parseInt(text) || 0;
    }
    
    // تحديث القيم من نظام الإحصائيات
    updateFromStatistics(stats) {
        const elements = {
            'totalVideosWatched': document.getElementById('totalVideosWatched'),
            'totalWatchTime': document.getElementById('totalWatchTime'),
            'totalAchievements': document.getElementById('totalAchievements'),
            'userLevel': document.getElementById('userLevel')
        };
        
        Object.keys(elements).forEach(key => {
            const element = elements[key];
            if (element && stats[key] !== undefined) {
                const currentValue = this.parseValue(element.textContent, key);
                const newValue = stats[key];
                
                if (newValue !== currentValue) {
                    this.animateValue(element, currentValue, newValue, 1200);
                    this.counters.set(key, newValue);
                }
            }
        });
    }
}


// تهيئة العداد المتحرك
const animatedCounter = new AnimatedCounter();


// جعلها متاحة globally للأنظمة الأخرى
window.animatedCounter = animatedCounter;
// نظام الإحصائيات المحسّن والمنظم
class EnhancedStatisticsManager {
    constructor() {
        this.stats = {
            totalVideosWatched: 0,
            totalWatchTime: 0,
            totalAchievements: 0,
            userLevel: 1
        };
        this.animationQueue = [];
        this.isAnimating = false;
        this.init();
    }


    init() {
        this.loadStats();
        this.setupAutoIncrement();
        this.updateDisplay();
        this.setupSmoothAnimations();
    }


    loadStats() {
        try {
            const saved = localStorage.getItem('enhancedVideoStats');
            if (saved) {
                const parsed = JSON.parse(saved);
                this.stats = { ...this.stats, ...parsed };
            }
        } catch (error) {
            console.error('خطأ في تحميل الإحصائيات:', error);
        }
    }


    saveStats() {
        try {
            localStorage.setItem('enhancedVideoStats', JSON.stringify(this.stats));
        } catch (error) {
            console.error('خطأ في حفظ الإحصائيات:', error);
        }
    }


    setupSmoothAnimations() {
        // نظام تحريك سلس للقيم
        this.animationFrame = null;
        this.currentValues = { ...this.stats };
    }


    updateStat(statName, newValue, animate = true) {
        const oldValue = this.stats[statName];
        
        if (oldValue === newValue) return;


        this.stats[statName] = newValue;
        this.saveStats();


        if (animate) {
            this.animateValue(statName, oldValue, newValue);
        } else {
            this.updateDisplayElement(statName, newValue);
        }
    }


    animateValue(statName, startValue, endValue) {
        this.animationQueue.push({ statName, startValue, endValue });
        
        if (!this.isAnimating) {
            this.processAnimationQueue();
        }
    }


    processAnimationQueue() {
        if (this.animationQueue.length === 0) {
            this.isAnimating = false;
            return;
        }


        this.isAnimating = true;
        const { statName, startValue, endValue } = this.animationQueue.shift();
        
        this.smoothAnimate(statName, startValue, endValue, () => {
            setTimeout(() => this.processAnimationQueue(), 100);
        });
    }


    smoothAnimate(statName, startValue, endValue, onComplete) {
        const element = document.getElementById(statName);
        if (!element) {
            onComplete?.();
            return;
        }


        const duration = 800;
        const startTime = performance.now();
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // easing function سلسة
            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(startValue + (endValue - startValue) * easeOutCubic);
            
            this.updateDisplayElement(statName, currentValue);
            
            if (progress < 1) {
                this.animationFrame = requestAnimationFrame(animate);
            } else {
                this.updateDisplayElement(statName, endValue);
                element.classList.add('animated');
                setTimeout(() => element.classList.remove('animated'), 600);
                
                // إضافة تأثير الوميض
                element.classList.add('flash');
                setTimeout(() => element.classList.remove('flash'), 300);
                
                // highlight للعنصر
                const statItem = element.closest('.stat-item');
                if (statItem) {
                    statItem.classList.add('highlight');
                    setTimeout(() => statItem.classList.remove('highlight'), 1000);
                }
                
                onComplete?.();
            }
        };
        
        this.animationFrame = requestAnimationFrame(animate);
    }


    updateDisplayElement(statName, value) {
        const element = document.getElementById(statName);
        if (!element) return;


        switch(statName) {
            case 'totalVideosWatched':
                element.textContent = value.toString();
                break;
            case 'totalWatchTime':
                element.textContent = this.formatWatchTime(value);
                break;
            case 'totalAchievements':
                element.textContent = value.toString();
                break;
            case 'userLevel':
                element.textContent = value.toString();
                break;
            default:
                element.textContent = value.toString();
        }
    }


    formatWatchTime(minutes) {
        if (minutes >= 60) {
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;
            return remainingMinutes > 0 ? `${hours}h ${remainingMinutes}m` : `${hours}h`;
        }
        return `${minutes}m`;
    }


    updateDisplay() {
        // تحديث جميع العناصر مرة واحدة
        Object.keys(this.stats).forEach(statName => {
            this.updateDisplayElement(statName, this.stats[statName]);
        });
    }


    setupAutoIncrement() {
        // محاكاة زيادة الإحصائيات تلقائياً (للتجربة)
        setInterval(() => {
            this.simulateActivity();
        }, 8000);
    }


    simulateActivity() {
        const randomStat = Math.floor(Math.random() * 4);
        const increment = Math.random() > 0.6 ? 1 : 0; // 40% فرصة للتحديث


        if (increment > 0) {
            switch(randomStat) {
                case 0:
                    this.updateStat('totalVideosWatched', this.stats.totalVideosWatched + 1);
                    break;
                case 1:
                    this.updateStat('totalWatchTime', this.stats.totalWatchTime + 5);
                    break;
                case 2:
                    this.updateStat('totalAchievements', this.stats.totalAchievements + 1);
                    break;
                case 3:
                    if (this.stats.userLevel < 10) {
                        this.updateStat('userLevel', this.stats.userLevel + 1);
                    }
                    break;
            }
        }
    }


    // دلالات إضافية للتحديث من الأنظمة الأخرى
    recordVideoWatch(durationMinutes = 10) {
        this.updateStat('totalVideosWatched', this.stats.totalVideosWatched + 1);
        this.updateStat('totalWatchTime', this.stats.totalWatchTime + durationMinutes);
        
        // زيادة المستوى بناءً على النشاط
        if (this.stats.totalVideosWatched % 5 === 0 && this.stats.userLevel < 10) {
            this.updateStat('userLevel', this.stats.userLevel + 1);
        }
    }


    recordAchievement() {
        this.updateStat('totalAchievements', this.stats.totalAchievements + 1);
    }


    // تنظيف الذاكرة
    cleanup() {
        if (this.animationFrame) {
            cancelAnimationFrame(this.animationFrame);
        }
        this.animationQueue = [];
        this.isAnimating = false;
    }
}


// نظام محاذاة النصوص والتنسيق
class TextAlignmentManager {
    constructor() {
        this.observer = null;
        this.init();
    }


    init() {
        this.setupTextAlignment();
        this.setupFontLoading();
        this.setupResponsiveText();
    }


    setupTextAlignment() {
        // ضمان محاذاة متناسقة لجميع النصوص
        const style = document.createElement('style');
        style.textContent = `
            .stat-value, .stat-label {
                text-align: center !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                width: 100% !important;
            }
            
            /* ضمان ارتفاع ثابت للنصوص */
            .stat-info {
                min-height: 45px !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
            }
            
            /* منع كسر الكلمات */
            .stat-value, .stat-label {
                word-break: keep-all !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
        `;
        document.head.appendChild(style);


        // مراقبة التغييرات في النصوص
        this.observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'characterData' || mutation.type === 'childList') {
                    this.adjustTextAlignment(mutation.target);
                }
            });
        });


        // مراقبة عناصر الإحصائيات
        const statElements = document.querySelectorAll('.stat-value, .stat-label');
        statElements.forEach(element => {
            this.observer.observe(element, { 
                characterData: true, 
                childList: true, 
                subtree: true 
            });
            this.adjustTextAlignment(element);
        });
    }


    adjustTextAlignment(element) {
        // ضبط المحاذاة بناءً على طول النص
        const text = element.textContent || '';
        const container = element.parentElement;
        
        if (container) {
            const containerWidth = container.offsetWidth;
            const textWidth = this.measureTextWidth(text, element);
            
            if (textWidth > containerWidth * 0.9) {
                element.style.fontSize = '0.9em';
            } else {
                element.style.fontSize = '';
            }
        }
    }


    measureTextWidth(text, element) {
        // قياس عرض النص بدقة
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const computedStyle = getComputedStyle(element);
        
        context.font = `${computedStyle.fontWeight} ${computedStyle.fontSize} ${computedStyle.fontFamily}`;
        return context.measureText(text).width;
    }


    setupFontLoading() {
        // ضمان تحميل الخطوط قبل العرض
        const font = new FontFace('Cairo', 'url(https://fonts.googleapis.com/css2?family=Cairo)');
        
        font.load().then(() => {
            document.fonts.add(font);
            this.updateAllTextAlignments();
        }).catch(() => {
            console.warn('فشل تحميل خط Cairo، استخدام الخط الاحتياطي');
            this.fallbackToSystemFonts();
        });
    }


    fallbackToSystemFonts() {
        const style = document.createElement('style');
        style.textContent = `
            .stat-value, .stat-label {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            }
        `;
        document.head.appendChild(style);
    }


    setupResponsiveText() {
        // ضبط حجم النص تلقائياً حسب الشاشة
        const updateFontSizes = () => {
            const width = window.innerWidth;
            const baseSize = width < 480 ? 0.85 : width < 768 ? 0.9 : 1;
            
            document.documentElement.style.setProperty('--stat-font-scale', baseSize);
        };


        window.addEventListener('resize', updateFontSizes);
        updateFontSizes();
    }


    updateAllTextAlignments() {
        const elements = document.querySelectorAll('.stat-value, .stat-label');
        elements.forEach(element => this.adjustTextAlignment(element));
    }


    destroy() {
        if (this.observer) {
            this.observer.disconnect();
        }
    }
}


// تهيئة الأنظمة عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', () => {
    // تهيئة نظام الإحصائيات المحسّن
    window.enhancedStats = new EnhancedStatisticsManager();
    
    // تهيئة نظام محاذاة النصوص
    window.textAlignment = new TextAlignmentManager();
    
    // تحديث الإحصائيات من النظام الرئيسي إذا كان موجوداً
    setTimeout(() => {
        if (window.statisticsManager) {
            const mainStats = window.statisticsManager.getStats();
            if (mainStats) {
                window.enhancedStats.updateStat('totalVideosWatched', mainStats.totalVideosWatched || 0, false);
                window.enhancedStats.updateStat('totalWatchTime', Math.floor((mainStats.totalWatchTime || 0) / 60), false);
                window.enhancedStats.updateStat('totalAchievements', mainStats.achievementsUnlocked || 0, false);
                window.enhancedStats.updateStat('userLevel', mainStats.userLevel || 1, false);
            }
        }
    }, 1000);
});


// جعل الدوال متاحة globally
window.updateStatistics = function(stats) {
    if (window.enhancedStats) {
        Object.keys(stats).forEach(statName => {
            window.enhancedStats.updateStat(statName, stats[statName]);
        });
    }
};


window.resetStatistics = function() {
    if (window.enhancedStats) {
        window.enhancedStats.updateStat('totalVideosWatched', 0, true);
        window.enhancedStats.updateStat('totalWatchTime', 0, true);
        window.enhancedStats.updateStat('totalAchievements', 0, true);
        window.enhancedStats.updateStat('userLevel', 1, true);
    }
};
// تحسين وظيفة الشاشة الكاملة
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        enterFullscreen();
    } else {
        exitFullscreen();
    }
}


function enterFullscreen() {
    const elem = document.documentElement;
    
    if (elem.requestFullscreen) {
        elem.requestFullscreen();
    } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
    }
    
    // إضافة CSS class مباشرة
    document.body.classList.add('fullscreen');
    
    // إخفاء شريط التنقل على الهواتف
    if ('standalone' in navigator || /iPhone|iPad|iPod/.test(navigator.userAgent)) {
        document.documentElement.style.overflow = 'hidden';
    }
}


function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
    }
    
    // إزالة CSS class
    document.body.classList.remove('fullscreen');
    
    // إعادة شريط التنقل
    if ('standalone' in navigator || /iPhone|iPad|iPod/.test(navigator.userAgent)) {
        document.documentElement.style.overflow = '';
    }
}


// تحسين اكتشاف تغيير الشاشة الكاملة
function handleFullscreenChange() {
    const isFullscreen = !!(document.fullscreenElement || 
                           document.webkitFullscreenElement || 
                           document.mozFullScreenElement || 
                           document.msFullscreenElement);
    
    if (isFullscreen) {
        document.body.classList.add('fullscreen');
        
        // تدوير الشاشة تلقائياً على الهاتف
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').catch(err => {
                console.log('لم يتم تدوير الشاشة: ', err);
            });
        }
        
        showNotification('تم الدخول إلى وضع الشاشة الكاملة', 'success');
    } else {
        document.body.classList.remove('fullscreen');
        
        // إلغاء قفل الشاشة
        if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
        }
    }
}


// إضافة مستمعي الأحداث
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('mozfullscreenchange', handleFullscreenChange);
document.addEventListener('MSFullscreenChange', handleFullscreenChange);


// منع السلوك الافتراضي للفيديو على الهاتف
videoPlayer.addEventListener('touchstart', function(e) {
    e.preventDefault();
}, { passive: false });


videoPlayer.addEventListener('gesturestart', function(e) {
    e.preventDefault();
});


videoPlayer.addEventListener('gesturechange', function(e) {
    e.preventDefault();
});
// ==================== 🔄 نظام تغيير محتوى المحاضرة - الإصدار المصحح ====================


class FixedContentManager {
    constructor() {
        this.lectureContents = {
// في قسم VideoContentManager، تحديث lectureContents للمحاضرة الأولى:
0: {
    videoContent: `
        <!-- ========== هيكل المحاضرة الأساسي ========== -->
        <div class="content-section">
            <h4 style="color: var(--primary-color); margin: 20px 0 15px 0; border-right: 4px solid var(--primary-color); padding-right: 15px;">
                <i class="fas fa-play-circle"></i> هيكل المحاضرة الأساسي
            </h4>
            
            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-play"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">🎬 المقدمة</div>
                    <div class="content-desc">تعريف بالمونتاج وأهميته في صناعة الفيديو - 85 ثانية</div>
                </div>
                <div class="content-time" data-time="0:00">0:00</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-success);">
                    <i class="fas fa-download"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">📥 تحميل وتثبيت التطبيق</div>
                    <div class="content-desc">كيفية تحميل التطبيق وخطوات التثبيت - 51 ثانية</div>
                </div>
                <div class="content-time" data-time="1:25">1:25</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-warning);">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">📚 الشرح النظري</div>
                    <div class="content-desc">شرح شامل للأيقونات الخارجية والداخلية - 864 ثانية</div>
                </div>
                <div class="content-time" data-time="2:16">2:16</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">🛠️ الجزء العملي</div>
                    <div class="content-desc">تطبيق عملي على كل الأدوات - 551 ثانية</div>
                </div>
                <div class="content-time" data-time="16:40">16:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-success);">
                    <i class="fas fa-flag-checkered"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">🏁 الخاتمة</div>
                    <div class="content-desc">ملخص المحاضرة والتجهيز للجزء التالي - 45 ثانية</div>
                </div>
                <div class="content-time" data-time="25:51">25:51</div>
            </div>
        </div>


        <!-- ========== الأيقونات الخارجية ========== -->
        <div class="content-section">
            <h4 style="color: var(--accent-color); margin: 25px 0 15px 0; border-right: 4px solid var(--accent-color); padding-right: 15px;">
                <i class="fas fa-external-link-alt"></i> الأيقونات الخارجية
            </h4>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <i class="fas fa-edit"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة التعديل</div>
                    <div class="content-desc">تعديل الفيديو وعرض كل الخيارات المتاحة</div>
                </div>
                <div class="content-time" data-time="2:16">2:16</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <i class="fas fa-volume-up"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الصوت</div>
                    <div class="content-desc">التعديل على صوت الفيديو وعرض خيارات الصوت</div>
                </div>
                <div class="content-time" data-time="4:30">4:30</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <i class="fas fa-font"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة النص</div>
                    <div class="content-desc">إضافة نص للشاشة وعرض خيارات التعديل على النص</div>
                </div>
                <div class="content-time" data-time="6:45">6:45</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                    <i class="fas fa-layer-group"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة التراكب</div>
                    <div class="content-desc">إضافة فيديو فوق الفيديو الأساسي</div>
                </div>
                <div class="content-time" data-time="9:15">9:15</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                    <i class="fas fa-magic"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة المؤثرات</div>
                    <div class="content-desc">إضافة تأثيرات للفيديو لعمل مظهر جذاب</div>
                </div>
                <div class="content-time" data-time="12:20">12:20</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الشروحات</div>
                    <div class="content-desc">إضافة ترجمة تلقائية باستخدام الذكاء الاصطناعي</div>
                </div>
                <div class="content-time" data-time="15:40">15:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                    <i class="fas fa-arrows-alt-h"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">نسبة العرض إلى الارتفاع</div>
                    <div class="content-desc">تغيير أبعاد الفيديو لأبعاد مناسبة للتيك توك واليوتيوب</div>
                </div>
                <div class="content-time" data-time="19:30">19:30</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);">
                    <i class="fas fa-filter"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الفلاتر</div>
                    <div class="content-desc">إضافة فلتر للصورة لإعطاء أجواء معينة</div>
                </div>
                <div class="content-time" data-time="22:15">22:15</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الضبط</div>
                    <div class="content-desc">التعديل في ألوان الفيديو ووسطوعه</div>
                </div>
                <div class="content-time" data-time="25:10">25:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #d4fc79, #96e6a1);">
                    <i class="fas fa-sticky-note"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الملصقات</div>
                    <div class="content-desc">إضافة ملصقات واستيكرات للفيديو</div>
                </div>
                <div class="content-time" data-time="28:05">28:05</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f6d365, #fda085);">
                    <i class="fas fa-image"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الخلفية</div>
                    <div class="content-desc">تغيير خلفية الفيديو الأساسية</div>
                </div>
                <div class="content-time" data-time="31:20">31:20</div>
            </div>
        </div>


        <!-- ========== الأيقونات الداخلية ========== -->
        <div class="content-section">
            <h4 style="color: var(--primary-color); margin: 25px 0 15px 0; border-right: 4px solid var(--primary-color); padding-right: 15px;">
                <i class="fas fa-cogs"></i> الأيقونات الداخلية
            </h4>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);">
                    <i class="fas fa-cut"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة التقسيم</div>
                    <div class="content-desc">قطع جزء من المقطع وتقسيمه إلى نصفين</div>
                </div>
                <div class="content-time" data-time="34:45">34:45</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة السرعة</div>
                    <div class="content-desc">زيادة سرعة الفيديو أو تسريعه حتى 100 ضعف</div>
                </div>
                <div class="content-time" data-time="37:30">37:30</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #d4fc79, #96e6a1);">
                    <i class="fas fa-film"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">الرسوم المتحركة</div>
                    <div class="content-desc">إضافة مشهد دخول أو خروج أو مشهد متحرك</div>
                </div>
                <div class="content-time" data-time="40:15">40:15</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f6d365, #fda085);">
                    <i class="fas fa-palette"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة النمط</div>
                    <div class="content-desc">تأثيرات احترافية باستخدام الذكاء الاصطناعي</div>
                </div>
                <div class="content-time" data-time="43:50">43:50</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <i class="fas fa-trash"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أيقونة الحذف</div>
                    <div class="content-desc">حذف الفيديو أو الصور أو النصوص أو المؤثرات</div>
                </div>
                <div class="content-time" data-time="47:20">47:20</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <i class="fas fa-volume-up"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">تحسين الصوت</div>
                    <div class="content-desc">تحسين جودة الصوت وجعله أكثر نقاءً</div>
                </div>
                <div class="content-time" data-time="49:35">49:35</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <i class="fas fa-music"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">عزل الصوت</div>
                    <div class="content-desc">فصل الصوت عن الموسيقى مع إمكانية الاحتفاظ بأحدهما</div>
                </div>
                <div class="content-time" data-time="52:10">52:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                    <i class="fas fa-sliders-h"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">مستوى الصوت</div>
                    <div class="content-desc">التحكم في الصوت من رفع أو خفض</div>
                </div>
                <div class="content-time" data-time="55:05">55:05</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                    <i class="fas fa-headphones"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">المؤثرات الصوتية</div>
                    <div class="content-desc">إضافة مؤثرات صوتية تضيف روح للفيديو</div>
                </div>
                <div class="content-time" data-time="57:40">57:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-user-edit"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التنميق</div>
                    <div class="content-desc">التعديل في تفاصيل الوجه مثل العين والأنف</div>
                </div>
                <div class="content-time" data-time="60:25">60:25</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                    <i class="fas fa-video"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">تتبع الكاميرا</div>
                    <div class="content-desc">تتبع جزء معين في الفيديو مثل رأس شخص</div>
                </div>
                <div class="content-time" data-time="63:10">63:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);">
                    <i class="fas fa-crop"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التحويل</div>
                    <div class="content-desc">قص الصورة وتحديد أبعادها</div>
                </div>
                <div class="content-time" data-time="66:20">66:20</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-expand-arrows-alt"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التوسيع المدعوم بالذكاء الاصطناعي</div>
                    <div class="content-desc">توسيع الفيديو باستخدام الذكاء الاصطناعي</div>
                </div>
                <div class="content-time" data-time="69:05">69:05</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #d4fc79, #96e6a1);">
                    <i class="fas fa-sync"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">الضبط على الفيديو أو الكل</div>
                    <div class="content-desc">التحكم في إعدادات الفيديو المحدد أو كل الفيديوهات</div>
                </div>
                <div class="content-time" data-time="72:15">72:15</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f6d365, #fda085);">
                    <i class="fas fa-star"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">جودة الفيديو</div>
                    <div class="content-desc">تحسين جودة الفيديو</div>
                </div>
                <div class="content-time" data-time="75:30">75:30</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <i class="fas fa-eraser"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">إزالة الخلفية</div>
                    <div class="content-desc">إزالة خلفية الصورة أو الفيديو</div>
                </div>
                <div class="content-time" data-time="78:45">78:45</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التراكب (تحويل رئيسي/فرعي)</div>
                    <div class="content-desc">تحويل الفيديو من رئيسي إلى فرعي والعكس</div>
                </div>
                <div class="content-time" data-time="81:20">81:20</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <i class="fas fa-arrows"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">أساسي (الموقع والتدوير)</div>
                    <div class="content-desc">التحكم في مكان الفيديو أو تدويره</div>
                </div>
                <div class="content-time" data-time="84:10">84:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                    <i class="fas fa-shapes"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">القناع</div>
                    <div class="content-desc">قص الفيديو بأشكال هندسية معينة</div>
                </div>
                <div class="content-time" data-time="87:25">87:25</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                    <i class="fas fa-copy"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التكرار</div>
                    <div class="content-desc">تكرار الفيديو الذي تم تحديده</div>
                </div>
                <div class="content-time" data-time="90:40">90:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-exchange"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">الاستبدال</div>
                    <div class="content-desc">استبدال الفيديو بفيديو آخر</div>
                </div>
                <div class="content-time" data-time="93:55">93:55</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                    <i class="fas fa-file-audio"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">استخراج الصوت</div>
                    <div class="content-desc">فصل الصوت عن الفيديو</div>
                </div>
                <div class="content-time" data-time="97:10">97:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);">
                    <i class="fas fa-wind"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">ضباب الحركة</div>
                    <div class="content-desc">عمل حركة ضبابية احترافية للفيديو</div>
                </div>
                <div class="content-time" data-time="100:25">100:25</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">تثبيت الصورة</div>
                    <div class="content-desc">تقليل الاهتزاز والارتجاج في الفيديو</div>
                </div>
                <div class="content-time" data-time="103:40">103:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #d4fc79, #96e6a1);">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">التعتيم</div>
                    <div class="content-desc">تقليل شفافية الصورة لإظهار الصورة الخلفية</div>
                </div>
                <div class="content-time" data-time="106:55">106:55</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f6d365, #fda085);">
                    <i class="fas fa-retweet"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">العكس</div>
                    <div class="content-desc">عكس حركة الفيديو للخدع السينمائية</div>
                </div>
                <div class="content-time" data-time="110:10">110:10</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <i class="fas fa-pause"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">توقف الحركة</div>
                    <div class="content-desc">توقيف حركة الفيديو أو أخذ لقطة</div>
                </div>
                <div class="content-time" data-time="113:25">113:25</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <i class="fas fa-volume-mute"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">تقليل الضوضاء</div>
                    <div class="content-desc">تحسين الصوت بتقليل الضوضاء</div>
                </div>
                <div class="content-time" data-time="116:40">116:40</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <i class="fas fa-drum"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">الإيقاعات</div>
                    <div class="content-desc">وضع علامات على الصوت للمساعدة في التعديل</div>
                </div>
                <div class="content-time" data-time="119:55">119:55</div>
            </div>


            <div class="content-item">
                <div class="content-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                    <i class="fas fa-unlink"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">إلغاء الربط</div>
                    <div class="content-desc">إلغاء أو ربط النصوص مع الفيديو</div>
                </div>
                <div class="content-time" data-time="123:10">123:10</div>
            </div>


            <!-- ========== الخاتمة ========== -->
            <div class="content-item">
                <div class="content-icon" style="background: var(--gradient-success);">
                    <i class="fas fa-flag-checkered"></i>
                </div>
                <div class="content-details">
                    <div class="content-title">الختام والتطبيق العملي</div>
                    <div class="content-desc">ملخص شامل وتطبيق عملي على ما تم تعلمه</div>
                </div>
                <div class="content-time" data-time="126:25">126:25</div>
            </div>
        </div>


    `,
materials: `
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-video"></i>
            </div>
            <div class="material-details">
                <h5>الفيديوهات الأساسية</h5>
                <span>الفيديوهات الأساسية للمحاضرة الأولى • 3 فيديوهات</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://t.me/youssef5200/22" target="_blank" class="task-btn basic">
                <i class="fas fa-play"></i>
                فيديو أساسي ١
            </a>
            <a href="https://t.me/youssef5200/24" target="_blank" class="task-btn basic">
                <i class="fas fa-play"></i>
                فيديو أساسي ٢
            </a>
            <a href="https://t.me/youssef5200/23" target="_blank" class="task-btn basic">
                <i class="fas fa-play"></i>
                فيديو أساسي ٣
            </a>
        </div>
    </div>
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-film"></i>
            </div>
            <div class="material-details">
                <h5>الفيديوهات الفرعية</h5>
                <span>فيديوهات إضافية للممارسة • 1 فيديو</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://t.me/youssef5200/25" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي
            </a>
        </div>
    </div>


                `
            },


            1: {
                // المحاضرة الثانية - المحتوى المحدث والمختلف
                videoContent: `
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🎬 مقدمة المشروع العملي</div>
                            <div class="content-desc">تعريف بالمشروع وخطوات التنفيذ العملية - 120 ثانية</div>
                        </div>
                        <div class="content-time" data-time="0:00">0:00</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">⚙️ إعداد المشروع والإعدادات</div>
                            <div class="content-desc">تهيئة المشروع والإعدادات الأساسية - 180 ثانية</div>
                        </div>
                        <div class="content-time" data-time="2:00">2:00</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-cut"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">✂️ تقنيات القص والتركيب المتقدمة</div>
                            <div class="content-desc">أدوات القص والتقطيع الاحترافية - 240 ثانية</div>
                        </div>
                        <div class="content-time" data-time="5:00">5:00</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🎨 تصحيح الألوان والدرجات اللونية</div>
                            <div class="content-desc">تقنيات متقدمة في تصحيح الألوان - 210 ثانية</div>
                        </div>
                        <div class="content-time" data-time="9:00">9:00</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🎵 معالجة الصوت والمؤثرات الصوتية</div>
                            <div class="content-desc">تحسين الصوت وإضافة المؤثرات - 195 ثانية</div>
                        </div>
                        <div class="content-time" data-time="12:30">12:30</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">✨ المؤثرات البصرية والانتقالات</div>
                            <div class="content-desc">إضافة المؤثرات والانتقالات الاحترافية - 225 ثانية</div>
                        </div>
                        <div class="content-time" data-time="15:45">15:45</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-font"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">📝 إضافة النصوص والعناوين</div>
                            <div class="content-desc">تصميم وإضافة النصوص والعناوين الجذابة - 180 ثانية</div>
                        </div>
                        <div class="content-time" data-time="19:30">19:30</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-film"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🎞️ التصدير والإخراج النهائي</div>
                            <div class="content-desc">إعدادات التصدير والإخراج الاحترافي - 150 ثانية</div>
                        </div>
                        <div class="content-time" data-time="22:30">22:30</div>
                    </div>
                `,
materials: `
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-video"></i>
            </div>
            <div class="material-details">
                <h5>فيديوهات المحاضرة الثانية</h5>
                <span>الفيديوهات الأساسية والفرعية للمحاضرة الثانية</span>
            </div>
        </div>
        <div class="tasks-container">
            <!-- فيديوهات أساسية -->
            <a href="https://t.me/youssef5200/27?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play"></i>
                فيديو أساسي ١
            </a>
            <a href="https://t.me/youssef5200/26?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play"></i>
                فيديو أساسي ٢
            </a>
            
            <!-- فيديوهات فرعية -->
            <a href="https://t.me/youssef5200/16?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي ١
            </a>
            <a href="https://t.me/youssef5200/17?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي ٢
            </a>
            <a href="https://t.me/youssef5200/18?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي ٣
            </a>
            <a href="https://t.me/youssef5200/19?single" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي ٤
            </a>
            <a href="https://t.me/youssef5200/20" target="_blank" class="task-btn basic">
                <i class="fas fa-play-circle"></i>
                فيديو فرعي ٥
            </a>
        </div>
    </div>
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-font"></i>
            </div>
            <div class="material-details">
                <h5>الخطوط المستخدمة</h5>
                <span>مجموعة الخطوط العربية للمحاضرة الثانية</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://t.me/youssef5200/12" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                خط دمشق
            </a>
            <a href="https://t.me/youssef5200/13" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                خط خرابيش
            </a>
            <a href="https://t.me/youssef5200/14" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                خط ملهم
            </a>
        </div>
    </div>
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-paperclip"></i>
            </div>
            <div class="material-details">
                <h5>ملحقات المحاضرة</h5>
                <span>الملفات الإضافية للمحاضرة الثانية</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://t.me/youssef5200/9" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                الجزء الأول
            </a>
            <a href="https://t.me/youssef5200/10" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                الجزء الثاني
            </a>
        </div>
    </div>


                `
            },
            2: {
                // المحاضرة الثالثة
                videoContent: `
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🤖 الذكاء الاصطناعي في المونتاج</div>
                            <div class="content-desc">أحدث تقنيات الذكاء الاصطناعي وتطبيقاتها</div>
                        </div>
                        <div class="content-time" data-time="0:00">0:00</div>
                    </div>
                    <div class="content-item">
                        <div class="content-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="content-details">
                            <div class="content-title">🧠 أدوات الذكاء الاصطناعي</div>
                            <div class="content-desc">استعراض أهم أدوات AI المتاحة للمونتاج</div>
                        </div>
                        <div class="content-time" data-time="12:30">12:30</div>
                    </div>
                `,
materials: `
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-robot"></i>
            </div>
            <div class="material-details">
                <h5>تطبيقات الذكاء الاصطناعي</h5>
                <span>أهم التطبيقات والمواقع للمونتاج بالذكاء الاصطناعي</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://play.google.com/store/apps/details?id=com.pixverseai.pixverse" target="_blank" class="task-btn basic">
                <i class="fas fa-magic"></i>
                تطبيق Pixverse
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.openai.chatgpt" target="_blank" class="task-btn basic">
                <i class="fas fa-robot"></i>
                تطبيق ChatGPT
            </a>
            <a href="https://elevenlabs.io/" target="_blank" class="task-btn basic">
                <i class="fas fa-volume-up"></i>
                موقع ElevenLabs
            </a>
            <a href="https://play.google.com/store/apps/details?id=ai.qwenlm.chat.android" target="_blank" class="task-btn basic">
                <i class="fas fa-film"></i>
                تطبيق Qwen
            </a>
            <a href="https://viamaker.ar.uptodown.com/android/download/1010723582" target="_blank" class="task-btn basic">
                <i class="fas fa-cut"></i>
                تطبيق CapCut
            </a>
        </div>
    </div>
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-tools"></i>
            </div>
            <div class="material-details">
                <h5>أدوات متقدمة</h5>
                <span>أدوات إضافية للمونتاج المحترف</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://play.google.com/store/apps/details?id=ai.moises" target="_blank" class="task-btn basic">
                <i class="fas fa-music"></i>
                تطبيق Moises
            </a>
            <a href="https://www.veed.io/" target="_blank" class="task-btn basic">
                <i class="fas fa-closed-captioning"></i>
                موقع Veed.io
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.magic.retouch" target="_blank" class="task-btn basic">
                <i class="fas fa-brush"></i>
                تطبيق Retouch
            </a>
            <a href="https://runwayml.com/" target="_blank" class="task-btn basic">
                <i class="fas fa-video"></i>
                موقع Runway ML
            </a>
        </div>
    </div>
    <div class="material-item">
        <div class="material-info">
            <div class="material-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="material-details">
                <h5>تحسين الجودة</h5>
                <span>تطبيقات لتحسين جودة الصور والفيديوهات</span>
            </div>
        </div>
        <div class="tasks-container">
            <a href="https://play.google.com/store/apps/details?id=com.bigwinepot.nwdn.international" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                تطبيق Remini
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.camerasideas.trimmer" target="_blank" class="task-btn basic">
                <i class="fas fa-download"></i>
                تطبيق YouCut
            </a>
            <a href="#" class="task-btn basic">
                <i class="fas fa-cog"></i>
                موقع Flew In (قيد الإعداد)
            </a>
        </div>
    </div>


                `
            }
        };
        
        this.init();
    }


    init() {
        console.log('🚀 بدء نظام إدارة المحتوى المصحح...');
        
        // 1. اعتراض جميع طرق تغيير المحاضرة
        this.interceptAllVideoChanges();
        
        // 2. تحديث المحتوى عند التحميل
        this.updateOnLoad();
        
        console.log('✅ النظام المصحح جاهز!');
    }


    interceptAllVideoChanges() {
        // 1. اعتراض دالة changeVideo الأصلية
        this.interceptChangeVideo();
        
        // 2. اعتراض نظام الحماية
        this.interceptProtectionSystem();
        
        // 3. اعتراض نافذة اختيار المحاضرات
        this.interceptLecturesModal();
        
        // 4. اعتراض النقر المباشر على عناصر قائمة التشغيل
        this.interceptPlaylistClicks();
    }


    interceptChangeVideo() {
        const originalChangeVideo = window.changeVideo;
        window.changeVideo = (index) => {
            console.log(`🔄 تغيير المحاضرة (من القائمة): ${index}`);
            
            if (originalChangeVideo) {
                originalChangeVideo(index);
            }
            
            this.updateContent(index);
        };
    }


    interceptProtectionSystem() {
        // اعتراض نظام التحقق من كلمة المرور
        const originalVerifyAccessCode = window.verifyAccessCode;
        if (originalVerifyAccessCode) {
            window.verifyAccessCode = () => {
                console.log(`🔐 تحقق من كلمة المرور للمحاضرة: ${window.currentVideoIndex}`);
                originalVerifyAccessCode();
                
                // بعد التحقق الناجح، تحديث المحتوى
                setTimeout(() => {
                    if (window.verifiedVideos && window.verifiedVideos.has(window.currentVideoIndex)) {
                        this.updateContent(window.currentVideoIndex);
                    }
                }, 500);
            };
        }


        // اعتراض عرض نافذة التحكم
        const originalShowAccessControl = window.showAccessControl;
        if (originalShowAccessControl) {
            window.showAccessControl = (index) => {
                console.log(`🔒 عرض نافذة التحكم للمحاضرة: ${index}`);
                originalShowAccessControl(index);
                
                // تحديث المحتوى فوراً عند فتح النافذة
                this.updateContent(index);
            };
        }
    }


    interceptLecturesModal() {
        // اعتراض نافذة اختيار المحاضرات
        const originalShowLecturesModal = window.showLecturesModal;
        if (originalShowLecturesModal) {
            window.showLecturesModal = () => {
                console.log('📋 فتح نافذة اختيار المحاضرات');
                originalShowLecturesModal();
            };
        }


        // اعتراض اختيار محاضرة من النافذة
        const originalSelectLecture = window.selectLecture;
        if (originalSelectLecture) {
            window.selectLecture = (index) => {
                console.log(`🎯 اختيار محاضرة من النافذة: ${index}`);
                originalSelectLecture(index);
                
                // تحديث المحتوى فوراً
                this.updateContent(index);
            };
        }


        // أيضاً اعتراض الزر مباشرة إذا كان موجوداً
        const chooseOtherBtn = document.getElementById('chooseOtherLectureBtn');
        if (chooseOtherBtn) {
            chooseOtherBtn.addEventListener('click', () => {
                console.log('🔄 النقر على زر اختيار محاضرة أخرى');
                // سيتم التعامل معه في selectLecture
            });
        }
    }


    interceptPlaylistClicks() {
        // اعتراض النقر المباشر على عناصر قائمة التشغيل
        const playlistItems = document.querySelectorAll('.playlist-item');
        playlistItems.forEach((item, index) => {
            const originalClick = item.onclick;
            item.onclick = (e) => {
                console.log(`🎯 النقر المباشر على المحاضرة: ${index}`);
                if (originalClick) originalClick(e);
                this.updateContent(index);
            };
        });
    }


    updateOnLoad() {
        // تحديث فوري عند التحميل
        setTimeout(() => {
            const currentIndex = window.currentVideoIndex || 0;
            console.log(`📄 تحميل الصفحة - المحاضرة: ${currentIndex}`);
            this.updateContent(currentIndex);
        }, 100);
    }


    updateContent(lectureIndex) {
        console.log(`🎯 تحديث محتوى المحاضرة: ${lectureIndex}`);
        
        const content = this.lectureContents[lectureIndex];
        if (!content) {
            console.log('❌ لا يوجد محتوى لهذه المحاضرة');
            return;
        }


        // تحديث محتوى الفيديو
        this.updateVideoContent(content.videoContent);
        
        // تحديث المواد التعليمية
        this.updateMaterials(content.materials);
        
        // إضافة مستمعي الأحداث
        this.addTimeButtonListeners();
        
        console.log(`✅ تم تحديث محتوى المحاضرة ${lectureIndex}`);
    }


    updateVideoContent(html) {
        const element = document.getElementById('videoContent');
        if (element) {
            element.innerHTML = html;
            console.log('✅ تم تحديث محتوى الفيديو');
        } else {
            console.log('❌ لم يتم العثور على videoContent');
        }
    }


    updateMaterials(html) {
        const element = document.getElementById('materialsList');
        if (element) {
            element.innerHTML = html;
            console.log('✅ تم تحديث المواد التعليمية');
        } else {
            console.log('❌ لم يتم العثور على materialsList');
        }
    }


    addTimeButtonListeners() {
        const buttons = document.querySelectorAll('.content-time');
        buttons.forEach(button => {
            // إزالة المستمعين القديمين أولاً
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            
            // إضافة مستمع جديد
            newButton.addEventListener('click', (e) => {
                const timeText = e.target.getAttribute('data-time');
                this.jumpToTime(timeText);
            });
        });
    }


    jumpToTime(timeText) {
        const video = document.getElementById('videoPlayer');
        if (video && timeText) {
            const parts = timeText.split(':');
            if (parts.length === 2) {
                const minutes = parseInt(parts[0]);
                const seconds = parseInt(parts[1]);
                video.currentTime = (minutes * 60) + seconds;
                video.play();
                console.log(`⏩ الانتقال إلى: ${timeText}`);
            }
        }
    }


    // دالة مساعدة للتحقق من التحديث
    debugContentUpdate() {
        console.log('🔍 فحص تحديث المحتوى:');
        console.log('- المحتوى المخزن:', this.lectureContents);
        console.log('- الفهرس الحالي:', window.currentVideoIndex);
    }
}


// ==================== التشغيل الفوري والمباشر ====================


// تشغيل النظام فور تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔧 تحميل نظام إدارة المحتوى المصحح...');
    window.fixedContentManager = new FixedContentManager();
    
    // إضافة اختصار للتصحيح
    window.debugContent = () => window.fixedContentManager.debugContentUpdate();
});


// تشغيل إضافي بعد اكتمال الصفحة
window.addEventListener('load', function() {
    console.log('🖼️ اكتمال تحميل الصفحة - تأكيد التحديث...');
    if (window.fixedContentManager) {
        setTimeout(() => {
            const currentIndex = window.currentVideoIndex || 0;
            console.log(`🔄 التأكيد النهائي للمحاضرة: ${currentIndex}`);
            window.fixedContentManager.updateContent(currentIndex);
        }, 500);
    }
});


// تشغيل يدوي إذا لزم الأمر
window.forceUpdateContent = function(lectureIndex) {
    if (window.fixedContentManager) {
        console.log(`🔧 التحديث اليدوي للمحاضرة: ${lectureIndex}`);
        window.fixedContentManager.updateContent(lectureIndex);
    }
};


// تحديث تلقائي عند تغيير المحاضرة من أي مصدر
window.addEventListener('videoChanged', function(e) {
    console.log('🎬 حدث تغيير الفيديو:', e.detail);
    if (window.fixedContentManager && e.detail.index !== undefined) {
        window.fixedContentManager.updateContent(e.detail.index);
    }
});


console.log('🎯 نظام إدارة المحتوى المصحح مثبت وجاهز!');
// نظام إدارة الاختبارات
class QuizManager {
    constructor() {
        this.currentQuiz = null;
        this.currentQuestionIndex = 0;
        this.userAnswers = [];
        this.quizData = {
            0: {
                title: "اختبار أساسيات المونتاج",
                questions: [
                    {
                        question: "ما هو أول شيء يجب فعله عند بدء مشروع مونتاج جديد؟",
                        options: [
                            "استيراد جميع المقاطع مباشرة",
                            "تنظيم المجلدات وهيكلة المشروع",
                            "بدء القص فوراً",
                            "إضافة المؤثرات"
                        ],
                        correctAnswer: 1,
                        explanation: "تنظيم المشروع من البداية يوفر وقتاً ويحسن سير العمل"
                    },
                    {
                        question: "أي من هذه الأدوات تستخدم للقص الأساسي في المونتاج؟",
                        options: [
                            "أداة القلم Pen Tool",
                            "أداة القص Razor Tool", 
                            "أداة الفرشاة Brush Tool",
                            "أداة الكتابة Text Tool"
                        ],
                        correctAnswer: 1,
                        explanation: "أداة القص (Razor Tool) هي الأداة الأساسية لتقطيع المقاطع"
                    },
                    {
                        question: "ما هو أفضل تنسيق لحفظ المشروع النهائي للويب؟",
                        options: [
                            "MP4 مع H.264",
                            "AVI",
                            "MOV",
                            "WMV"
                        ],
                        correctAnswer: 0,
                        explanation: "MP4 مع ترميز H.264 هو الأفضل للويب بسبب جودته وحجمه المناسب"
                    }
                ]
            },
            1: {
                title: "اختبار التقنيات المتقدمة",
                questions: [
                    {
                        question: "ما هي وظيفة Color Grading في المونتاج؟",
                        options: [
                            "قص المقاطع",
                            "تصحيح وتحسين الألوان",
                            "إضافة المؤثرات البصرية",
                            "تحرير الصوت"
                        ],
                        correctAnswer: 1,
                        explanation: "Color Grading يختص بتصحيح الألوان وإعطاء المظهر السينمائي"
                    }
                ]
            }
        };
        this.init();
    }


    init() {
        this.setupEventListeners();
        this.updateQuizDisplay();
    }


    setupEventListeners() {
        document.getElementById('nextQuestion')?.addEventListener('click', () => this.nextQuestion());
        document.getElementById('prevQuestion')?.addEventListener('click', () => this.prevQuestion());
        document.getElementById('submitQuiz')?.addEventListener('click', () => this.submitQuiz());


        // تحديث الاختبار عند تغيير الفيديو
        const originalChangeVideo = window.changeVideo;
        window.changeVideo = (index) => {
            if (originalChangeVideo) originalChangeVideo(index);
            this.currentQuestionIndex = 0;
            this.userAnswers = [];
            this.updateQuizDisplay();
        };
    }


    updateQuizDisplay() {
        this.currentQuiz = this.quizData[this.currentVideoIndex];
        
        if (!this.currentQuiz || this.currentQuiz.questions.length === 0) {
            this.showNoQuizMessage();
            return;
        }


        this.renderQuiz();
        this.updateProgress();
        this.updateNavigation();
    }


    showNoQuizMessage() {
        const quizContainer = document.getElementById('quizQuestions');
        if (!quizContainer) return;


        quizContainer.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--text-color); opacity: 0.7;">
                <i class="fas fa-graduation-cap" style="font-size: 2rem; margin-bottom: 15px;"></i>
                <h4 style="margin: 0 0 10px 0;">لا يوجد اختبار لهذه المحاضرة</h4>
                <p style="margin: 0;">سيتم إضافة الاختبار قريباً</p>
            </div>
        `;


        document.getElementById('quizScore').textContent = '0';
        document.getElementById('quizTotal').textContent = '0';
        document.getElementById('quizProgressText').textContent = 'لا يوجد اختبار';
    }


    renderQuiz() {
        const currentQuestion = this.currentQuiz.questions[this.currentQuestionIndex];
        const quizContainer = document.getElementById('quizQuestions');
        
        if (!quizContainer) return;


        quizContainer.innerHTML = `
            <div class="question-card">
                <div class="question-text">
                    ${currentQuestion.question}
                </div>
                <div class="options-list">
                    ${currentQuestion.options.map((option, index) => `
                        <div class="option-item ${this.userAnswers[this.currentQuestionIndex] === index ? 'selected' : ''}" 
                             data-option="${index}">
                            <div class="option-marker">${String.fromCharCode(65 + index)}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;


        // إضافة مستمعي الأحداث للخيارات
        quizContainer.querySelectorAll('.option-item').forEach(item => {
            item.addEventListener('click', () => this.selectAnswer(parseInt(item.getAttribute('data-option'))));
        });


        document.getElementById('quizTotal').textContent = this.currentQuiz.questions.length;
    }


    selectAnswer(optionIndex) {
        this.userAnswers[this.currentQuestionIndex] = optionIndex;
        this.renderQuiz();
        this.updateProgress();
    }


    nextQuestion() {
        if (this.currentQuestionIndex < this.currentQuiz.questions.length - 1) {
            this.currentQuestionIndex++;
            this.renderQuiz();
            this.updateProgress();
            this.updateNavigation();
        }
    }


    prevQuestion() {
        if (this.currentQuestionIndex > 0) {
            this.currentQuestionIndex--;
            this.renderQuiz();
            this.updateProgress();
            this.updateNavigation();
        }
    }


    updateProgress() {
        const progress = ((this.currentQuestionIndex + 1) / this.currentQuiz.questions.length) * 100;
        document.getElementById('quizProgress').style.width = `${progress}%`;
        document.getElementById('quizProgressText').textContent = 
            `السؤال ${this.currentQuestionIndex + 1} من ${this.currentQuiz.questions.length}`;


        // تحديث النقاط
        const currentScore = this.userAnswers.filter((answer, index) => 
            answer === this.currentQuiz.questions[index]?.correctAnswer
        ).length;
        document.getElementById('quizScore').textContent = currentScore;
    }


    updateNavigation() {
        document.getElementById('prevQuestion').disabled = this.currentQuestionIndex === 0;
        
        const nextButton = document.getElementById('nextQuestion');
        const submitButton = document.getElementById('submitQuiz');
        
        if (this.currentQuestionIndex === this.currentQuiz.questions.length - 1) {
            nextButton.style.display = 'none';
            submitButton.style.display = 'flex';
        } else {
            nextButton.style.display = 'flex';
            submitButton.style.display = 'none';
        }
    }


    submitQuiz() {
        const score = this.calculateScore();
        this.showResults(score);
    }


    calculateScore() {
        return this.userAnswers.filter((answer, index) => 
            answer === this.currentQuiz.questions[index]?.correctAnswer
        ).length;
    }


    showResults(score) {
        const totalQuestions = this.currentQuiz.questions.length;
        const percentage = Math.round((score / totalQuestions) * 100);
        
        const resultsContainer = document.getElementById('quizResults');
        const questionsContainer = document.getElementById('quizQuestions');
        const actionsContainer = document.querySelector('.quiz-actions');
        
        if (!resultsContainer || !questionsContainer || !actionsContainer) return;


        questionsContainer.style.display = 'none';
        actionsContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
        
        let message, icon, color;
        if (percentage >= 80) {
            message = "ممتاز! لديك فهم قوي للمحتوى 🎉";
            icon = "fas fa-trophy";
            color = "#ffd700";
        } else if (percentage >= 60) {
            message = "جيد جداً! يمكنك المراجعة لتحسين النتيجة 💪";
            icon = "fas fa-star";
            color = "#4cc9f0";
        } else {
            message = "يحتاج تحسين! ننصحك بإعادة مشاهدة المحاضرة 📚";
            icon = "fas fa-redo";
            color = "#dc3545";
        }


        resultsContainer.innerHTML = `
            <div class="result-icon">
                <i class="${icon}" style="color: ${color};"></i>
            </div>
            <div class="result-score" style="color: ${color};">
                ${percentage}%
            </div>
            <div class="result-message">
                ${message}
            </div>
            <div class="result-details">
                <div class="detail-item">
                    <div class="detail-value">${score}</div>
                    <div class="detail-label">إجابة صحيحة</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">${totalQuestions}</div>
                    <div class="detail-label">إجمالي الأسئلة</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">${percentage}%</div>
                    <div class="detail-label">النسبة المئوية</div>
                </div>
            </div>
            <button class="quiz-btn primary" onclick="quizManager.restartQuiz()">
                <i class="fas fa-redo"></i> إعادة الاختبار
            </button>
        `;


        // تسجيل الإنجاز
        if (window.statisticsManager && percentage >= 80) {
            window.statisticsManager.recordAchievement();
        }
    }


    restartQuiz() {
        this.currentQuestionIndex = 0;
        this.userAnswers = [];
        
        document.getElementById('quizResults').style.display = 'none';
        document.querySelector('.quiz-actions').style.display = 'flex';
        document.getElementById('quizQuestions').style.display = 'block';
        
        this.updateQuizDisplay();
        showNotification("تم إعادة بدء الاختبار", "info");
    }
}


// تهيئة الأنظمة
let videoContentManager, quizManager;


document.addEventListener('DOMContentLoaded', function() {
    videoContentManager = new VideoContentManager();
    quizManager = new QuizManager();
    
    // إضافة إلى أنظمة التهيئة الرئيسية
    setTimeout(() => {
        showNotification('✅ نظام المحتوى والاختبارات جاهز', 'success');
    }, 1000);
});
// === ✅ نظام الأسئلة والاختبارات ===
class QuizSystem {
    constructor() {
        this.basicQuizQuestions = [
    {
        id: 1,
        question: "ما هي الأيقونة المستخدمة لتقسيم الفيديو إلى أجزاء؟",
        options: [
            { text: "أيقونة التقسيم", correct: true, icon: "fas fa-cut" },
            { text: "أيقونة القص", correct: false, icon: "fas fa-crop" },
            { text: "أيقونة الحذف", correct: false, icon: "fas fa-trash" },
            { text: "أيقونة التكرار", correct: false, icon: "fas fa-copy" }
        ]
    },
    {
        id: 2,
        question: "أي من هذه الأدوات تستخدم لإضافة ترجمة تلقائية للفيديو؟",
        options: [
            { text: "أيقونة النص", correct: false, icon: "fas fa-font" },
            { text: "أيقونة الشروحات", correct: true, icon: "fas fa-closed-captioning" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" }
        ]
    },
    {
        id: 3,
        question: "ما الفرق الرئيسي بين أيقونة الضبط وأيقونة الفلاتر؟",
        options: [
            { text: "لا يوجد فرق بينهما", correct: false },
            { text: "الضبط للتعديل الدقيق في الألوان، الفلاتر لتطبيق تأثيرات جاهزة", correct: true },
            { text: "الضبط للصوت، الفلاتر للصورة", correct: false },
            { text: "الضبط للمؤثرات، الفلاتر للنصوص", correct: false }
        ]
    },
    {
        id: 4,
        question: "أي أيقونة تستخدم لإضافة فيديو فوق الفيديو الأساسي؟",
        options: [
            { text: "أيقونة النص", correct: false, icon: "fas fa-font" },
            { text: "أيقونة التراكب", correct: true, icon: "fas fa-layer-group" },
            { text: "أيقونة الفلاتر", correct: false, icon: "fas fa-image" },
            { text: "أيقونة الخلفية", correct: false, icon: "fas fa-square" }
        ]
    },
    {
        id: 5,
        question: "ما هي الأيقونة المسؤولة عن تغيير أبعاد الفيديو؟",
        options: [
            { text: "أيقونة القص", correct: false, icon: "fas fa-crop" },
            { text: "أيقونة نسبة العرض إلى الارتفاع", correct: true, icon: "fas fa-expand" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة الأساسي", correct: false, icon: "fas fa-arrows-alt" }
        ]
    },
    {
        id: 6,
        question: "أي أيقونة تستخدم لعزل الصوت عن الموسيقى؟",
        options: [
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة عزل الصوت", correct: true, icon: "fas fa-volume-mute" },
            { text: "أيقونة المؤثرات الصوتية", correct: false, icon: "fas fa-music" },
            { text: "أيقونة استخراج الصوت", correct: false, icon: "fas fa-file-audio" }
        ]
    },
    {
        id: 7,
        question: "ما هي الأيقونة المستخدمة لتتبع حركة شيء معين في الفيديو؟",
        options: [
            { text: "أيقونة التنميق", correct: false, icon: "fas fa-user-circle" },
            { text: "أيقونة تتبع الكاميرا", correct: true, icon: "fas fa-video" },
            { text: "أيقونة تثبيت الصورة", correct: false, icon: "fas fa-camera" },
            { text: "أيقونة العكس", correct: false, icon: "fas fa-retweet" }
        ]
    },
    {
        id: 8,
        question: "أي أيقونة تستخدم لإزالة خلفية الفيديو؟",
        options: [
            { text: "أيقونة إزالة الخلفية", correct: true, icon: "fas fa-highlighter" },
            { text: "أيقونة الخلفية", correct: false, icon: "fas fa-square" },
            { text: "أيقونة التعتيم", correct: false, icon: "fas fa-low-vision" },
            { text: "أيقونة القناع", correct: false, icon: "fas fa-shapes" }
        ]
    },
    {
        id: 9,
        question: "ما هي الأيقونة المستخدمة لتحسين جودة الصوت؟",
        options: [
            { text: "أيقونة تحسين الصوت", correct: true, icon: "fas fa-volume-up" },
            { text: "أيقونة تقليل الضوضاء", correct: false, icon: "fas fa-volume-down" },
            { text: "أيقونة مستوى الصوت", correct: false, icon: "fas fa-sliders-h" },
            { text: "أيقونة المؤثرات الصوتية", correct: false, icon: "fas fa-music" }
        ]
    },
    {
        id: 10,
        question: "أي أيقونة تستخدم لتكرار الفيديو المحدد؟",
        options: [
            { text: "أيقونة الاستبدال", correct: false, icon: "fas fa-sync-alt" },
            { text: "أيقونة التكرار", correct: true, icon: "fas fa-copy" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" },
            { text: "أيقونة التراكب (تحويل)", correct: false, icon: "fas fa-exchange-alt" }
        ]
    },
    {
        id: 11,
        question: "ما هي الأيقونة المستخدمة لتسريع أو إبطاء الفيديو؟",
        options: [
            { text: "أيقونة السرعة", correct: true, icon: "fas fa-tachometer-alt" },
            { text: "أيقونة التقسيم", correct: false, icon: "fas fa-cut" },
            { text: "أيقونة الرسوم المتحركة", correct: false, icon: "fas fa-film" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" }
        ]
    },
    {
        id: 12,
        question: "أي أيقونة تستخدم لإضافة تأثيرات بصرية جذابة للفيديو؟",
        options: [
            { text: "أيقونة المؤثرات", correct: true, icon: "fas fa-magic" },
            { text: "أيقونة الفلاتر", correct: false, icon: "fas fa-image" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" }
        ]
    },
    {
        id: 13,
        question: "ما هي الأيقونة المستخدمة لتعديل ألوان الفيديو ودرجة السطوع؟",
        options: [
            { text: "أيقونة الضبط", correct: true, icon: "fas fa-adjust" },
            { text: "أيقونة الفلاتر", correct: false, icon: "fas fa-image" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" }
        ]
    },
    {
        id: 14,
        question: "أي أيقونة تستخدم لإضافة استيكرات أو صور توضيحية للفيديو؟",
        options: [
            { text: "أيقونة الملصقات", correct: true, icon: "fas fa-sticky-note" },
            { text: "أيقونة النص", correct: false, icon: "fas fa-font" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" },
            { text: "أيقونة الخلفية", correct: false, icon: "fas fa-square" }
        ]
    },
    {
        id: 15,
        question: "ما هي الأيقونة المستخدمة لتغيير خلفية الفيديو الأساسية؟",
        options: [
            { text: "أيقونة الخلفية", correct: true, icon: "fas fa-square" },
            { text: "أيقونة إزالة الخلفية", correct: false, icon: "fas fa-highlighter" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" },
            { text: "أيقونة التعتيم", correct: false, icon: "fas fa-low-vision" }
        ]
    },
    {
        id: 16,
        question: "أي أيقونة تستخدم لإضافة مشاهد دخول وخروج للفيديو؟",
        options: [
            { text: "أيقونة الرسوم المتحركة", correct: true, icon: "fas fa-film" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" },
            { text: "أيقونة السرعة", correct: false, icon: "fas fa-tachometer-alt" }
        ]
    },
    {
        id: 17,
        question: "ما هي الأيقونة المستخدمة لعمل تأثيرات احترافية باستخدام الذكاء الاصطناعي؟",
        options: [
            { text: "أيقونة النمط", correct: true, icon: "fas fa-palette" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة التوسيع المدعوم بالذكاء الاصطناعي", correct: false, icon: "fas fa-robot" },
            { text: "أيقونة الشروحات", correct: false, icon: "fas fa-closed-captioning" }
        ]
    },
    {
        id: 18,
        question: "أي أيقونة تستخدم لحذف الفيديو أو العناصر المحددة؟",
        options: [
            { text: "أيقونة الحذف", correct: true, icon: "fas fa-trash" },
            { text: "أيقونة التقسيم", correct: false, icon: "fas fa-cut" },
            { text: "أيقونة القص", correct: false, icon: "fas fa-crop" },
            { text: "أيقونة إلغاء الربط", correct: false, icon: "fas fa-unlink" }
        ]
    },
    {
        id: 19,
        question: "ما هي الأيقونة المستخدمة للتحكم في مستوى الصوت رفعاً وخفضاً؟",
        options: [
            { text: "أيقونة مستوى الصوت", correct: true, icon: "fas fa-sliders-h" },
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة عزل الصوت", correct: false, icon: "fas fa-volume-mute" }
        ]
    },
    {
        id: 20,
        question: "أي أيقونة تستخدم لإضافة مؤثرات صوتية للفيديو؟",
        options: [
            { text: "أيقونة المؤثرات الصوتية", correct: true, icon: "fas fa-music" },
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة الإيقاعات", correct: false, icon: "fas fa-drum" }
        ]
    },
    {
        id: 21,
        question: "ما هي الأيقونة المستخدمة للتعديل في تفاصيل الوجه؟",
        options: [
            { text: "أيقونة التنميق", correct: true, icon: "fas fa-user-circle" },
            { text: "أيقونة تتبع الكاميرا", correct: false, icon: "fas fa-video" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة الفلاتر", correct: false, icon: "fas fa-image" }
        ]
    },
    {
        id: 22,
        question: "أي أيقونة تستخدم لقص الصورة أو الفيديو؟",
        options: [
            { text: "أيقونة تحويل", correct: true, icon: "fas fa-crop" },
            { text: "أيقونة التقسيم", correct: false, icon: "fas fa-cut" },
            { text: "أيقونة القناع", correct: false, icon: "fas fa-shapes" },
            { text: "أيقونة نسبة العرض إلى الارتفاع", correct: false, icon: "fas fa-expand" }
        ]
    },
    {
        id: 23,
        question: "ما هي الأيقونة المستخدمة لتوسيع الفيديو باستخدام الذكاء الاصطناعي؟",
        options: [
            { text: "أيقونة التوسيع المدعوم بالذكاء الاصطناعي", correct: true, icon: "fas fa-robot" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" },
            { text: "أيقونة نسبة العرض إلى الارتفاع", correct: false, icon: "fas fa-expand" },
            { text: "أيقونة تحويل", correct: false, icon: "fas fa-crop" }
        ]
    },
    {
        id: 24,
        question: "أي أيقونة تستخدم لتحويل الفيديو من رئيسي إلى فرعي؟",
        options: [
            { text: "أيقونة تراكب (تحويل)", correct: true, icon: "fas fa-exchange-alt" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" },
            { text: "أيقونة الأساسي", correct: false, icon: "fas fa-arrows-alt" },
            { text: "أيقونة التكرار", correct: false, icon: "fas fa-copy" }
        ]
    },
    {
        id: 25,
        question: "ما هي الأيقونة المستخدمة للتحكم في موضع وتدوير الفيديو؟",
        options: [
            { text: "أيقونة الأساسي", correct: true, icon: "fas fa-arrows-alt" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة تحويل", correct: false, icon: "fas fa-crop" },
            { text: "أيقونة تتبع الكاميرا", correct: false, icon: "fas fa-video" }
        ]
    },
    {
        id: 26,
        question: "أي أيقونة تستخدم لقص الفيديو بأشكال هندسية؟",
        options: [
            { text: "أيقونة القناع", correct: true, icon: "fas fa-shapes" },
            { text: "أيقونة تحويل", correct: false, icon: "fas fa-crop" },
            { text: "أيقونة التقسيم", correct: false, icon: "fas fa-cut" },
            { text: "أيقونة نسبة العرض إلى الارتفاع", correct: false, icon: "fas fa-expand" }
        ]
    },
    {
        id: 27,
        question: "ما هي الأيقونة المستخدمة لاستبدال الفيديو بفيديو آخر؟",
        options: [
            { text: "أيقونة الاستبدال", correct: true, icon: "fas fa-sync-alt" },
            { text: "أيقونة التكرار", correct: false, icon: "fas fa-copy" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" },
            { text: "أيقونة الحذف", correct: false, icon: "fas fa-trash" }
        ]
    },
    {
        id: 28,
        question: "أي أيقونة تستخدم لفصل الصوت عن الفيديو؟",
        options: [
            { text: "أيقونة استخراج الصوت", correct: true, icon: "fas fa-file-audio" },
            { text: "أيقونة عزل الصوت", correct: false, icon: "fas fa-volume-mute" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" }
        ]
    },
    {
        id: 29,
        question: "ما هي الأيقونة المستخدمة لعمل حركة ضبابية احترافية للفيديو؟",
        options: [
            { text: "أيقونة ضباب الحركة", correct: true, icon: "fas fa-cloud" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة الرسوم المتحركة", correct: false, icon: "fas fa-film" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" }
        ]
    },
    {
        id: 30,
        question: "أي أيقونة تستخدم لتقليل الاهتزاز في الفيديو؟",
        options: [
            { text: "أيقونة تثبيت الصورة", correct: true, icon: "fas fa-camera" },
            { text: "أيقونة تتبع الكاميرا", correct: false, icon: "fas fa-video" },
            { text: "أيقونة ضباب الحركة", correct: false, icon: "fas fa-cloud" },
            { text: "أيقونة السرعة", correct: false, icon: "fas fa-tachometer-alt" }
        ]
    },
    {
        id: 31,
        question: "ما هي الأيقونة المستخدمة لتقليل شفافية الصورة؟",
        options: [
            { text: "أيقونة التعتيم", correct: true, icon: "fas fa-low-vision" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة الفلاتر", correct: false, icon: "fas fa-image" },
            { text: "أيقونة الخلفية", correct: false, icon: "fas fa-square" }
        ]
    },
    {
        id: 32,
        question: "أي أيقونة تستخدم لعكس حركة الفيديو؟",
        options: [
            { text: "أيقونة العكس", correct: true, icon: "fas fa-retweet" },
            { text: "أيقونة السرعة", correct: false, icon: "fas fa-tachometer-alt" },
            { text: "أيقونة توقف الحركة", correct: false, icon: "fas fa-pause-circle" },
            { text: "أيقونة الرسوم المتحركة", correct: false, icon: "fas fa-film" }
        ]
    },
    {
        id: 33,
        question: "ما هي الأيقونة المستخدمة لأخذ لقطة ثابتة من الفيديو؟",
        options: [
            { text: "أيقونة توقف الحركة", correct: true, icon: "fas fa-pause-circle" },
            { text: "أيقونة التقسيم", correct: false, icon: "fas fa-cut" },
            { text: "أيقونة الحذف", correct: false, icon: "fas fa-trash" },
            { text: "أيقونة الاستبدال", correct: false, icon: "fas fa-sync-alt" }
        ]
    },
    {
        id: 34,
        question: "أي أيقونة تستخدم لتقليل الضوضاء في الصوت؟",
        options: [
            { text: "أيقونة تقليل الضوضاء", correct: true, icon: "fas fa-volume-down" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة عزل الصوت", correct: false, icon: "fas fa-volume-mute" },
            { text: "أيقونة المؤثرات الصوتية", correct: false, icon: "fas fa-music" }
        ]
    },
    {
        id: 35,
        question: "ما هي الأيقونة المستخدمة لوضع علامات زمنية على الصوت؟",
        options: [
            { text: "أيقونة الإيقاعات", correct: true, icon: "fas fa-drum" },
            { text: "أيقونة المؤثرات الصوتية", correct: false, icon: "fas fa-music" },
            { text: "أيقونة الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" }
        ]
    },
    {
        id: 36,
        question: "أي أيقونة تستخدم لربط أو فصل النصوص مع الفيديو؟",
        options: [
            { text: "أيقونة إلغاء الربط", correct: true, icon: "fas fa-unlink" },
            { text: "أيقونة النص", correct: false, icon: "fas fa-font" },
            { text: "أيقونة الحذف", correct: false, icon: "fas fa-trash" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" }
        ]
    },
    {
        id: 37,
        question: "ما هي الأيقونة الرئيسية المستخدمة للتعديل على الفيديو؟",
        options: [
            { text: "أيقونة التعديل", correct: true, icon: "fas fa-sliders-h" },
            { text: "أيقونة الضبط", correct: false, icon: "fas fa-adjust" },
            { text: "أيقونة المؤثرات", correct: false, icon: "fas fa-magic" },
            { text: "أيقونة النمط", correct: false, icon: "fas fa-palette" }
        ]
    },
    {
        id: 38,
        question: "أي أيقونة تستخدم للتحكم في إعدادات الصوت؟",
        options: [
            { text: "أيقونة الصوت", correct: true, icon: "fas fa-volume-up" },
            { text: "أيقونة تحسين الصوت", correct: false, icon: "fas fa-volume-up" },
            { text: "أيقونة مستوى الصوت", correct: false, icon: "fas fa-sliders-h" },
            { text: "أيقونة المؤثرات الصوتية", correct: false, icon: "fas fa-music" }
        ]
    },
    {
        id: 39,
        question: "ما هي الأيقونة المستخدمة لإضافة نصوص وعناوين للفيديو؟",
        options: [
            { text: "أيقونة النص", correct: true, icon: "fas fa-font" },
            { text: "أيقونة الشروحات", correct: false, icon: "fas fa-closed-captioning" },
            { text: "أيقونة الملصقات", correct: false, icon: "fas fa-sticky-note" },
            { text: "أيقونة التراكب", correct: false, icon: "fas fa-layer-group" }
        ]
    }
];


        this.aiQuizQuestions = [
    {
        id: 1,
        question: "ما هو التطبيق الذي يحول النصوص إلى فيديو بجودة 1080؟",
        options: [
            { text: "ChatGPT", correct: false, icon: "fas fa-comments" },
            { text: "PixVerse", correct: true, icon: "fas fa-magic" },
            { text: "ElevenLabs", correct: false, icon: "fas fa-volume-up" },
            { text: "Qwen", correct: false, icon: "fas fa-video" }
        ]
    },
    {
        id: 2,
        question: "أي أداة تستخدم لفصل صوت المغني عن الموسيقى؟",
        options: [
            { text: "Moises", correct: true, icon: "fas fa-music" },
            { text: "Retouch", correct: false, icon: "fas fa-brush" },
            { text: "Veed.io", correct: false, icon: "fas fa-closed-captioning" },
            { text: "Runway ML", correct: false, icon: "fas fa-film" }
        ]
    },
    {
        id: 3,
        question: "ما هو التطبيق الذي يقدم مساعد ذكي للكتابة الإبداعية؟",
        options: [
            { text: "PixVerse", correct: false, icon: "fas fa-magic" },
            { text: "ChatGPT", correct: true, icon: "fas fa-comments" },
            { text: "ElevenLabs", correct: false, icon: "fas fa-volume-up" },
            { text: "Remini", correct: false, icon: "fas fa-star" }
        ]
    },
    {
        id: 4,
        question: "أي موقع يحول النص إلى صوت طبيعي بجودة احترافية؟",
        options: [
            { text: "Veed.io", correct: false, icon: "fas fa-closed-captioning" },
            { text: "Runway ML", correct: false, icon: "fas fa-film" },
            { text: "ElevenLabs", correct: true, icon: "fas fa-volume-up" },
            { text: "Qwen", correct: false, icon: "fas fa-video" }
        ]
    },
    {
        id: 5,
        question: "ما هو التطبيق الذي يقوم بإزالة العناصر غير المرغوب فيها من الصور؟",
        options: [
            { text: "Moises", correct: false, icon: "fas fa-music" },
            { text: "Retouch", correct: true, icon: "fas fa-brush" },
            { text: "YouCut", correct: false, icon: "fas fa-star" },
            { text: "PixVerse", correct: false, icon: "fas fa-magic" }
        ]
    },
    {
        id: 6,
        question: "أي أداة تستخدم لتحسين جودة الفيديو والصور؟",
        options: [
            { text: "Remini & YouCut", correct: true, icon: "fas fa-star" },
            { text: "ChatGPT", correct: false, icon: "fas fa-comments" },
            { text: "ElevenLabs", correct: false, icon: "fas fa-volume-up" },
            { text: "Veed.io", correct: false, icon: "fas fa-closed-captioning" }
        ]
    },
    {
        id: 7,
        question: "ما هو الموقع الذي يولد ترجمة تلقائية للفيديوهات؟",
        options: [
            { text: "Runway ML", correct: false, icon: "fas fa-film" },
            { text: "Veed.io", correct: true, icon: "fas fa-closed-captioning" },
            { text: "ElevenLabs", correct: false, icon: "fas fa-volume-up" },
            { text: "PixVerse", correct: false, icon: "fas fa-magic" }
        ]
    },
    {
        id: 8,
        question: "أي تطبيق يحول الصور أو النصوص إلى فيديوهات قصيرة؟",
        options: [
            { text: "ChatGPT", correct: false, icon: "fas fa-comments" },
            { text: "Qwen", correct: true, icon: "fas fa-video" },
            { text: "Moises", correct: false, icon: "fas fa-music" },
            { text: "Retouch", correct: false, icon: "fas fa-brush" }
        ]
    },
    {
        id: 9,
        question: "ما هو الموقع المتقدم لتحرير الفيديو بالذكاء الاصطناعي؟",
        options: [
            { text: "Veed.io", correct: false, icon: "fas fa-closed-captioning" },
            { text: "ElevenLabs", correct: false, icon: "fas fa-volume-up" },
            { text: "Runway ML", correct: true, icon: "fas fa-film" },
            { text: "PixVerse", correct: false, icon: "fas fa-magic" }
        ]
    },
    {
        id: 10,
        question: "أي أداة تستخدم لتحويل الكلام المكتوب إلى صوت طبيعي؟",
        options: [
            { text: "ChatGPT", correct: false, icon: "fas fa-comments" },
            { text: "ElevenLabs", correct: true, icon: "fas fa-volume-up" },
            { text: "PixVerse", correct: false, icon: "fas fa-magic" },
            { text: "Moises", correct: false, icon: "fas fa-music" }
        ]
    }
];


        this.currentQuiz = null;
        this.currentQuestionIndex = 0;
        this.userAnswers = [];
        this.init();
    }


    init() {
        this.setupEventListeners();
    }


    setupEventListeners() {
        // تحديث الاختبار عند تغيير الفيديو
        const originalChangeVideo = window.changeVideo;
        window.changeVideo = (index) => {
            if (originalChangeVideo) originalChangeVideo(index);
            this.backToQuizSelection();
        };
    }


    showQuizSection(quizType) {
        document.getElementById('quiz-selection-message').style.display = 'none';
        document.getElementById('basic-quiz').style.display = 'none';
        document.getElementById('ai-quiz').style.display = 'none';
        
        if (quizType === 'basic') {
            document.getElementById('basic-quiz').style.display = 'block';
            this.startQuiz('basic');
        } else if (quizType === 'ai') {
            document.getElementById('ai-quiz').style.display = 'block';
            this.startQuiz('ai');
        }
    }


    backToQuizSelection() {
        document.getElementById('quiz-selection-message').style.display = 'block';
        document.getElementById('basic-quiz').style.display = 'none';
        document.getElementById('ai-quiz').style.display = 'none';
    }


    startQuiz(quizType) {
        const questions = quizType === 'basic' ? this.basicQuizQuestions : this.aiQuizQuestions;
        const containerId = `${quizType}-quiz-container`;
        const progressBarId = `${quizType}-quiz-progress`;
        const progressTextId = `${quizType}-progress-text`;
        const prevBtnId = `${quizType}-prev-btn`;
        const nextBtnId = `${quizType}-next-btn`;
        const submitBtnId = `${quizType}-submit-btn`;
        const resultId = `${quizType}-quiz-result`;


        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(questions.length).fill(null);


        const showQuestion = (index) => {
            const container = document.getElementById(containerId);
            const question = questions[index];
            
            let optionsHTML = '';
            question.options.forEach((option, optIndex) => {
                const icon = option.icon ? `<i class="${option.icon}"></i>` : '';
                const isSelected = userAnswers[index] === optIndex;
                optionsHTML += `
                    <div class="option-item ${isSelected ? 'selected' : ''}" data-index="${optIndex}">
                        <div class="option-marker">${String.fromCharCode(65 + optIndex)}</div>
                        <div class="option-text">${icon} ${option.text}</div>
                    </div>
                `;
            });
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-text">${question.id}. ${question.question}</div>
                    <div class="options-list">
                        ${optionsHTML}
                    </div>
                </div>
            `;


            // تفعيل اختيار الإجابات
            container.querySelectorAll('.option-item').forEach(item => {
                item.addEventListener('click', () => {
                    const selectedIndex = parseInt(item.getAttribute('data-index'));
                    userAnswers[currentQuestion] = selectedIndex;
                    
                    // إزالة التحديد من جميع الخيارات
                    container.querySelectorAll('.option-item').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // تحديد الخيار المختار
                    item.classList.add('selected');
                });
            });


            // تحديث الأزرار
            document.getElementById(prevBtnId).disabled = index === 0;
            document.getElementById(nextBtnId).style.display = index < questions.length - 1 ? 'flex' : 'none';
            document.getElementById(submitBtnId).style.display = index === questions.length - 1 ? 'flex' : 'none';
        };


        const updateProgress = () => {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById(progressBarId).style.width = `${progress}%`;
            document.getElementById(progressTextId).textContent = 
                `السؤال ${currentQuestion + 1} من ${questions.length}`;
        };


        const showResults = () => {
            score = userAnswers.reduce((total, answer, index) => {
                return total + (answer === questions[index].options.findIndex(opt => opt.correct) ? 1 : 0);
            }, 0);
            
            const percentage = Math.round((score / questions.length) * 100);
            const resultsContainer = document.getElementById(resultId);
            
            let message, icon, color;
            if (percentage >= 90) {
                message = "ممتاز! لديك فهم قوي للمحتوى 🎉";
                icon = "fas fa-trophy";
                color = "#ffd700";
            } else if (percentage >= 70) {
                message = "جيد جداً! يمكنك المراجعة لتحسين النتيجة 💪";
                icon = "fas fa-star";
                color = "#4cc9f0";
            } else {
                message = "يحتاج تحسين! ننصحك بإعادة مشاهدة المحاضرة 📚";
                icon = "fas fa-redo";
                color = "#dc3545";
            }


            resultsContainer.innerHTML = `
                <div class="result-icon">
                    <i class="${icon}" style="color: ${color};"></i>
                </div>
                <div class="result-score" style="color: ${color};">
                    ${percentage}%
                </div>
                <div class="result-message">
                    ${message}
                </div>
                <div class="result-details">
                    <div class="detail-item">
                        <div class="detail-value">${score}</div>
                        <div class="detail-label">إجابة صحيحة</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${questions.length}</div>
                        <div class="detail-label">إجمالي الأسئلة</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${percentage}%</div>
                        <div class="detail-label">النسبة المئوية</div>
                    </div>
                </div>
                <button class="quiz-btn primary" onclick="quizSystem.restartQuiz('${quizType}')">
                    <i class="fas fa-redo"></i> إعادة الاختبار
                </button>
            `;


            resultsContainer.style.display = 'block';
            document.querySelector('.quiz-actions').style.display = 'none';
            document.getElementById(containerId).style.display = 'none';


            // تسجيل الإنجاز
            if (window.statisticsManager && percentage >= 80) {
                window.statisticsManager.recordAchievement();
            }
        };


        // تفعيل أزرار التنقل
        document.getElementById(nextBtnId).onclick = () => {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
            }
        };


        document.getElementById(prevBtnId).onclick = () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
            }
        };


        document.getElementById(submitBtnId).onclick = showResults;


        // بدء الاختبار
        currentQuestion = 0;
        userAnswers = new Array(questions.length).fill(null);
        showQuestion(currentQuestion);
        updateProgress();
        
        document.getElementById(containerId).style.display = 'block';
        document.querySelector('.quiz-actions').style.display = 'flex';
        document.getElementById(resultId).style.display = 'none';
    }


    restartQuiz(quizType) {
        this.showQuizSection(quizType);
    }
}


// تهيئة نظام الاختبارات
let quizSystem;


// إضافة إلى التهيئة الرئيسية
document.addEventListener('DOMContentLoaded', function() {
    // ... الكود الحالي
    
    // تهيئة نظام الاختبارات
    quizSystem = new QuizSystem();
    
    // جعل الدوال متاحة globally
    window.showQuizSection = (type) => quizSystem.showQuizSection(type);
    window.backToQuizSelection = () => quizSystem.backToQuizSelection();
    window.quizSystem = quizSystem;
});
// دالة لفتح الاختبار من الأزرار الأخرى
function openQuiz(quizType = 'basic') {
    // فتح قسم الاختبارات في الأكورديون
    const quizAccordion = document.getElementById('quizAccordion');
    const quizContent = document.getElementById('quizContent');
    
    // إغلاق جميع الأكورديونات الأخرى
    document.querySelectorAll('.accordion-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('.accordion-header').forEach(header => {
        header.classList.remove('active');
    });
    
    // فتح أكورديون الاختبارات
    quizAccordion.classList.add('active');
    quizContent.classList.add('active');
    
    // عرض الاختبار المطلوب
    setTimeout(() => {
        quizSystem.showQuizSection(quizType);
    }, 300);
}


// إضافة زر لفتح الاختبار في الواجهة
function addQuizQuickAccess() {
    const quickAccess = document.createElement('div');
    quickAccess.innerHTML = `
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="openQuiz('basic')" style="background: var(--primary-color);">
                <i class="fas fa-play-circle" style="margin-left: 8px;"></i>
                <span>ابدأ اختبار الأدوات</span>
            </button>
        </div>
    `;
    
    // إضافة في مكان مناسب في الواجهة
    const videoContent = document.querySelector('.video-content');
    if (videoContent) {
        videoContent.appendChild(quickAccess);
    }
}


// ==================== 🔄 نظام التمرير للمواد التعليمية - الإصدار الفوري ====================


// 1. إضافة أنماط CSS ديناميكياً
const scrollStyles = `
    /* تحسينات قسم المواد التعليمية لجميع المحاضرات */
    .materials-scroll-container {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 10px;
        margin-top: 15px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) transparent;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(0, 0, 0, 0.1);
    }


    .materials-scroll-container::-webkit-scrollbar {
        width: 6px;
    }


    .materials-scroll-container::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }


    .materials-scroll-container::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 3px;
    }


    .materials-scroll-container::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-color);
    }


    /* تحسينات للشاشات الصغيرة */
    @media (max-width: 768px) {
        .materials-scroll-container {
            max-height: 300px;
        }
    }


    /* تأثيرات السحب السلس */
    .materials-scroll-container {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }


    /* أنيميشن للمؤشر */
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-5px);
        }
        60% {
            transform: translateY(-3px);
        }
    }


    .scroll-indicator {
        animation: fadeIn 0.5s ease;
        text-align: center;
        padding: 8px;
        background: rgba(67, 97, 238, 0.1);
        border-radius: 8px;
        margin-bottom: 10px;
        border: 1px solid rgba(67, 97, 238, 0.2);
    }


    .scroll-indicator i {
        color: var(--primary-color);
        animation: bounce 2s infinite;
        margin-left: 8px;
    }


    .scroll-indicator span {
        color: var(--primary-color);
        font-size: 0.8rem;
        font-weight: 600;
    }


    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }


    /* إخفاء المؤشر بعد التمرير */
    .materials-scroll-container.scrolled ~ .scroll-indicator {
        opacity: 0;
        transition: opacity 0.3s ease;
    }


    /* تحسين مظهر العناصر داخل قسم التمرير */
    .materials-scroll-container .material-item {
        margin-bottom: 15px;
        transition: transform 0.2s ease;
    }


    .materials-scroll-container .material-item:hover {
        transform: translateX(-3px);
    }
`;


// 2. حقن الأنماط في الصفحة
const styleSheet = document.createElement('style');
styleSheet.textContent = scrollStyles;
document.head.appendChild(styleSheet);


// 3. نظام التمرير الرئيسي
class SimpleScrollManager {
    constructor() {
        this.init();
    }


    init() {
        console.log('🚀 بدء نظام التمرير للمواد التعليمية...');
        
        // الانتظار حتى تحميل الصفحة
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.setupAllMaterials());
        } else {
            this.setupAllMaterials();
        }


        // اعتراض تحديثات المحتوى
        this.interceptContentUpdates();
    }


    setupAllMaterials() {
        // معالجة جميع أقسام المواد الحالية
        this.processMaterialsSection();
        
        // إعداد مراقب للتغييرات المستقبلية
        this.setupMutationObserver();
        
        console.log('✅ نظام التمرير جاهز لجميع المحاضرات');
    }


    processMaterialsSection() {
        const materialsList = document.getElementById('materialsList');
        if (!materialsList) {
            console.log('⏳ انتظار تحميل قسم المواد...');
            setTimeout(() => this.processMaterialsSection(), 500);
            return;
        }


        // التحقق إذا كان قد تمت المعالجة مسبقاً
        if (materialsList.classList.contains('scroll-processed')) {
            return;
        }


        const currentContent = materialsList.innerHTML;
        
        // إضافة حاوية التمرير فقط إذا لم تكن موجودة
        if (!currentContent.includes('materials-scroll-container')) {
            materialsList.innerHTML = `
                <div class="scroll-indicator">
                    <i class="fas fa-chevron-down"></i>
                    <span>اسحب لرؤية المزيد من المواد</span>
                </div>
                <div class="materials-scroll-container">
                    ${currentContent}
                </div>
            `;
            
            materialsList.classList.add('scroll-processed');
            this.enhanceScrollContainer();
            console.log('🎯 تم إضافة التمرير لقسم المواد');
        }
    }


    enhanceScrollContainer() {
        const scrollContainer = document.querySelector('.materials-scroll-container');
        const indicator = document.querySelector('.scroll-indicator');


        if (!scrollContainer) return;


        // إضافة مستمع حدث التمرير
        scrollContainer.addEventListener('scroll', () => {
            this.handleScrollEffects(scrollContainer, indicator);
        });


        // التحقق من الحاجة للمؤشر
        setTimeout(() => {
            const needsScroll = scrollContainer.scrollHeight > scrollContainer.clientHeight;
            if (!needsScroll && indicator) {
                indicator.style.display = 'none';
            }
        }, 1000);
    }


    handleScrollEffects(container, indicator) {
        const scrollPercentage = (container.scrollTop / (container.scrollHeight - container.clientHeight)) * 100;
        
        // إخفاء المؤشر بعد البدء في التمرير
        if (scrollPercentage > 10 && indicator) {
            container.classList.add('scrolled');
        } else {
            container.classList.remove('scrolled');
        }
        
        // تأثيرات الظل الديناميكية
        if (scrollPercentage > 90) {
            container.style.boxShadow = 'inset 0 -10px 20px -10px rgba(67, 97, 238, 0.3)';
        } else if (scrollPercentage < 10) {
            container.style.boxShadow = 'inset 0 10px 20px -10px rgba(67, 97, 238, 0.3)';
        } else {
            container.style.boxShadow = 'inset 0 10px 20px -10px rgba(67, 97, 238, 0.3), inset 0 -10px 20px -10px rgba(67, 97, 238, 0.3)';
        }
    }


    interceptContentUpdates() {
        // اعتراض نظام المحتوى الحالي إذا كان موجوداً
        if (window.fixedContentManager) {
            const originalUpdateMaterials = window.fixedContentManager.updateMaterials;
            window.fixedContentManager.updateMaterials = (html) => {
                console.log('🔄 اعتراض تحديث المواد وإضافة التمرير...');
                
                const element = document.getElementById('materialsList');
                if (element) {
                    element.innerHTML = `
                        <div class="scroll-indicator">
                            <i class="fas fa-chevron-down"></i>
                            <span>اسحب لرؤية المزيد من المواد</span>
                        </div>
                        <div class="materials-scroll-container">
                            ${html}
                        </div>
                    `;
                    element.classList.add('scroll-processed');
                    
                    setTimeout(() => {
                        this.enhanceScrollContainer();
                    }, 100);
                }
            };
        }
    }


    setupMutationObserver() {
        // مراقبة التغييرات في DOM لاكتشاف المحتوى الجديد
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && (node.id === 'materialsList' || node.querySelector('#materialsList'))) {
                            setTimeout(() => {
                                this.processMaterialsSection();
                            }, 100);
                        }
                    });
                }
            });
        });


        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    }


    // دالة مساعدة للتحديث اليدوي
    refreshScroll() {
        this.processMaterialsSection();
        console.log('🔄 تحديث نظام التمرير يدوياً');
    }
}


// 4. التشغيل الفوري للنظام
document.addEventListener('DOMContentLoaded', function() {
    // تهيئة نظام التمرير
    window.materialsScrollManager = new SimpleScrollManager();
    
    // أيضًا معالجة أي محتوى موجود مسبقاً
    setTimeout(() => {
        if (window.materialsScrollManager) {
            window.materialsScrollManager.processMaterialsSection();
        }
    }, 1000);
});


// 5. بدء التشغيل حتى لو تم تحميل الصفحة مسبقاً
if (document.readyState === 'complete') {
    window.materialsScrollManager = new SimpleScrollManager();
}


// 6. جعل الدوال متاحة globally للاستخدام
window.refreshMaterialsScroll = function() {
    if (window.materialsScrollManager) {
        window.materialsScrollManager.refreshScroll();
    }
};


window.forceScrollUpdate = function() {
    const materialsList = document.getElementById('materialsList');
    if (materialsList) {
        materialsList.classList.remove('scroll-processed');
        if (window.materialsScrollManager) {
            window.materialsScrollManager.processMaterialsSection();
        }
    }
};


console.log('🎯 نظام التمرير للمواد التعليمية مثبت وجاهز!');
// === ✅ نظام معلومات الفيديو البسيط ===
class SimpleVideoInfoManager {
    constructor() {
        this.videoInfo = {
            0: {
                title: "المحاضرة الأولى (الاساسيات)",
                duration: "26:37",
                quality: "HD",
                type: "فيديو تعليمي"
            },
            1: {
                title: "المحاضرة الثانية (التطبيق)",
                duration: "43:37", 
                quality: "HD",
                type: "فيديو تعليمي"
            },
            2: {
                title: "المحاضرة الثالثة (AI)",
                duration: "2:27",
                quality: "HD",
                type: "فيديو تعليمي"
            }
        };
        
        this.init();
    }


    init() {
        console.log('🎬 بدء نظام معلومات الفيديو البسيط...');
        this.setupEventListeners();
        this.updateVideoInfo(0); // عرض معلومات المحاضرة الأولى افتراضياً
    }


    setupEventListeners() {
        // اعتراض تغيير الفيديو
        const originalChangeVideo = window.changeVideo;
        window.changeVideo = (index) => {
            if (originalChangeVideo) originalChangeVideo(index);
            this.updateVideoInfo(index);
        };


        // اعتراض نظام الحماية
        if (window.showAccessControl) {
            const originalShowAccessControl = window.showAccessControl;
            window.showAccessControl = (index) => {
                originalShowAccessControl(index);
                this.updateVideoInfo(index);
            };
        }


        // اعتراض اختيار المحاضرات
        if (window.selectLecture) {
            const originalSelectLecture = window.selectLecture;
            window.selectLecture = (index) => {
                originalSelectLecture(index);
                this.updateVideoInfo(index);
            };
        }


        // اعتراض النقر على قائمة التشغيل
        document.addEventListener('click', (e) => {
            const playlistItem = e.target.closest('.playlist-item');
            if (playlistItem) {
                const videoIndex = parseInt(playlistItem.getAttribute('data-video'));
                if (!isNaN(videoIndex)) {
                    setTimeout(() => {
                        this.updateVideoInfo(videoIndex);
                    }, 100);
                }
            }
        });
    }


    updateVideoInfo(videoIndex) {
        const videoData = this.videoInfo[videoIndex];
        
        if (!videoData) {
            console.log('❌ لا توجد معلومات لهذه المحاضرة');
            return;
        }


        // تحديث العناصر مباشرة
        const titleElement = document.getElementById('videoTitle');
        const durationElement = document.getElementById('videoDuration');
        const qualityElement = document.getElementById('videoQuality');
        const typeElement = document.getElementById('videoType');


        if (titleElement) titleElement.textContent = videoData.title;
        if (durationElement) durationElement.textContent = videoData.duration;
        if (qualityElement) qualityElement.textContent = videoData.quality;
        if (typeElement) typeElement.textContent = videoData.type;


        console.log(`✅ تم تحديث معلومات المحاضرة ${videoIndex}`);
    }
}


// === ✅ التهيئة ===
let simpleVideoInfoManager;


document.addEventListener('DOMContentLoaded', function() {
    simpleVideoInfoManager = new SimpleVideoInfoManager();
    
    // جعل النظام متاحاً globally
    window.simpleVideoInfoManager = simpleVideoInfoManager;
});


console.log('✅ نظام معلومات الفيديو البسيط جاهز!');
// ==================== نهاية كود التمرير ====================
</script>
    </script>
</body>
</html>